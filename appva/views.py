from collections import namedtuple
import csv
from easy_pdf import rendering
from matplotlib import pyplot as pit
import numpy as np
import psycopg2
import weasyprint
import pandas as pd
from django.utils.six import BytesIO
from django.contrib import auth as autent
from django.contrib.auth import authenticate, login, logout
from django.contrib.auth.decorators import login_required
from django.contrib.auth.models import User
from django.core import paginator
from django.core.paginator import Paginator, PageNotAnInteger, EmptyPage
from django.db import connections
from django.http import HttpResponse
from django.http import HttpResponseRedirect
from django.shortcuts import render, redirect, get_object_or_404
import json
from .models import *


# VIEWS RELACIONADAS A FUNCIONALIDADES

# VIEWS RELACIONADAS A INDEX
def namedtuplefetchall(cursor):
    "Return all rows from a cursor as a namedtuple"
    desc = cursor.description
    nt_result = namedtuple('Lista', [col[0] for col in desc])
    return [nt_result(*row) for row in cursor.fetchall()]


@login_required
def index(request):
    municipio = request.GET.get('municipio')
    with connections['default'].cursor() as cursor:
        if municipio:
            cursor.execute(
                """SELECT *, rank() OVER (ORDER BY vr_adic_ano_exercicio DESC) posicao  FROM appva_acypr556 WHERE remessa='DOE DEFINITIVO' AND ano_exercicio='2020' AND municipio NOT LIKE 'TOTAL DO ESTADO';
            """
            )
            ranking = namedtuplefetchall(cursor)

            ranking_ind = [{'posicao': x.posicao} for x in ranking if x.municipio == f'{municipio}']
            ## GRAFICO VALOR ADICIONADO MUNICIPIO
            cursor.execute(
                """SELECT vr_adic_ano_exercicio, ano_exercicio FROM appva_acypr556 WHERE remessa='DOE DEFINITIVO' AND MUNICIPIO=%s ORDER BY ano_exercicio ASC""",
                [municipio]
            )
            valor_adici = namedtuplefetchall(cursor)
            ano = [x.ano_exercicio for x in valor_adici]
            valor_adicionado = [x.vr_adic_ano_exercicio for x in valor_adici]

            pit.figure(figsize=(10, 5))
            pit.plot(ano, valor_adicionado)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valor adicionado por 100 milhões')
            pit.title(f'Gráfico de valor adicionado individual - {municipio}')
            pit.savefig('/code/ProjetoVA/static/img/va_mun_evo.png')

            ###### GRÁFICO INDICE DE PARTICIPAÇÃO
            cursor.execute(
                """SELECT ind_final, ano_exercicio FROM appva_acypr535 WHERE municipio=%s AND remessa='DOE DEFINITIVO' ORDER BY ano_exercicio ASC;""",
                [municipio]
            )
            indice_par = namedtuplefetchall(cursor)

            cursor.execute(
                """SELECT ind_final, ano_exercicio FROM appva_acypr535 WHERE remessa='DOE DEFINITIVO' AND MUNICIPIO=%s ORDER BY ano_exercicio ASC""",
                [municipio]
            )
            indice_par_grafico = namedtuplefetchall(cursor)
            ano_indice = [x.ano_exercicio for x in indice_par_grafico]
            indice_parti = [x.ind_final for x in indice_par_grafico]

            pit.figure(figsize=(10, 5))
            pit.plot(ano_indice, indice_parti)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Índice de participação por ano')
            pit.title(f'Gráfico de índice de participação - {municipio}')
            pit.savefig('/code/ProjetoVA/static/img/va_ind_par.png')

            ####### GRAFICO DO VA TOTAL DO ESTADO

            cursor.execute(
                """SELECT vr_adic_ano_exercicio, ano_exercicio FROM appva_acypr556 WHERE remessa='DOE DEFINITIVO' AND municipio = 'TOTAL DO ESTADO' ORDER BY ano_exercicio ASC;
            """
            )
            va_total_estado = namedtuplefetchall(cursor)

            vr_adic_estado = [x.vr_adic_ano_exercicio for x in va_total_estado]
            ano_estado = [x.ano_exercicio for x in va_total_estado]

            pit.figure(figsize=(10, 5))
            pit.plot(ano_estado, vr_adic_estado)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valor adicionado por 100 bilhões')
            pit.title('Gráfico de valor adicionado do Estado do Mato Grosso')
            pit.savefig('/code/ProjetoVA/static/img/va_estado_graf.png')

            ### GRÁFICO DE INDICE MÉDIO

            cursor.execute(
                """SELECT iva_med, ano_exercicio FROM appva_acypr535 WHERE remessa='DOE DEFINITIVO' AND municipio=%s ORDER BY ano_exercicio ASC;"""
                , [municipio])
            indice_medio = namedtuplefetchall(cursor)

            ind_medi = [x.iva_med for x in indice_medio]
            ano_medi = [x.ano_exercicio for x in indice_medio]

            pit.figure(figsize=(10, 5))
            pit.plot(ano_medi, ind_medi)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Índice médio por ano')
            pit.title(f'Gráfico de índice médio - {municipio} ')
            pit.savefig('/code/ProjetoVA/static/img/va_indice_med.png')

            ### GRÁFICO DE DISTRIBUIÇÃO ESTADO

            cursor.execute(
                """SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro) / 1 AS distrib, ano FROM appva_fpm WHERE ano='2021' UNION SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro+novembro+dezembro) /12 AS distrib, ano FROM appva_fpm WHERE ano NOT LIKE '2021' ORDER BY ano ASC;"""
            )
            distribuicao = namedtuplefetchall(cursor)

            distri = [x.distrib for x in distribuicao]
            ano_distri = [x.ano for x in distribuicao]

            pit.figure(figsize=(10, 5))
            pit.plot(ano_distri, distri)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Distribuição por 100 milhões')
            pit.title('Distribuição média mensal do ICMS do Estado aos Municípios')
            pit.savefig('/code/ProjetoVA/static/img/va_distri_estado.png')

            ### ARRECADACAO ICMS

            cursor.execute(
                """ SELECT ind_final, ano_exercicio FROM appva_acypr535 WHERE municipio=%s AND remessa='DOE DEFINITIVO';
            """, [municipio]
            )
            indi = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro) / 10 AS media, ano FROM appva_fpm WHERE ano='2020' UNION SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro+novembro+dezembro) /12 AS media, ano FROM appva_fpm WHERE ano NOT LIKE '2020' AND ano IN ('2019', '2018', '2017', '2016', '2015', '2014', '2013', '2012', '2011') ORDER BY ano ASC;"""
            )
            icms_indi = namedtuplefetchall(cursor)
            ax = len(indi)
            finali = [{'arrecad': (indi[x].ind_final * icms_indi[x].media) / 100, 'ano': icms_indi[x].ano} for x in
                      range(ax)]

            arre = [x['arrecad'] for x in finali]
            ano_arre = [x['ano'] for x in finali]

            pit.figure(figsize=(10, 5))
            pit.plot(ano_arre, arre)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Arrecadação por 100 mil')
            pit.title(f'Gráfico de arrecadação média ICMS de {municipio} por ano ')
            pit.savefig('/code/ProjetoVA/static/img/va_arre_ano.png')

            ### VARIOS INDICES

            cursor.execute(
                """SELECT iva_med, iva_75, populacao, ucti, trib_propr, area, coef_soc, ano_exercicio FROM appva_acypr535 WHERE municipio=%s AND remessa='DOE DEFINITIVO' ORDER BY ano_exercicio ASC;""",
                [municipio]
            )
            indices = namedtuplefetchall(cursor)
            f_med = [x.iva_med for x in indices]
            f_75 = [x.iva_75 for x in indices]
            f_popu = [x.populacao for x in indices]
            f_trib = [x.trib_propr for x in indices]
            f_area = [x.area for x in indices]
            f_coef = [x.coef_soc for x in indices]
            f_ucti = [x.ucti for x in indices]
            f_ano = [x.ano_exercicio for x in indices]
            pit.figure(figsize=(10, 5))
            pit.plot(f_ano, f_med)
            pit.plot(f_ano, f_75)
            pit.plot(f_ano, f_popu)
            pit.plot(f_ano, f_ucti)
            pit.plot(f_ano, f_trib)
            pit.plot(f_ano, f_area)
            pit.plot(f_ano, f_coef)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valores em padrão de índice')
            pit.title(f'Indices do município de {municipio}')
            pit.legend(('Indice médio', '75% do índice', 'Indice população', 'Indice do UCTI', 'Indice Trib. própria',
                        'Indice área', 'Indice Coef. Social'))
            pit.savefig('/code/ProjetoVA/static/img/va_indices_ano.png')

            ###ACYPR600
            cursor.execute(
                """SELECT com_ind, prod_rural, prest_serv, dar_1_aut, nai, credito_ex_off, debito_ex_off, total, ano_exercicio FROM appva_acypr600 WHERE municipio=%s AND remessa='DOE DEFINITIVO' ORDER BY ano_exercicio ASC;""",
                [municipio]
            )
            acypr600 = namedtuplefetchall(cursor)

            ci = [x.com_ind for x in acypr600]
            pr = [x.prod_rural for x in acypr600]
            ps = [x.prest_serv for x in acypr600]
            da = [x.dar_1_aut for x in acypr600]
            na = [x.nai for x in acypr600]
            co = [x.credito_ex_off for x in acypr600]
            do = [x.debito_ex_off for x in acypr600]
            to = [x.total for x in acypr600]
            ae = [x.ano_exercicio for x in acypr600]

            pit.figure(figsize=(10, 5))
            pit.plot(ae, ci)
            pit.plot(ae, pr)
            pit.plot(ae, ps)
            pit.plot(ae, da)
            pit.plot(ae, na)
            pit.plot(ae, co)
            pit.plot(ae, do)
            pit.plot(ae, to)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valores adicionados por 100 milhões')
            pit.title(f'Valor adicionado de {municipio} - Atividades econômicas e outros')
            pit.legend(('Comércio e indústria', 'Produção rural', 'Prestação de serviços', 'DAR-1/AUT', 'N.A.I',
                        'Crédito Ex Off', 'Débito Ex Off', 'Total'))
            pit.savefig('/code/ProjetoVA/static/img/va_600.png')

            municipio = [{'nome': municipio}]
        else:
            cursor.execute(
                """SELECT *, rank() OVER (ORDER BY vr_adic_ano_exercicio DESC) posicao  FROM appva_acypr556 WHERE remessa='DOE DEFINITIVO' AND ano_exercicio='2020' AND municipio NOT LIKE 'TOTAL DO ESTADO';
            """
            )
            ranking = namedtuplefetchall(cursor)

            ranking_ind = [{'posicao': x.posicao} for x in ranking if x.municipio == 'ACORIZAL']

            ## GRAFICO VALOR ADICIONADO MUNICIPIO
            cursor.execute(
                """SELECT vr_adic_ano_exercicio, ano_exercicio FROM appva_acypr556 WHERE remessa='DOE DEFINITIVO' AND MUNICIPIO='ACORIZAL' ORDER BY ano_exercicio ASC"""
            )
            valor_adici = namedtuplefetchall(cursor)
            ano = [x.ano_exercicio for x in valor_adici]
            valor_adicionado = [x.vr_adic_ano_exercicio for x in valor_adici]

            pit.figure(figsize=(10, 5))
            pit.plot(ano, valor_adicionado)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valor adicionado por milhão')
            pit.title('Gráfico de valor adicionado individual - Acorizal')
            pit.savefig('/code/ProjetoVA/static/img/va_mun_evo.png')

            ###### GRÁFICO INDICE DE PARTICIPAÇÃO
            cursor.execute(
                """SELECT ind_final, ano_exercicio FROM appva_acypr535 WHERE municipio='ACORIZAL' AND remessa='DOE DEFINITIVO';"""
            )
            indice_par = namedtuplefetchall(cursor)

            cursor.execute(
                """SELECT ind_final, ano_exercicio FROM appva_acypr535 WHERE remessa='DOE DEFINITIVO' AND MUNICIPIO='ACORIZAL' ORDER BY ano_exercicio ASC"""
            )
            indice_par_grafico = namedtuplefetchall(cursor)
            ano_indice = [x.ano_exercicio for x in indice_par_grafico]
            indice_parti = [x.ind_final for x in indice_par_grafico]

            pit.figure(figsize=(10, 5))
            pit.plot(ano_indice, indice_parti)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Índice de participação por ano')
            pit.title('Gráfico de índice de participação - Acorizal')
            pit.savefig('/code/ProjetoVA/static/img/va_ind_par.png')

            ####### GRAFICO DO VA TOTAL DO ESTADO

            cursor.execute(
                """SELECT vr_adic_ano_exercicio, ano_exercicio FROM appva_acypr556 WHERE remessa='DOE DEFINITIVO' AND municipio = 'TOTAL DO ESTADO' ORDER BY ano_exercicio ASC;
            """
            )
            va_total_estado = namedtuplefetchall(cursor)

            vr_adic_estado = [x.vr_adic_ano_exercicio for x in va_total_estado]
            ano_estado = [x.ano_exercicio for x in va_total_estado]

            pit.figure(figsize=(10, 5))
            pit.plot(ano_estado, vr_adic_estado)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valor adicionado por 100 bilhões')
            pit.title('Gráfico de valor adicionado do Estado do Mato Grosso')
            pit.savefig('/code/ProjetoVA/static/img/va_estado_graf.png')

            ### GRÁFICO DE INDICE MÉDIO

            cursor.execute(
                """SELECT iva_med, ano_exercicio FROM appva_acypr535 WHERE remessa='DOE DEFINITIVO' AND municipio='JUINA' ORDER BY ano_exercicio ASC;"""
            )
            indice_medio = namedtuplefetchall(cursor)

            ind_medi = [x.iva_med for x in indice_medio]
            ano_medi = [x.ano_exercicio for x in indice_medio]

            pit.figure(figsize=(10, 5))
            pit.plot(ano_medi, ind_medi)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Índice médio por ano')
            pit.title('Gráfico de índice médio - Acorizal ')
            pit.savefig('/code/ProjetoVA/static/img/va_indice_med.png')

            ### GRÁFICO DE DISTRIBUIÇÃO ESTADO

            cursor.execute(
                """SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro) / 1 AS distrib, ano FROM appva_fpm WHERE ano='2021' UNION SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro+novembro+dezembro) /12 AS distrib, ano FROM appva_fpm WHERE ano NOT LIKE '2021' ORDER BY ano ASC;"""
            )
            distribuicao = namedtuplefetchall(cursor)

            distri = [x.distrib for x in distribuicao]
            ano_distri = [x.ano for x in distribuicao]

            pit.figure(figsize=(10, 5))
            pit.plot(ano_distri, distri)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Distribuição por 100 milhões')
            pit.title('Distribuição média mensal do ICMS do Estado aos Municípios')
            pit.savefig('/code/ProjetoVA/static/img/va_distri_estado.png')

            ### ARRECADACAO ICMS

            cursor.execute(
                """ SELECT ind_final, ano_exercicio FROM appva_acypr535 WHERE municipio='ACORIZAL' AND remessa='DOE DEFINITIVO';
            """
            )
            indi = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro) / 10 AS media, ano FROM appva_fpm WHERE ano='2020' UNION SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro+novembro+dezembro) /12 AS media, ano FROM appva_fpm WHERE ano NOT LIKE '2020' AND ano IN ('2019', '2018', '2017', '2016', '2015', '2014', '2013', '2012', '2011') ORDER BY ano ASC;"""
            )
            icms_indi = namedtuplefetchall(cursor)
            ax = len(indi)
            finali = [{'arrecad': (indi[x].ind_final * icms_indi[x].media) / 100, 'ano': icms_indi[x].ano} for x in
                      range(ax)]

            arre = [x['arrecad'] for x in finali]
            ano_arre = [x['ano'] for x in finali]

            pit.figure(figsize=(10, 5))
            pit.plot(ano_arre, arre)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Arrecadação por 100 mil')
            pit.title('Gráfico de arrecadação média ICMS de Acorizal por ano ')
            pit.savefig('/code/ProjetoVA/static/img/va_arre_ano.png')

            ### VARIOS INDICES

            cursor.execute(
                """SELECT iva_med, iva_75, populacao, ucti, trib_propr, area, coef_soc, ano_exercicio FROM appva_acypr535 WHERE municipio='ACORIZAL' AND remessa='DOE DEFINITIVO' ORDER BY ano_exercicio ASC;"""
            )
            indices = namedtuplefetchall(cursor)
            f_med = [x.iva_med for x in indices]
            f_75 = [x.iva_75 for x in indices]
            f_popu = [x.populacao for x in indices]
            f_trib = [x.trib_propr for x in indices]
            f_area = [x.area for x in indices]
            f_coef = [x.coef_soc for x in indices]
            f_ucti = [x.ucti for x in indices]
            f_ano = [x.ano_exercicio for x in indices]
            pit.figure(figsize=(10, 7))
            pit.plot(f_ano, f_med)
            pit.plot(f_ano, f_75)
            pit.plot(f_ano, f_popu)
            pit.plot(f_ano, f_ucti)
            pit.plot(f_ano, f_trib)
            pit.plot(f_ano, f_area)
            pit.plot(f_ano, f_coef)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valores em padrão de índice')
            pit.title('Indices do município de Acorizal')
            pit.legend(('Indice médio', '75% do índice', 'Indice população', 'Indice do UCTI', 'Indice Trib. própria',
                        'Indice área', 'Indice Coef. Social'))
            pit.savefig('/code/ProjetoVA/static/img/va_indices_ano.png')

            ###ACYPR600
            cursor.execute(
                """SELECT com_ind, prod_rural, prest_serv, dar_1_aut, nai, credito_ex_off, debito_ex_off, total, ano_exercicio FROM appva_acypr600 WHERE municipio='ACORIZAL' AND remessa='DOE DEFINITIVO' ORDER BY ano_exercicio ASC;""",
            )
            acypr600 = namedtuplefetchall(cursor)

            ci = [x.com_ind for x in acypr600]
            pr = [x.prod_rural for x in acypr600]
            ps = [x.prest_serv for x in acypr600]
            da = [x.dar_1_aut for x in acypr600]
            na = [x.nai for x in acypr600]
            co = [x.credito_ex_off for x in acypr600]
            do = [x.debito_ex_off for x in acypr600]
            to = [x.total for x in acypr600]
            ae = [x.ano_exercicio for x in acypr600]

            pit.figure(figsize=(10, 5))
            pit.plot(ae, ci)
            pit.plot(ae, pr)
            pit.plot(ae, ps)
            pit.plot(ae, da)
            pit.plot(ae, na)
            pit.plot(ae, co)
            pit.plot(ae, do)
            pit.plot(ae, to)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valores adicionados por 100 milhões')
            pit.title(f'Valor adicionado de ACORIZAL - Atividades econômicas e outros')
            pit.legend(('Comércio e indústria', 'Produção rural', 'Prestação de serviços', 'DAR-1/AUT', 'N.A.I',
                        'Crédito Ex Off', 'Débito Ex Off', 'Total'))
            pit.savefig('/code/ProjetoVA/static/img/va_600.png')

            municipio = [{'nome': 'ACORIZAL'}]

    return render(request, 'index.html',
                  {'abc': municipio, 'lista': ranking, 'ind': ranking_ind, 'lista2': indice_par,
                   'lista3': va_total_estado,
                   'lista4': indice_medio, 'lista5': distribuicao, 'lista6': finali, 'lista7': indices})


@login_required
def index_barras(request):
    municipio = request.GET.get('municipio')
    municipio_v = request.GET.get('municipio_v')
    ano_iv = request.GET.get('ano_iv')
    ano_fv = request.GET.get('ano_fv')
    if ano_iv:
        ano_iv = int(ano_iv) - 1
        ano_iv = str(ano_iv)
    with connections['default'].cursor() as cursor:
        if municipio:
            cursor.execute(
                """SELECT *, rank() OVER (ORDER BY vr_adic_ano_exercicio DESC) posicao  FROM appva_acypr556 WHERE remessa='DOE DEFINITIVO' AND ano_exercicio='2020' AND municipio NOT LIKE 'TOTAL DO ESTADO';
            """
            )
            ranking = namedtuplefetchall(cursor)

            ranking_ind = [{'posicao': x.posicao} for x in ranking if x.municipio == f'{municipio}']

            ## GRAFICO VALOR ADICIONADO MUNICIPIO
            cursor.execute(
                """SELECT vr_adic_ano_exercicio, ano_exercicio FROM appva_acypr556 WHERE remessa='DOE DEFINITIVO' AND MUNICIPIO=%s ORDER BY ano_exercicio ASC""",
                [municipio]
            )
            valor_adici = namedtuplefetchall(cursor)
            ano = [x.ano_exercicio for x in valor_adici]
            valor_adicionado = [x.vr_adic_ano_exercicio for x in valor_adici]

            pit.figure(figsize=(10, 5))
            pit.bar(ano, valor_adicionado)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valor adicionado por 100 milhões')
            pit.title(f'Gráfico de valor adicionado individual - {municipio}')
            pit.savefig('/code/ProjetoVA/static/img/va_mun_evo.png')

            ###### GRÁFICO INDICE DE PARTICIPAÇÃO
            cursor.execute(
                """SELECT ind_final, ano_exercicio FROM appva_acypr535 WHERE municipio=%s AND remessa='DOE DEFINITIVO' ORDER BY ano_exercicio ASC;""",
                [municipio]
            )
            indice_par = namedtuplefetchall(cursor)

            cursor.execute(
                """SELECT ind_final, ano_exercicio FROM appva_acypr535 WHERE remessa='DOE DEFINITIVO' AND MUNICIPIO=%s ORDER BY ano_exercicio ASC""",
                [municipio]
            )
            indice_par_grafico = namedtuplefetchall(cursor)
            ano_indice = [x.ano_exercicio for x in indice_par_grafico]
            indice_parti = [x.ind_final for x in indice_par_grafico]

            pit.figure(figsize=(10, 5))
            pit.bar(ano_indice, indice_parti)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Índice de participação por ano')
            pit.title(f'Gráfico de índice de participação - {municipio}')
            pit.savefig('/code/ProjetoVA/static/img/va_ind_par.png')

            ####### GRAFICO DO VA TOTAL DO ESTADO

            cursor.execute(
                """SELECT vr_adic_ano_exercicio, ano_exercicio FROM appva_acypr556 WHERE remessa='DOE DEFINITIVO' AND municipio = 'TOTAL DO ESTADO' ORDER BY ano_exercicio ASC;
            """
            )
            va_total_estado = namedtuplefetchall(cursor)

            vr_adic_estado = [x.vr_adic_ano_exercicio for x in va_total_estado]
            ano_estado = [x.ano_exercicio for x in va_total_estado]

            pit.figure(figsize=(10, 5))
            pit.bar(ano_estado, vr_adic_estado)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valor adicionado por 100 bilhões')
            pit.title('Gráfico de valor adicionado do Estado do Mato Grosso')
            pit.savefig('/code/ProjetoVA/static/img/va_estado_graf.png')

            ### GRÁFICO DE INDICE MÉDIO

            cursor.execute(
                """SELECT iva_med, ano_exercicio FROM appva_acypr535 WHERE remessa='DOE DEFINITIVO' AND municipio=%s ORDER BY ano_exercicio ASC;"""
                , [municipio])
            indice_medio = namedtuplefetchall(cursor)

            ind_medi = [x.iva_med for x in indice_medio]
            ano_medi = [x.ano_exercicio for x in indice_medio]

            pit.figure(figsize=(10, 5))
            pit.bar(ano_medi, ind_medi)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Índice médio por ano')
            pit.title(f'Gráfico de índice médio - {municipio} ')
            pit.savefig('/code/ProjetoVA/static/img/va_indice_med.png')

            ### GRÁFICO DE DISTRIBUIÇÃO ESTADO

            cursor.execute(
                """SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro) / 1 AS distrib, ano FROM appva_fpm WHERE ano='2021' UNION SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro+novembro+dezembro) /12 AS distrib, ano FROM appva_fpm WHERE ano NOT LIKE '2021' ORDER BY ano ASC;"""
            )
            distribuicao = namedtuplefetchall(cursor)

            distri = [x.distrib for x in distribuicao]
            ano_distri = [x.ano for x in distribuicao]

            pit.figure(figsize=(10, 5))
            pit.bar(ano_distri, distri)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Distribuição por 100 milhões')
            pit.title('Gráfico de distribuição média mensal do ICMS do Estado aos Municípios ')
            pit.savefig('/code/ProjetoVA/static/img/va_distri_estado.png')

            ### ARRECADACAO ICMS

            cursor.execute(
                """ SELECT ind_final, ano_exercicio FROM appva_acypr535 WHERE municipio=%s AND remessa='DOE DEFINITIVO';
            """, [municipio]
            )
            indi = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro) / 10 AS media, ano FROM appva_fpm WHERE ano='2020' UNION SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro+novembro+dezembro) /12 AS media, ano FROM appva_fpm WHERE ano NOT LIKE '2020' AND ano IN ('2019', '2018', '2017', '2016', '2015', '2014', '2013', '2012', '2011') ORDER BY ano ASC;"""
            )
            icms_indi = namedtuplefetchall(cursor)
            ax = len(indi)
            finali = [{'arrecad': (indi[x].ind_final * icms_indi[x].media) / 100, 'ano': icms_indi[x].ano} for x in
                      range(ax)]
            arre = [x['arrecad'] for x in finali]
            ano_arre = [x['ano'] for x in finali]

            pit.figure(figsize=(10, 5))
            pit.bar(ano_arre, arre)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Arrecadação por 100 mil')
            pit.title(f'Gráfico de arrecadação média ICMS de {municipio} por ano ')
            pit.savefig('/code/ProjetoVA/static/img/va_arre_ano.png')

            ### VARIOS INDICES

            cursor.execute(
                """SELECT iva_med, iva_75, populacao, ucti, trib_propr, area, coef_soc, ano_exercicio FROM appva_acypr535 WHERE municipio=%s AND remessa='DOE DEFINITIVO' ORDER BY ano_exercicio ASC;""",
                [municipio]
            )
            indices = namedtuplefetchall(cursor)
            f_med = [x.iva_med for x in indices]
            f_75 = [x.iva_75 for x in indices]
            f_popu = [x.populacao for x in indices]
            f_trib = [x.trib_propr for x in indices]
            f_area = [x.area for x in indices]
            f_coef = [x.coef_soc for x in indices]
            f_ucti = [x.ucti for x in indices]
            f_ano = [x.ano_exercicio for x in indices]

            barwidth = 0.25
            pit.figure(figsize=(10, 7))

            rr1 = np.arange(len(f_ano))
            rr2 = [x + barwidth for x in rr1]
            rr3 = [x + barwidth for x in rr2]
            rr4 = [x + barwidth for x in rr3]

            pit.bar(rr1, f_med, width=0.25)
            pit.bar(rr2, f_75, width=0.25)
            pit.bar(rr3, f_popu, width=0.25)
            pit.bar(rr4, f_ucti, width=0.25)

            pit.xticks([r + barwidth for r in range(len(f_ano))], f_ano)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valores em padrão de índice')
            pit.title(f'Indices do município de {municipio}')
            pit.legend(('Indice médio', '75% do índice', 'Indice população', 'Indice do UCTI'))
            pit.savefig('/code/ProjetoVA/static/img/va_indices_ano.png')

            ### Parte 2
            barwidth = 0.25
            pit.figure(figsize=(10, 7))

            rr1 = np.arange(len(f_ano))
            rr2 = [x + barwidth for x in rr1]
            rr3 = [x + barwidth for x in rr2]

            pit.bar(rr1, f_trib, width=0.25)
            pit.bar(rr2, f_area, width=0.25)
            pit.bar(rr3, f_coef, width=0.25)

            pit.xticks([r + barwidth for r in range(len(f_ano))], f_ano)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valores em padrão de índice')
            pit.title(f'Indices do município de {municipio}')
            pit.legend(('Indice Trib. própria',
                        'Indice área', 'Indice Coef. Social'))
            pit.savefig('/code/ProjetoVA/static/img/va_indices_ano2.png')

            ###ACYPR600
            cursor.execute(
                """SELECT com_ind, prod_rural, prest_serv, dar_1_aut, nai, credito_ex_off, debito_ex_off, total, ano_exercicio FROM appva_acypr600 WHERE municipio=%s AND remessa='DOE DEFINITIVO' ORDER BY ano_exercicio ASC;""",
                [municipio]
            )
            acypr600 = namedtuplefetchall(cursor)

            ci = [x.com_ind for x in acypr600]
            pr = [x.prod_rural for x in acypr600]
            ps = [x.prest_serv for x in acypr600]
            da = [x.dar_1_aut for x in acypr600]
            na = [x.nai for x in acypr600]
            co = [x.credito_ex_off for x in acypr600]
            do = [x.debito_ex_off for x in acypr600]
            to = [x.total for x in acypr600]
            ae = [x.ano_exercicio for x in acypr600]

            barwidth = 0.25
            r1 = np.arange(len(ae))
            r2 = [x + barwidth for x in r1]
            r3 = [x + barwidth for x in r2]
            r4 = [x + barwidth for x in r3]

            pit.figure(figsize=(10, 5))
            pit.bar(r1, ci, width=barwidth)
            pit.bar(r2, pr, width=barwidth)
            pit.bar(r3, ps, width=barwidth)
            pit.bar(r4, da, width=barwidth)

            pit.xlabel('Ano de exercício')
            pit.xticks([r + barwidth for r in range(len(ae))], [x for x in ae])
            pit.ylabel('Valores adicionados por 100 milhões')
            pit.title(f'Valor adicionado de {municipio} - Atividades econômicas e outros')
            pit.legend(('Comércio e indústria', 'Produção rural', 'Prestação de serviços', 'DAR-1/AUT'))
            pit.savefig('/code/ProjetoVA/static/img/va_600.png')

            ### Parte 2
            barwidth = 0.25
            r1 = np.arange(len(ae))
            r2 = [x + barwidth for x in r1]
            r3 = [x + barwidth for x in r2]
            r4 = [x + barwidth for x in r3]

            pit.figure(figsize=(10, 5))
            pit.bar(r1, na, width=barwidth)
            pit.bar(r2, co, width=barwidth)
            pit.bar(r3, do, width=barwidth)
            pit.bar(r4, to, width=barwidth)

            pit.xlabel('Ano de exercício')
            pit.xticks([r + barwidth for r in range(len(ae))], [x for x in ae])
            pit.ylabel('Valores adicionados por 100 milhões')
            pit.title(f'Valor adicionado de {municipio} - Atividades econômicas e outros')
            pit.legend(('N.A.I', 'Crédito Ex-off', 'Débito Ex-off', 'Total'))
            pit.savefig('/code/ProjetoVA/static/img/va_6002.png')

            municipio = [{'nome': municipio}]
        else:
            cursor.execute(
                """SELECT *, rank() OVER (ORDER BY vr_adic_ano_exercicio DESC) posicao  FROM appva_acypr556 WHERE remessa='DOE DEFINITIVO' AND ano_exercicio='2020' AND municipio NOT LIKE 'TOTAL DO ESTADO';
            """
            )
            ranking = namedtuplefetchall(cursor)

            ranking_ind = [{'posicao': x.posicao} for x in ranking if x.municipio == 'ACORIZAL']

            ## GRAFICO VALOR ADICIONADO MUNICIPIO
            cursor.execute(
                """SELECT vr_adic_ano_exercicio, ano_exercicio FROM appva_acypr556 WHERE remessa='DOE DEFINITIVO' AND MUNICIPIO='ACORIZAL' ORDER BY ano_exercicio ASC"""
            )
            valor_adici = namedtuplefetchall(cursor)
            ano = [x.ano_exercicio for x in valor_adici]
            valor_adicionado = [x.vr_adic_ano_exercicio for x in valor_adici]

            pit.figure(figsize=(10, 5))
            pit.bar(ano, valor_adicionado)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valor adicionado por milhão')
            pit.title('Gráfico de valor adicionado individual - Acorizal')
            pit.savefig('/code/ProjetoVA/static/img/va_mun_evo.png')

            ###### GRÁFICO INDICE DE PARTICIPAÇÃO
            cursor.execute(
                """SELECT ind_final, ano_exercicio FROM appva_acypr535 WHERE municipio='ACORIZAL' AND remessa='DOE DEFINITIVO';"""
            )
            indice_par = namedtuplefetchall(cursor)

            cursor.execute(
                """SELECT ind_final, ano_exercicio FROM appva_acypr535 WHERE remessa='DOE DEFINITIVO' AND MUNICIPIO='ACORIZAL' ORDER BY ano_exercicio ASC"""
            )
            indice_par_grafico = namedtuplefetchall(cursor)
            ano_indice = [x.ano_exercicio for x in indice_par_grafico]
            indice_parti = [x.ind_final for x in indice_par_grafico]

            pit.figure(figsize=(10, 5))
            pit.bar(ano_indice, indice_parti)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Índice de participação por ano')
            pit.title('Gráfico de índice de participação - Acorizal')
            pit.savefig('/code/ProjetoVA/static/img/va_ind_par.png')

            ####### GRAFICO DO VA TOTAL DO ESTADO

            cursor.execute(
                """SELECT vr_adic_ano_exercicio, ano_exercicio FROM appva_acypr556 WHERE remessa='DOE DEFINITIVO' AND municipio = 'TOTAL DO ESTADO' ORDER BY ano_exercicio ASC;
            """
            )
            va_total_estado = namedtuplefetchall(cursor)

            vr_adic_estado = [x.vr_adic_ano_exercicio for x in va_total_estado]
            ano_estado = [x.ano_exercicio for x in va_total_estado]

            pit.figure(figsize=(10, 5))
            pit.bar(ano_estado, vr_adic_estado)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valor adicionado por 100 bilhões')
            pit.title('Gráfico de valor adicionado do Estado do Mato Grosso')
            pit.savefig('/code/ProjetoVA/static/img/va_estado_graf.png')

            ### GRÁFICO DE INDICE MÉDIO

            cursor.execute(
                """SELECT iva_med, ano_exercicio FROM appva_acypr535 WHERE remessa='DOE DEFINITIVO' AND municipio='JUINA' ORDER BY ano_exercicio ASC;"""
            )
            indice_medio = namedtuplefetchall(cursor)

            ind_medi = [x.iva_med for x in indice_medio]
            ano_medi = [x.ano_exercicio for x in indice_medio]

            pit.figure(figsize=(10, 5))
            pit.bar(ano_medi, ind_medi)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Índice médio por ano')
            pit.title('Gráfico de índice médio - Acorizal ')
            pit.savefig('/code/ProjetoVA/static/img/va_indice_med.png')

            ### GRÁFICO DE DISTRIBUIÇÃO ESTADO

            cursor.execute(
                """SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro) / 1 AS distrib, ano FROM appva_fpm WHERE ano='2021' UNION SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro+novembro+dezembro) /12 AS distrib, ano FROM appva_fpm WHERE ano NOT LIKE '2021' ORDER BY ano ASC;"""
            )
            distribuicao = namedtuplefetchall(cursor)

            distri = [x.distrib for x in distribuicao]
            ano_distri = [x.ano for x in distribuicao]

            pit.figure(figsize=(10, 5))
            pit.bar(ano_distri, distri)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Distribuição por 100 milhões')
            pit.title('Gráfico de distribuição média mensal do ICMS do Estado aos Municípios')
            pit.savefig('/code/ProjetoVA/static/img/va_distri_estado.png')

            ### ARRECADACAO ICMS

            cursor.execute(
                """ SELECT ind_final, ano_exercicio FROM appva_acypr535 WHERE municipio='ACORIZAL' AND remessa='DOE DEFINITIVO';
            """
            )
            indi = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro) / 10 AS media, ano FROM appva_fpm WHERE ano='2020' UNION SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro+novembro+dezembro) /12 AS media, ano FROM appva_fpm WHERE ano NOT LIKE '2020' AND ano IN ('2019', '2018', '2017', '2016', '2015', '2014', '2013', '2012', '2011') ORDER BY ano ASC;"""
            )
            icms_indi = namedtuplefetchall(cursor)
            ax = len(indi)
            finali = [{'arrecad': (indi[x].ind_final * icms_indi[x].media) / 100, 'ano': icms_indi[x].ano} for x in
                      range(ax)]

            arre = [x['arrecad'] for x in finali]
            ano_arre = [x['ano'] for x in finali]

            pit.figure(figsize=(10, 5))
            pit.bar(ano_arre, arre)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Arrecadação por 100 mil')
            pit.title('Gráfico de arrecadação média ICMS de Acorizal por ano ')
            pit.savefig('/code/ProjetoVA/static/img/va_arre_ano.png')

            ### VARIOS INDICES

            cursor.execute(
                """SELECT iva_med, iva_75, populacao, ucti, trib_propr, area, coef_soc, ano_exercicio FROM appva_acypr535 WHERE municipio='ACORIZAL' AND remessa='DOE DEFINITIVO' ORDER BY ano_exercicio ASC;"""
            )
            indices = namedtuplefetchall(cursor)
            f_med = [x.iva_med for x in indices]
            f_75 = [x.iva_75 for x in indices]
            f_popu = [x.populacao for x in indices]
            f_trib = [x.trib_propr for x in indices]
            f_area = [x.area for x in indices]
            f_coef = [x.coef_soc for x in indices]
            f_ucti = [x.ucti for x in indices]
            f_ano = [x.ano_exercicio for x in indices]

            ### Parte 1
            barwidth = 0.25
            pit.figure(figsize=(10, 7))

            rr1 = np.arange(len(f_ano))
            rr2 = [x + barwidth for x in rr1]
            rr3 = [x + barwidth for x in rr2]
            rr4 = [x + barwidth for x in rr3]

            pit.bar(rr1, f_med, width=0.25)
            pit.bar(rr2, f_75, width=0.25)
            pit.bar(rr3, f_popu, width=0.25)
            pit.bar(rr4, f_ucti, width=0.25)

            pit.xticks([r + barwidth for r in range(len(f_ano))], f_ano)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valores em padrão de índice')
            pit.title('Indices do município de Acorizal')
            pit.legend(('Indice médio', '75% do índice', 'Indice população', 'Indice do UCTI'))
            pit.savefig('/code/ProjetoVA/static/img/va_indices_ano.png')

            ### Parte 2
            barwidth = 0.25
            pit.figure(figsize=(10, 7))

            rr1 = np.arange(len(f_ano))
            rr2 = [x + barwidth for x in rr1]
            rr3 = [x + barwidth for x in rr2]

            pit.bar(rr1, f_trib, width=0.25)
            pit.bar(rr2, f_area, width=0.25)
            pit.bar(rr3, f_coef, width=0.25)

            pit.xticks([r + barwidth for r in range(len(f_ano))], f_ano)
            pit.xlabel('Ano de exercício')
            pit.ylabel('Valores em padrão de índice')
            pit.title('Indices do município de Acorizal')
            pit.legend(('Indice Trib. própria',
                        'Indice área', 'Indice Coef. Social'))
            pit.savefig('/code/ProjetoVA/static/img/va_indices_ano2.png')

            ###ACYPR600
            cursor.execute(
                """SELECT com_ind, prod_rural, prest_serv, dar_1_aut, nai, credito_ex_off, debito_ex_off, total, ano_exercicio FROM appva_acypr600 WHERE municipio='ACORIZAL' AND remessa='DOE DEFINITIVO' ORDER BY ano_exercicio ASC;""",
            )
            acypr600 = namedtuplefetchall(cursor)

            ci = [x.com_ind for x in acypr600]
            pr = [x.prod_rural for x in acypr600]
            ps = [x.prest_serv for x in acypr600]
            da = [x.dar_1_aut for x in acypr600]
            na = [x.nai for x in acypr600]
            co = [x.credito_ex_off for x in acypr600]
            do = [x.debito_ex_off for x in acypr600]
            to = [x.total for x in acypr600]
            ae = [x.ano_exercicio for x in acypr600]
            ### Parte 1
            barwidth = 0.25
            r1 = np.arange(len(ae))
            r2 = [x + barwidth for x in r1]
            r3 = [x + barwidth for x in r2]
            r4 = [x + barwidth for x in r3]

            pit.figure(figsize=(10, 5))
            pit.bar(r1, ci, width=barwidth)
            pit.bar(r2, pr, width=barwidth)
            pit.bar(r3, ps, width=barwidth)
            pit.bar(r4, da, width=barwidth)

            pit.xlabel('Ano de exercício')
            pit.xticks([r + barwidth for r in range(len(ae))], [x for x in ae])
            pit.ylabel('Valores adicionados por 100 milhões')
            pit.title(f'Valor adicionado de ACORIZAL - Atividades econômicas e outros')
            pit.legend(('Comércio e indústria', 'Produção rural', 'Prestação de serviços', 'DAR-1/AUT'))
            pit.savefig('/code/ProjetoVA/static/img/va_600.png')

            ### Parte 2
            barwidth = 0.25
            r1 = np.arange(len(ae))
            r2 = [x + barwidth for x in r1]
            r3 = [x + barwidth for x in r2]
            r4 = [x + barwidth for x in r3]

            pit.figure(figsize=(10, 5))
            pit.bar(r1, na, width=barwidth)
            pit.bar(r2, co, width=barwidth)
            pit.bar(r3, do, width=barwidth)
            pit.bar(r4, to, width=barwidth)

            pit.xlabel('Ano de exercício')
            pit.xticks([r + barwidth for r in range(len(ae))], [x for x in ae])
            pit.ylabel('Valores adicionados por 100 milhões')
            pit.title(f'Valor adicionado de ACORIZAL - Atividades econômicas e outros')
            pit.legend(('N.A.I', 'Crédito Ex-off', 'Débito Ex-off', 'Total'))
            pit.savefig('/code/ProjetoVA/static/img/va_6002.png')

            municipio = [{'nome': 'ACORIZAL'}]
    return render(request, 'index_barras.html',
                  {'abc': municipio, 'lista': ranking, 'ind': ranking_ind, 'lista2': indice_par,
                   'lista3': va_total_estado,
                   'lista4': indice_medio, 'lista5': distribuicao, 'lista6': finali, 'lista7': indices})


@login_required
def index_variacao(request):
    municipio_v = request.GET.get('municipio_v')
    ano_iv = request.GET.get('ano_iv')
    ano_fv = request.GET.get('ano_fv')
    if ano_iv:
        ano_iv = int(ano_iv) - 1
        ano_iv = str(ano_iv)
    with connections['default'].cursor() as cursor:
        if municipio_v and ano_iv and ano_fv:

            cursor.execute(
                """SELECT com_ind, prod_rural, prest_serv, dar_1_aut, nai, credito_ex_off, debito_ex_off, total, ano_exercicio, municipio FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio BETWEEN %s AND %s AND ano_exercicio NOT LIKE %s AND remessa='DOE DEFINITIVO' ORDER BY ano_exercicio ASC;"""
                , [municipio_v, ano_iv, ano_fv, ano_fv])
            variacao = namedtuplefetchall(cursor)

            cursor.execute(
                """SELECT com_ind, prod_rural, prest_serv, dar_1_aut, nai, credito_ex_off, debito_ex_off, total, ano_exercicio, municipio FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio BETWEEN %s AND %s AND ano_exercicio NOT LIKE %s AND remessa='DOE DEFINITIVO' ORDER BY ano_exercicio ASC;""",
                [municipio_v, ano_iv, ano_fv, ano_iv]
            )
            variacao2 = namedtuplefetchall(cursor)

            variacao_sp = [
                {'com_ind': float(x.com_ind), 'prod_rural': float(x.prod_rural), 'prest_serv': float(x.prest_serv),
                 'dar_1_aut': float(x.dar_1_aut), 'nai': float(x.nai),
                 'credito_ex_off': float(x.credito_ex_off), 'debito_ex_off': float(x.debito_ex_off),
                 'total': float(x.total), 'ano_exercicio': x.ano_exercicio} for x in variacao]

            variacao2_sp2 = [
                {'com_ind': float(x.com_ind), 'prod_rural': float(x.prod_rural), 'prest_serv': float(x.prest_serv),
                 'dar_1_aut': float(x.dar_1_aut), 'nai': float(x.nai),
                 'credito_ex_off': float(x.credito_ex_off), 'debito_ex_off': float(x.debito_ex_off),
                 'total': float(x.total), 'ano_exercicio': x.ano_exercicio, 'municipio': x.municipio} for x in
                variacao2]

            variacao2_sp2[0]['com_ind'] = float(0.0)
            variacao2_sp2[0]['prod_rural'] = float(0.0)
            variacao2_sp2[0]['prest_serv'] = float(0.0)
            variacao2_sp2[0]['dar_1_aut'] = float(0.0)
            variacao2_sp2[0]['nai'] = float(0.0)
            variacao2_sp2[0]['credito_ex_off'] = float(0.0)
            variacao2_sp2[0]['debito_ex_off'] = float(0.0)
            variacao2_sp2[0]['total'] = float(0.0)

            variacao_sp[0]['com_ind'] = float(0.01)
            variacao_sp[0]['prod_rural'] = float(0.001)
            variacao_sp[0]['prest_serv'] = float(0.001)
            variacao_sp[0]['dar_1_aut'] = float(0.001)
            variacao_sp[0]['nai'] = float(0.001)
            variacao_sp[0]['credito_ex_off'] = float(0.001)
            variacao_sp[0]['debito_ex_off'] = float(0.001)
            variacao_sp[0]['total'] = float(0.001)
            apx = len(variacao2_sp2)
            try:
                resu_com_ind = [
                    {'anual': ((variacao2_sp2[x]['com_ind'] / variacao_sp[x]['com_ind']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_com_ind[0]['anual'] = float(0.0)

            except ZeroDivisionError:
                resu_com_ind = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_prod_rural = [
                    {'anual': ((variacao2_sp2[x]['prod_rural'] / variacao_sp[x]['prod_rural']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_prod_rural[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_prod_rural = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_prest_serv = [
                    {'anual': ((variacao2_sp2[x]['prest_serv'] / variacao_sp[x]['prest_serv']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_prest_serv[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_prest_serv = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_dar_1_aut = [
                    {'anual': ((variacao2_sp2[x]['dar_1_aut'] / variacao_sp[x]['dar_1_aut']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_dar_1_aut[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_dar_1_aut = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_nai = [
                    {'anual': ((variacao2_sp2[x]['nai'] / variacao_sp[x]['nai']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_nai[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_nai = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_credito_ex_off = [
                    {'anual': ((variacao2_sp2[x]['credito_ex_off'] / variacao_sp[x]['credito_ex_off']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_credito_ex_off[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_credito_ex_off = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_debito_ex_off = [
                    {'anual': ((variacao2_sp2[x]['debito_ex_off'] / variacao_sp[x]['debito_ex_off']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_debito_ex_off[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_debito_ex_off = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_total = [
                    {'anual': ((variacao2_sp2[x]['total'] / variacao_sp[x]['total']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_total[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_total = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            muni = [{'municipio': municipio_v}]
        else:
            cursor.execute(
                """SELECT com_ind, prod_rural, prest_serv, dar_1_aut, nai, credito_ex_off, debito_ex_off, total, ano_exercicio, municipio FROM appva_acypr600 WHERE municipio='ACORIZAL' AND ano_exercicio BETWEEN '2011' AND '2020' AND ano_exercicio NOT LIKE '2020' ORDER BY ano_exercicio ASC;"""
            )
            variacao = namedtuplefetchall(cursor)

            cursor.execute(
                """SELECT com_ind, prod_rural, prest_serv, dar_1_aut, nai, credito_ex_off, debito_ex_off, total, ano_exercicio, municipio FROM appva_acypr600 WHERE municipio='ACORIZAL' AND ano_exercicio BETWEEN '2011' AND '2020' AND ano_exercicio NOT LIKE '2011' ORDER BY ano_exercicio ASC;"""
            )
            variacao2 = namedtuplefetchall(cursor)
            variacao_sp = [
                {'com_ind': float(x.com_ind), 'prod_rural': float(x.prod_rural), 'prest_serv': float(x.prest_serv),
                 'dar_1_aut': float(x.dar_1_aut), 'nai': float(x.credito_ex_off),
                 'credito_ex_off': float(x.credito_ex_off), 'debito_ex_off': float(x.debito_ex_off),
                 'total': float(x.total), 'ano_exercicio': x.ano_exercicio} for x in variacao]
            variacao2_sp2 = [
                {'com_ind': float(x.com_ind), 'prod_rural': float(x.prod_rural), 'prest_serv': float(x.prest_serv),
                 'dar_1_aut': float(x.dar_1_aut), 'nai': float(x.credito_ex_off),
                 'credito_ex_off': float(x.credito_ex_off), 'debito_ex_off': float(x.debito_ex_off),
                 'total': float(x.total), 'ano_exercicio': x.ano_exercicio, 'municipio': x.municipio} for x in
                variacao2]
            variacao2_sp2[0]['com_ind'] = float(0.0)
            variacao2_sp2[0]['prod_rural'] = float(0.0)
            variacao2_sp2[0]['prest_serv'] = float(0.0)
            variacao2_sp2[0]['dar_1_aut'] = float(0.0)
            variacao2_sp2[0]['nai'] = float(0.0)
            variacao2_sp2[0]['credito_ex_off'] = float(0.0)
            variacao2_sp2[0]['debito_ex_off'] = float(0.0)
            variacao2_sp2[0]['total'] = float(0.0)
            apx = len(variacao2_sp2)
            try:
                resu_com_ind = [
                    {'anual': ((variacao2_sp2[x]['com_ind'] / variacao_sp[x]['com_ind']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_com_ind[0]['anual'] = float(0.0)

            except ZeroDivisionError:
                resu_com_ind = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_prod_rural = [
                    {'anual': ((variacao2_sp2[x]['prod_rural'] / variacao_sp[x]['prod_rural']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_prod_rural[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_prod_rural = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_prest_serv = [
                    {'anual': ((variacao2_sp2[x]['prest_serv'] / variacao_sp[x]['prest_serv']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_prest_serv[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_prest_serv = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_dar_1_aut = [
                    {'anual': ((variacao2_sp2[x]['dar_1_aut'] / variacao_sp[x]['dar_1_aut']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_dar_1_aut[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_dar_1_aut = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_nai = [
                    {'anual': ((variacao2_sp2[x]['nai'] / variacao_sp[x]['nai']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_nai[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_nai = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_credito_ex_off = [
                    {'anual': ((variacao2_sp2[x]['credito_ex_off'] / variacao_sp[x]['credito_ex_off']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_credito_ex_off[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_credito_ex_off = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_debito_ex_off = [
                    {'anual': ((variacao2_sp2[x]['debito_ex_off'] / variacao_sp[x]['debito_ex_off']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_debito_ex_off[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_debito_ex_off = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            try:
                resu_total = [
                    {'anual': ((variacao2_sp2[x]['total'] / variacao_sp[x]['total']) - 1) * 100,
                     'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
                resu_total[0]['anual'] = float(0.0)
            except ZeroDivisionError:
                resu_total = [
                    {'anual': 0.0, 'ano': variacao2_sp2[x]['ano_exercicio'], 'municipio': variacao2_sp2[x]['municipio']}
                    for x in
                    range(apx)]
            muni = [{'municipio': 'ACORIZAL'}]
    return render(request, 'index_variacao.html',
                  {'aa': resu_com_ind, 'bb': resu_prod_rural, 'cc': resu_prest_serv, 'dd': resu_dar_1_aut,
                   'ee': resu_nai, 'ff': resu_credito_ex_off, 'gg': resu_debito_ex_off, 'hh': resu_total, 'abc': muni})


@login_required
def REMESSAS_APAGAR_EFD_418(request):
    if request.method == 'POST':
        remessa = request.POST["remessa"]
        ano_base = request.POST["ano_base"]
        with connections['default'].cursor() as cursor:
            remessa = str(remessa)
            ano_base = str(ano_base)
            cursor.execute("DELETE FROM appva_efd WHERE ano_base = %s AND remessa = %s", [ano_base, remessa])
            cursor.close()
            return redirect("REMESSAS_APAGAR_EFD_418_sucesso")
    return render(request, "REMESSAS_APAGAR_EFD_418.html")


@login_required
def REMESSAS_APAGAR_EFD_418_sucesso(request):
    return render(request, "REMESSAS_APAGAR_EFD_418_sucesso.html")


@login_required
def REMESSAS_APAGAR_GIA_296(request):
    if request.method == 'POST':
        remessa = request.POST["remessa"]
        ano_base = request.POST["ano_base"]
        with connections['default'].cursor() as cursor:
            remessa = str(remessa)
            ano_base = str(ano_base)
            cursor.execute("DELETE FROM appva_gia_entradas_saidas WHERE ano_base = %s AND remessa = %s",
                           [ano_base, remessa])
            cursor.close()
            return redirect("REMESSAS_APAGAR_GIA_296_sucesso")
    return render(request, "REMESSAS_APAGAR_GIA_296.html")


@login_required
def REMESSAS_APAGAR_GIA_296_sucesso(request):
    return render(request, "REMESSAS_APAGAR_GIA_296_sucesso.html")


#
# VIEWS RELACIONADAS A REMESSAS
@login_required
def remessas_novo(request):
    if not request.user.is_staff:
        return redirect('index')
    if request.method == 'POST':
        descricao_arquivo = request.POST['descricao_arquivo']
        ano_base = request.POST['ano_base']
        ano_exercicio = request.POST['ano_exercicio']
        tabela = request.POST['tabela']
        data_hora_importacao = request.POST['data_hora_importacao']
        arquivo = request.FILES['arquivo']
        remessa = REMESSAS.objects.create(descricao_arquivo=descricao_arquivo, ano_base=ano_base,
                                          ano_exercicio=ano_exercicio,
                                          tabela=tabela, data_hora_importacao=data_hora_importacao, arquivo=arquivo)
        remessa.save()
        return redirect('index')
    return render(request, 'remessas_novo.html')


@login_required
def tabela_listagem(request):
    if not request.user.is_staff:
        return redirect('index')
    page = request.GET.get('page', '')
    try:
        remessa = REMESSAS.objects.all().order_by('id')
        remessa = Paginator(remessa, 20)
        remessa = remessa.page(page)
    except PageNotAnInteger:
        remessa = remessa.page(1)
    except EmptyPage:
        remessa = paginator.page(paginator.num_pages)
    remessas = {'lista': remessa, 'order': remessa}
    return render(request, 'tabela_listagem.html', remessas)


@login_required
def remessas_remover(request, pk):
    if not request.user.is_staff:
        return redirect('index')
    remessa = REMESSAS.objects.get(pk=pk)
    if request.method == "POST":
        remessa.delete()
        return redirect('tabela_listagem')
    return render(request, 'remessas_remover.html', {'remessa': remessa})


#
# VIEWS RELACIONADAS AOS USUÁRIOS
def criar_usuario(request):
    if request.method == 'POST':
        nome = request.POST['nome']
        username = request.POST['username']
        email = request.POST['email']
        password = request.POST['password']
        user = User.objects.create_user(f"{username}", f"{email}", password=f"{password}")
        user.first_name = nome
        user.is_superuser = True
        user.is_staff = False
        user.is_active = False
        user.save()
        return redirect('criar_usuario_sucesso')
    return render(request, 'criar_usuario.html')


def criar_usuario_sucesso(request):
    return render(request, 'criar_usuario_sucesso.html')


@login_required
def usuario_novo(request):
    if not request.user.is_staff:
        return redirect('index')
    if request.method == "POST":
        first_name = request.POST['first_name']
        username = request.POST['username']
        email = request.POST['email']
        password = request.POST['password']
        tipo = request.POST['tipo_usuario']
        if tipo == "administrador":
            user = User.objects.create_user(f"{username}", f"{email}", password=f"{password}")
            user.first_name = first_name
            user.is_superuser = True
            user.is_staff = True
            user.is_active = True
            user.save()
        elif tipo == "contabilista":
            user = User.objects.create_user(f"{username}", f"{email}", password=f"{password}")
            user.first_name = first_name
            user.is_superuser = True
            user.is_staff = False
            user.is_active = True
            user.save()
        else:
            user = User.objects.create_user(f"{username}", f"{email}", password=f"{password}")
            user.first_name = first_name
            user.is_superuser = False
            user.is_staff = False
            user.is_active = True
            user.save()
        return redirect('/usuario_listar/')

    return render(request, 'usuario_novo.html')


@login_required
def usuario_listar(request):
    if not request.user.is_staff:
        return redirect('index')
    usuarios = User.objects.all()
    usuario = {'lista': usuarios}
    return render(request, 'usuario_listar.html', usuario)


@login_required
def usuario_editar(request, pk):
    if not request.user.is_staff:
        return redirect('index')
    usuario = get_object_or_404(User, pk=pk)

    if request.method == "POST":
        first_name = request.POST['first_name']
        username = request.POST['username']
        email = request.POST['email']
        password = request.POST['password']
        tipo = request.POST['tipo_usuario']
        status = request.POST['status']
        usuario.first_name = first_name
        usuario.username = username
        usuario.email = email
        usuario.password = password
        usuario.tipo = tipo

        if tipo == 'administrador':
            usuario.is_superuser = True
            usuario.is_staff = True
        elif tipo == 'contabilista':
            usuario.is_superuser = True
            usuario.is_staff = False
        else:
            usuario.is_superuser = False
            usuario.is_staff = False
        usuario.status = status
        if status == 'ativo':
            usuario.is_active = True
        else:
            usuario.is_active = False
        usuario.set_password(f"{password}")
        usuario.save(
            update_fields=['first_name', 'username', 'email', 'is_superuser', 'is_staff', 'is_active'])
        return redirect('/usuario_listar/')

    return render(request, 'usuario_editar.html', {'usuario': usuario})


@login_required
def usuario_remover(request, pk):
    if not request.user.is_staff:
        return redirect('index')
    user = request.user
    if user.has_perm('user.delete_user'):
        try:
            usuario = User.objects.get(pk=pk)
            if request.method == "POST":
                usuario.delete()
                return redirect('usuario_listar')
        except:
            return redirect('/usuario_listar/')
    else:
        return redirect('/usuario_listar/')

    return render(request, 'usuario_remover.html', {'usuario': usuario})


#
# VIEWS RELACIONADAS A LOGIN
def logar(request):
    if request.method == "POST":
        username = request.POST['username']
        password = request.POST['password']
        user = authenticate(username=username, password=password)
        if user is not None:
            login(request, user)
            return redirect('index')
    return render(request, 'login.html')


@login_required
def deslogar(request):
    logout(request)
    return HttpResponseRedirect('/')


#
@login_required
# VIEWS DE TABELAS
def GIA_OMISSO(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "mes":
            gia_omisso = Gia_omisso.objects.filter(mes__contains=q)
        elif q and t == "ano_base":
            gia_omisso = Gia_omisso.objects.filter(ano_base__contains=q)
        elif q and t == "cnae":
            gia_omisso = Gia_omisso.objects.filter(cnae__contains=q)
        elif q and t == "contribuinte":
            gia_omisso = Gia_omisso.objects.filter(contribuinte__contains=q)
        elif q and t == "inscricao":
            gia_omisso = Gia_omisso.objects.filter(inscricao__contains=q)
        elif q and t == "municipio":
            gia_omisso = Gia_omisso.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            gia_omisso = Gia_omisso.objects.filter(remessa__contains=q)
        else:
            gia_omisso = Gia_omisso.objects.all()
        remessa = REMESSAS.objects.all()
        gia_omisso = Paginator(gia_omisso, 20)
        gia_omisso = gia_omisso.page(page)
    except PageNotAnInteger:
        gia_omisso = gia_omisso.page(1)
    except EmptyPage:
        gia_omisso = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': gia_omisso}
    return render(request, 'GIA_OMISSO.html', remessas)


@login_required
def import_gia_omisso(request, pk):
    if not request.user.is_staff:
        return redirect('index')
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_gia_omisso', sep=';', columns=(
        'COD', 'MUNICIPIO', 'CNAE', 'CAD', 'INSCRICAO', 'CONTRIBUINTE', 'MES', 'PERIODICIDADE', 'CRC', 'CONTABILISTA',
        'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'gia_omisso_sucesso.html')


@login_required
def CCI(request):
    page = request.GET.get('page')
    t = request.GET.get("t")
    q = request.GET.get("q")
    e = request.GET.get('e')
    r = request.GET.get('r')
    if q:
        q = str(q).upper()
    elif e:
        e = str(e).upper()
    elif r:
        r = str(r).upper()
    elif q and r:
        q = str(q).upper()
        r = str(r).upper()
    elif q and e:
        q = str(q).upper()
        e = str(e).upper()
    elif r and e:
        r = str(r).upper()
        e = str(e).upper()
    elif q and r and e:
        q = str(q).upper()
        r = str(r).upper()
        e = str(e).upper()
    else:
        pass
    remessa = REMESSAS.objects.all()
    try:
        if q and t == "cnae":
            cci = Cci.objects.filter(codg_cnae__contains=q)
        elif q and t == "nome_inscrito":
            cci = Cci.objects.filter(nome_inscrito__contains=q)
        elif q and t == "nome_pessoa":
            cci = Cci.objects.filter(nome_pessoa__contains=q)
        elif q and t == "numr_inscricao_estadual":
            cci = Cci.objects.filter(numr_inscricao_estadual__contains=q)
        elif q and t == "municipio":
            cci = Cci.objects.filter(nome_municipio__contains=q)
        elif q and t == "ano_base":
            cci = Cci.objects.filter(ano_base__contains=q)
        elif e:
            cci = Cci.objects.filter(ano_exercicio__contains=e)
        elif r:
            cci = Cci.objects.filter(remessa__contains=r)
        elif e and r:
            cci = Cci.objects.filter(ano_exercicio__contains=e, remessa__contains=r)
        elif q and e and r and t == "cnae":
            cci = Cci.objects.filter(ano_exercicio__contains=e, remessa__contains=r, cnae__contains=q)
        elif q and e and r and t == "nome_inscrito":
            cci = Cci.objects.filter(ano_exercicio__contains=e, remessa__contains=r, nome_inscrito__contains=q)
        elif q and e and r and t == "nome_pessoa":
            cci = Cci.objects.filter(ano_exercicio__contains=e, remessa__contains=r, nome_pessoa__contains=q)
        elif q and e and r and t == "numr_inscricao_estadual":
            cci = Cci.objects.filter(ano_exercicio__contains=e, remessa__contains=r,
                                     numr_inscricao_estadual__contains=q)
        elif q and e and r and t == "municipio":
            cci = Cci.objects.filter(ano_exercicio__contains=e, remessa__contains=r, nome_municipio__contains=q)
        elif q and e and r and t == "ano_base":
            cci = Cci.objects.filter(ano_exercicio__contains=e, remessa__contains=r, ano_base__contains=q)
        else:
            cci = Cci.objects.all()
        cci = Paginator(cci, 50)
        cci = cci.page(page)

    except PageNotAnInteger:
        cci = cci.page(1)
    except EmptyPage:
        cci = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': cci}
    return render(request, 'CCI.html', remessas)


@login_required
def import_cci(request, pk):
    if not request.user.is_staff:
        return redirect('index')
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_cci', sep=';', columns=(
        'NUMR_INSCRICAO_ESTADUAL', 'NOME_PESSOA', 'NOME_INSCRITO', 'NUMR_DOCUMENTO', 'DESC_DOCUMENTO', 'STATUS',
        'TIPO_INSCRITO', 'SIMPLES_NACIONAL', 'FLAG_MEI', 'DATA_INICIO_ATIVIDADE_SEFAZ', 'CODG_CNAE', 'DESC_CNAE',
        'DESC_SEGMENTO',
        'CODG_MUNICIPIO', 'NOME_MUNICIPIO', 'TIPO_LOGRADOURO_CONTRIBUINTE', 'NOME_LOGRADOURO_CONTRIBUINTE',
        'NUMR_LOGRADOURO_CONTRIBUINTE', 'COMPLEMENTO_CONTRIBUINTE', 'BAIRRO_CONTRIBUINTE', 'DDD_TELEFONE_CONTRIBUINTE',
        'TELEFONE_CONTRIBUINTE', 'DDD_CELULAR_CONTRIBUINTE', 'CELULAR_CONTRIBUINTE', 'EMAIL_CONTRIBUINTE', 'CODG_CRC',
        'NOME_CONTABILISTA', 'MUNICIPIO_CONTABILISTA', 'TIPO_LOGRADOURO_CONTABILISTA', 'NOME_LOGRADOURO_CONTABILISTA',
        'NUMR_LOGRADOURO_CONTABILISTA', 'COMPLEMENTO_CONTABILISTA', 'BAIRRO_CONTABILISTA', 'DDD_TELEFONE_CONTABILISTA',
        'TELEFONE_CONTABILISTA', 'DDD_CELULAR_CONTABILISTA', 'CELULAR_CONTABILISTA', 'EMAIL_CONTABILISTA',
        'PORTE_EMPRESA', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'cci_sucesso.html')


@login_required
def IE(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "nome":
            ie = Ie.objects.filter(nome_pessoa__contains=q)
        elif q and t == "ano_base":
            ie = Ie.objects.filter(ano_base__contains=q)
        elif q and t == "inscricao":
            ie = Ie.objects.filter(numr_inscricao_estadual__contains=q)
        elif q and t == "flag_mei":
            ie = Ie.objects.filter(flag_mei__contains=q)
        elif q and t == "remessa":
            ie = Ie.objects.filter(remessa__contains=q)
        else:
            ie = Ie.objects.all()
        remessa = REMESSAS.objects.all()
        ie = Paginator(ie, 20)
        ie = ie.page(page)
    except PageNotAnInteger:
        ie = ie.page(1)
    except EmptyPage:
        ie = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': ie}
    return render(request, 'IE.html', remessas)


@login_required
def import_ie(request, pk):
    if not request.user.is_staff:
        return redirect('index')
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_ie', sep=';', columns=(
        'NUMR_INSCRICAO_ESTADUAL', 'NOME_PESSOA', 'FLAG_MEI', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'ie_sucesso.html')


@login_required
def NFE_EFD(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "inscricao_remetente":
            nfe_efd = Nfe_efd.objects.filter(ie_remetente__contains=q)
        elif q and t == "nome_remetente":
            nfe_efd = Nfe_efd.objects.filter(nome_remetente__contains=q)
        elif q and t == "cfop":
            nfe_efd = Nfe_efd.objects.filter(cfop__contains=q)
        elif q and t == "municipio_remetente":
            nfe_efd = Nfe_efd.objects.filter(municipio_remetente__contains=q)
        elif q and t == "inscricao_adquirente":
            nfe_efd = Nfe_efd.objects.filter(ie_adquirente__contains=q)
        elif q and t == "nome_adquirente":
            nfe_efd = Nfe_efd.objects.filter(nome_adquirente__contains=q)
        elif q and t == "municipio_adquirente":
            nfe_efd = Nfe_efd.objects.filter(municipio_adquirente__contains=q)
        elif q and t == "remessa":
            nfe_efd = Nfe_efd.objects.filter(remessa__contains=q)
        else:
            nfe_efd = Nfe_efd.objects.all()
        remessa = REMESSAS.objects.all()
        nfe_efd = Paginator(nfe_efd, 20)
        nfe_efd = nfe_efd.page(page)
    except PageNotAnInteger:
        nfe_efd = nfe_efd.page(1)
    except EmptyPage:
        nfe_efd = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': nfe_efd}
    return render(request, 'NFE_EFD.html', remessas)


@login_required
def import_nfe_efd(request, pk):
    if not request.user.is_staff:
        return redirect('index')
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_nfe_efd', sep=';', columns=(
        'IE_REMETENTE', 'NOME_REMETENTE', 'COD', 'MUNICIPIO_REMETENTE', 'IE_ADQUIRENTE', 'NOME_ADQUIRENTE', 'CODG',
        'MUNICIPIO_ADQUIRENTE', 'NRO_NF', 'TIPO_DOC', 'MOD', 'EMISSAO', 'CFOP', 'VALOR_NF', 'REMESSA', 'DESCRICAO',
        'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'nfe_efd_sucesso.html')


@login_required
def REG_1400_EFD(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "inscricao":
            reg_1400_efd = Reg_1400_efd.objects.filter(inscricao__contains=q)
        elif q and t == "ano_base":
            reg_1400_efd = Reg_1400_efd.objects.filter(ano_base__contains=q)
        elif q and t == "contribuinte":
            reg_1400_efd = Reg_1400_efd.objects.filter(contribuinte__contains=q)
        elif q and t == "municipio":
            reg_1400_efd = Reg_1400_efd.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            reg_1400_efd = Reg_1400_efd.objects.filter(remessa__contains=q)
        else:
            reg_1400_efd = Reg_1400_efd.objects.all()
        remessa = REMESSAS.objects.all()
        reg_1400_efd = Paginator(reg_1400_efd, 20)
        reg_1400_efd = reg_1400_efd.page(page)
    except PageNotAnInteger:
        reg_1400_efd = reg_1400_efd.page(1)
    except EmptyPage:
        reg_1400_efd = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': reg_1400_efd}
    return render(request, 'REG_1400_EFD.html', remessas)


@login_required
def import_reg_1400_efd(request, pk):
    if not request.user.is_staff:
        return redirect('index')
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_reg_1400_efd', sep=';', columns=(
        'INSCRICAO', 'CONTRIBUINTE', 'COD', 'MUNICIPIO', 'DT_INICIAL', 'DT_FINAL', 'CODG', 'MUNICIPIO_REG_1400',
        'VR_REG_1400', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'reg_1400_efd_sucesso.html')


@login_required
def CAP(request):
    page = request.GET.get('page')
    t = request.GET.get("t")
    q = request.GET.get("q")
    e = request.GET.get('e')
    r = request.GET.get('r')
    if q:
        q = str(q).upper()
    elif e:
        e = str(e).upper()
    elif r:
        r = str(r).upper()
    elif q and r:
        q = str(q).upper()
        r = str(r).upper()
    elif q and e:
        q = str(q).upper()
        e = str(e).upper()
    elif r and e:
        r = str(r).upper()
        e = str(e).upper()
    elif q and r and e:
        q = str(q).upper()
        r = str(r).upper()
        e = str(e).upper()
    else:
        pass
    remessa = REMESSAS.objects.all()
    try:
        if q and t == "cnae":
            cap = Cap.objects.filter(codg_cnae__contains=q)
        elif q and t == "nome_inscrito":
            cap = Cap.objects.filter(nome_inscrito__contains=q)
        elif q and t == "nome_pessoa":
            cap = Cap.objects.filter(nome_pessoa__contains=q)
        elif q and t == "numr_inscricao_estadual":
            cap = Cap.objects.filter(numr_inscricao_estadual__contains=q)
        elif q and t == "municipio":
            cap = Cap.objects.filter(nome_municipio__contains=q)
        elif q and t == "ano_base":
            cap = Cap.objects.filter(ano_base__contains=q)
        elif e:
            cap = Cap.objects.filter(ano_exercicio__contains=e)
        elif r:
            cap = Cap.objects.filter(remessa__contains=r)
        elif e and r:
            cap = Cap.objects.filter(ano_exercicio__contains=e, remessa__contains=r)
        elif q and e and r and t == "cnae":
            cap = Cap.objects.filter(ano_exercicio__contains=e, remessa__contains=r, codg_cnae__contains=q)
        elif q and e and r and t == "nome_inscrito":
            cap = Cap.objects.filter(ano_exercicio__contains=e, remessa__contains=r, nome_inscrito__contains=q)
        elif q and e and r and t == "nome_pessoa":
            cap = Cap.objects.filter(ano_exercicio__contains=e, remessa__contains=r, nome_pessoa__contains=q)
        elif q and e and r and t == "numr_inscricao_estadual":
            cap = Cap.objects.filter(ano_exercicio__contains=e, remessa__contains=r,
                                     numr_inscricao_estadual__contains=q)
        elif q and e and r and t == "municipio":
            cap = Cap.objects.filter(ano_exercicio__contains=e, remessa__contains=r, nome_municipio__contains=q)
        elif q and e and r and t == "ano_base":
            cap = Cap.objects.filter(ano_exercicio__contains=e, remessa__contains=r, ano_base__contains=q)
        else:
            cap = Cap.objects.all()
        cap = Paginator(cap, 50)
        cap = cap.page(page)
    except PageNotAnInteger:
        cap = cap.page(1)
    except EmptyPage:
        cap = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': cap}
    return render(request, 'CAP.html', remessas)


@login_required
def import_cap(request, pk):
    if not request.user.is_staff:
        return redirect('index')
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_cap', sep=';', columns=(
        'NUMR_INSCRICAO_ESTADUAL', 'NOME_PESSOA', 'NOME_INSCRITO', 'NUMR_DOCUMENTO', 'DESC_DOCUMENTO', 'STATUS',
        'TIPO_INSCRITO', 'TIPO_PRODUTOR', 'CODG_CNAE', 'DESC_CNAE', 'DESC_SEGMENTO', 'CODG_MUNICIPIO', 'NOME_MUNICIPIO',
        'TIPO_LOGRADOURO_CONTRIBUINTE', 'NOME_LOGRADOURO_CONTRIBUINTE', 'NUMR_LOGRADOURO_CONTRIBUINTE',
        'COMPLEMENTO_CONTRIBUINTE', 'BAIRRO_CONTRIBUINTE', 'DDD_TELEFONE_CONTRIBUINTE', 'TELEFONE_CONTRIBUINTE',
        'DDD_CELULAR_CONTRIBUINTE', 'CELULAR_CONTRIBUINTE', 'EMAIL_CONTRIBUINTE', 'CODG_CRC', 'NOME_CONTABILISTA',
        'MUNICIPIO_CONTABILISTA', 'TIPO_LOGRADOURO_CONTABILISTA', 'NOME_LOGRADOURO_CONTABILISTA',
        'NUMR_LOGRADOURO_CONTABILISTA', 'COMPLEMENTO_CONTABILISTA', 'BAIRRO_CONTABILISTA', 'DDD_TELEFONE_CONTABILISTA',
        'TELEFONE_CONTABILISTA', 'DDD_CELULAR_CONTABILISTA', 'CELULAR_CONTABILISTA', 'EMAIL_CONTABILISTA', 'REMESSA',
        'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'cap_sucesso.html')


@login_required
def GIA_COP3(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "mes":
            gia_cop3 = Gia_cop3.objects.filter(mes__contains=q)
        elif q and t == "ano_base":
            gia_cop3 = Gia_cop3.objects.filter(ano_base__contains=q)
        elif q and t == "contribuinte":
            gia_cop3 = Gia_cop3.objects.filter(contribuinte__contains=q)
        elif q and t == "inscricao":
            gia_cop3 = Gia_cop3.objects.filter(inscricao__contains=q)
        elif q and t == "municipio":
            gia_cop3 = Gia_cop3.objects.filter(municipio__contains=q)
        elif q and t == "municipio":
            gia_cop3 = Gia_cop3.objects.filter(remessa__contains=q)
        else:
            gia_cop3 = Gia_cop3.objects.all()
        remessa = REMESSAS.objects.all()
        gia_cop3 = Paginator(gia_cop3, 20)
        gia_cop3 = gia_cop3.page(page)
    except PageNotAnInteger:
        gia_cop3 = gia_cop3.page(1)
    except EmptyPage:
        gia_cop3 = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': gia_cop3}
    return render(request, 'GIA_COP3.html', remessas)


@login_required
def import_gia_cop3(request, pk):
    if not request.user.is_staff:
        return redirect('index')
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_gia_cop3', sep=';', columns=(
        'INSCRICAO', 'CONTRIBUINTE', 'ANO_BASE', 'COP', 'SIT', 'MES', 'TIPO', 'CODG', 'MUNICIPIO', 'VR_COP3', 'REMESSA',
        'DESCRICAO', 'ANO_EXERCICIO'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'gia_cop3_sucesso.html')


@login_required
def GIA_ENTRADAS_SAIDAS(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "dt_inicial":
            gia_entradas_saidas = Gia_entradas_saidas.objects.filter(dt_inicial__contains=q)
        elif q and t == "cnae":
            gia_entradas_saidas = Gia_entradas_saidas.objects.filter(cnae__contains=q)
        elif q and t == "contribuinte":
            gia_entradas_saidas = Gia_entradas_saidas.objects.filter(contribuinte__contains=q)
        elif q and t == "inscricao":
            gia_entradas_saidas = Gia_entradas_saidas.objects.filter(inscricao__contains=q)
        elif q and t == "municipio":
            gia_entradas_saidas = Gia_entradas_saidas.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            gia_entradas_saidas = Gia_entradas_saidas.objects.filter(remessa__contains=q)
        else:
            gia_entradas_saidas = Gia_entradas_saidas.objects.all()
        remessa = REMESSAS.objects.all()
        gia_entradas_saidas = Paginator(gia_entradas_saidas, 20)
        gia_entradas_saidas = gia_entradas_saidas.page(page)
    except PageNotAnInteger:
        gia_entradas_saidas = gia_entradas_saidas.page(1)
    except EmptyPage:
        gia_entradas_saidas = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': gia_entradas_saidas}
    return render(request, 'GIA_ENTRADAS_SAIDAS.html', remessas)


@login_required
def import_gia_entradas_saidas(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_gia_entradas_saidas', sep=';', columns=(
        'COD', 'MUNICIPIO', 'INSCRICAO', 'CAD', 'CNAE', 'CONTRIBUINTE', 'DT_INICIAL', 'DT_FINAL', 'TIPO', 'DT_PROCESS',
        'CFOP', 'VR_CONTABIL', 'CRC', 'IE_ANTERIOR', 'BASE_CALCULO', 'ICMS', 'ISENTAS', 'OUTRAS', 'IPI', 'ICMS_ST',
        'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'gia_entradas_saidas_sucesso.html')


@login_required
def GIA_ENTRADAS_SAIDAS_lista_valor_adicionado(request):
    page = request.GET.get('page', '')
    q = request.GET.get("q")
    t = request.GET.get("t")
    if q:
        q = str(q).upper()
    try:
        if q and t == "inscricao":
            lista = Gia_entradas_saidas.objects.filter(inscricao__contains=q)
        elif q and t == "contribuinte":
            lista = Gia_entradas_saidas.objects.filter(contribuinte__contains=q)
        elif q and t == "municipio":
            lista = Gia_entradas_saidas.objects.filter(inscricao__contains=q)
        else:
            lista = Gia_entradas_saidas.objects.all()
        lista = Paginator(lista, 20)
        lista = lista.page(page)
    except PageNotAnInteger:
        lista = lista.page(1)
    except EmptyPage:
        lista = paginator.page(paginator.num_pages)
    listagem = {'lista': lista}
    return render(request, 'GIA_ENTRADAS_SAIDAS_lista_valor_adicionado.html', listagem)


@login_required
def VALOR_ADICIONADO_gia_296_POR_MUNICIPIO(request, municipio):
    q_inicio = request.GET.get("q_inicio")
    q_final = request.GET.get("q_final")
    q_ano = request.GET.get("q_ano")
    q_inicio2 = request.GET.get("q_inicio2")
    q_final2 = request.GET.get("q_final2")
    q_ano2 = request.GET.get("q_ano2")
    with connections['default'].cursor() as cursor:
        if q_inicio and q_final and q_ano:
            mes1 = int(q_inicio)
            mes2 = int(q_final)
            mes2 = mes2 + 1
            ano = str(q_ano)
            filtro = list(range(mes1, mes2))
            datas = [f'{ano}-' + '0' + str(x) + f'-01' if x < 10 else f'01/' + str(x) + f'/{ano}' for x in filtro]
            datas1 = tuple(datas)
            ins = Gia_entradas_saidas.objects.all()
            i = str(municipio)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s;",
                [i, (datas1)])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                [i, (datas1)])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
        elif q_inicio and q_ano:
            mes1 = int(q_inicio)
            ano = int(q_ano)
            if mes1 < 10:
                data = f'{ano}-0{mes1}-01'
            else:
                data = f'{ano}-{mes1}-01'
            data = str(data)
            ins = Gia_entradas_saidas.objects.all()
            i = str(municipio)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s;",
                [i, data])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                [i, data])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
        else:
            ins = Gia_entradas_saidas.objects.all()
            i = str(municipio)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ;",
                [i])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                [i])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)

        if q_inicio2 and q_final2 and q_ano2:
            mes12 = int(q_inicio)
            mes22 = int(q_final)
            mes22 = mes22 + 1
            ano2 = str(q_ano2)
            filtro = list(range(mes12, mes22))
            datas2 = [f'{ano2}-' + '0' + str(x) + f'-01' if x < 10 else f'01/' + str(x) + f'/{ano2}' for x in filtro]
            datas12 = tuple(datas2)
            ins = Gia_entradas_saidas.objects.all()
            i = str(municipio)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s;",
                [i, (datas12)])
            saida2 = namedtuplefetchall(cursor)
            sai1 = str(saida2[0].valor_adicionado_saida)
            if sai1 == 'None':
                saida12 = float(0)
            else:
                saida12 = float(sai1)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                [i, (datas12)])
            entrada2 = namedtuplefetchall(cursor)
            ent1 = str(entrada2[0].valor_adicionado_entrada)
            if ent1 == 'None':
                entrada12 = float(0)
            else:
                entrada12 = float(ent1)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada12 >= saida12 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada12 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes = namedtuplefetchall(cursor)
        elif q_inicio2 and q_ano2:
            mes12 = int(q_inicio2)
            ano2 = int(q_ano2)
            if mes12 < 10:
                data1 = f'{ano2}-0{mes12}-01'
            else:
                data1 = f'{ano2}-{mes12}-01'
            data1 = str(data1)
            ins = Gia_entradas_saidas.objects.all()
            i = str(municipio)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s;",
                [i, data1])
            saida2 = namedtuplefetchall(cursor)
            sai1 = str(saida2[0].valor_adicionado_saida)
            if sai1 == 'None':
                saida12 = float(0)
            else:
                saida12 = float(sai1)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                [i, data2])
            entrada2 = namedtuplefetchall(cursor)
            ent1 = str(entrada2[0].valor_adicionado_entrada)
            if ent1 == 'None':
                entrada12 = float(0)
            else:
                entrada12 = float(ent1)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 >= saida12 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada12 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
        else:
            ins = Gia_entradas_saidas.objects.all()
            i = str(municipio)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ;",
                [i])
            saida2 = namedtuplefetchall(cursor)
            sai1 = str(saida2[0].valor_adicionado_saida)
            if sai1 == 'None':
                saida12 = float(0)
            else:
                saida12 = float(sai1)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                [i])
            entrada2 = namedtuplefetchall(cursor)
            ent1 = str(entrada2[0].valor_adicionado_entrada)
            if ent1 == 'None':
                entrada12 = float(0)
            else:
                entrada12 = float(ent1)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 >= saida12 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada12 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
    return render(request, 'VALOR_ADICIONADO_gia_296_POR_MUNICIPIO.html', {'lista': inscricoes, 'order': inscricoes2})


@login_required
def VALOR_ADICIONADO_gia_296(request, inscricao):
    q_inicio = request.GET.get("q_inicio")
    q_final = request.GET.get("q_final")
    q_ano = request.GET.get("q_ano")
    q_inicio2 = request.GET.get("q_inicio2")
    q_final2 = request.GET.get("q_final2")
    q_ano2 = request.GET.get("q_ano2")
    with connections['default'].cursor() as cursor:
        if q_inicio and q_final and q_ano:
            mes1 = int(q_inicio)
            mes2 = int(q_final)
            mes2 = mes2 + 1
            ano = str(q_ano)
            filtro = list(range(mes1, mes2))
            datas = [f'01/' + '0' + str(x) + f'{ano}' if x < 10 else f'01/' + str(x) + f'/{ano}' for x in filtro]
            datas1 = tuple(datas)
            ins = Gia_entradas_saidas.objects.all()
            i = str(inscricao)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s;",
                [i, (datas1)])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                [i, (datas1)])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
        elif q_inicio and q_ano:
            mes1 = int(q_inicio)
            ano = int(q_ano)
            if mes1 < 10:
                data = f'01/0{mes1}/{ano}'
            else:
                data = f'01/{mes1}/{ano}'
            data = str(data)
            ins = Gia_entradas_saidas.objects.all()
            i = str(inscricao)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s;",
                [i, data])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                [i, data])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
        else:
            ins = Gia_entradas_saidas.objects.all()
            i = str(inscricao)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ;",
                [i])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                [i])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)

        if q_inicio2 and q_final2 and q_ano2:
            mes12 = int(q_inicio)
            mes22 = int(q_final)
            mes22 = mes22 + 1
            ano2 = str(q_ano2)
            filtro = list(range(mes12, mes22))
            datas2 = [f'01/' + '0' + str(x) + f'{ano2}' if x < 10 else f'01/' + str(x) + f'/{ano2}' for x in filtro]
            datas12 = tuple(datas2)
            ins = Gia_entradas_saidas.objects.all()
            i = str(inscricao)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s;",
                [i, (datas12)])
            saida2 = namedtuplefetchall(cursor)
            sai1 = str(saida2[0].valor_adicionado_saida)
            if sai1 == 'None':
                saida12 = float(0)
            else:
                saida12 = float(sai1)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                [i, (datas12)])
            entrada2 = namedtuplefetchall(cursor)
            ent1 = str(entrada2[0].valor_adicionado_entrada)
            if ent1 == 'None':
                entrada12 = float(0)
            else:
                entrada12 = float(ent1)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada12 >= saida12 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada12 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes = namedtuplefetchall(cursor)
        elif q_inicio2 and q_ano2:
            mes12 = int(q_inicio2)
            ano2 = int(q_ano2)
            if mes12 < 10:
                data1 = f'01/0{mes12}/{ano2}'
            else:
                data1 = f'01/{mes12}/{ano2}'
            data1 = str(data1)
            ins = Gia_entradas_saidas.objects.all()
            i = str(inscricao)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s;",
                [i, data1])
            saida2 = namedtuplefetchall(cursor)
            sai1 = str(saida2[0].valor_adicionado_saida)
            if sai1 == 'None':
                saida12 = float(0)
            else:
                saida12 = float(sai1)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                [i, data2])
            entrada2 = namedtuplefetchall(cursor)
            ent1 = str(entrada2[0].valor_adicionado_entrada)
            if ent1 == 'None':
                entrada12 = float(0)
            else:
                entrada12 = float(ent1)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 >= saida12 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada12 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
        else:
            ins = Gia_entradas_saidas.objects.all()
            i = str(inscricao)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ;",
                [i])
            saida2 = namedtuplefetchall(cursor)
            sai1 = str(saida2[0].valor_adicionado_saida)
            if sai1 == 'None':
                saida12 = float(0)
            else:
                saida12 = float(sai1)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                [i])
            entrada2 = namedtuplefetchall(cursor)
            ent1 = str(entrada2[0].valor_adicionado_entrada)
            if ent1 == 'None':
                entrada12 = float(0)
            else:
                entrada12 = float(ent1)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 >= saida12 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada12 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
    return render(request, 'VALOR_ADICIONADO_gia_296.html', {'lista': inscricoes, 'order': inscricoes2})


@login_required
def NFE_e(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "ie_remetente":
            nfe_e = Nfe_e.objects.filter(ie_remetente__contains=q)
        elif q and t == "nome":
            nfe_e = Nfe_e.objects.filter(nome_do_produtor__contains=q)
        elif q and t == "municipio":
            nfe_e = Nfe_e.objects.filter(municipio_do_produtor__contains=q)
        elif q and t == "ie_adquirente":
            nfe_e = Nfe_e.objects.filter(ie_adquirente__contains=q)
        elif q and t == "nome_adquirente":
            nfe_e = Nfe_e.objects.filter(nome_adquirente__contains=q)
        elif q and t == "mun_adquirente":
            nfe_e = Nfe_e.objects.filter(mun_adquirente__contains=q)
        elif q and t == "remessa":
            nfe_e = Nfe_e.objects.filter(remessa__contains=q)
        else:
            nfe_e = Nfe_e.objects.all()
        remessa = REMESSAS.objects.all()
        nfe_e = Paginator(nfe_e, 20)
        nfe_e = nfe_e.page(page)
    except PageNotAnInteger:
        nfe_e = nfe_e.page(1)
    except EmptyPage:
        nfe_e = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': nfe_e}
    return render(request, 'NFE_e.html', remessas)


@login_required
def import_nfe_e(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_nfe_e', sep=';', columns=(
        'IE_REMETENTE', 'NOME_DO_PRODUTOR', 'COD', 'MUNICIPIO_DO_PRODUTOR', 'IE_ADQUIRENTE', 'NOME_ADQUIRENTE',
        'MUN_ADQUIRENTE', 'N_NF_e', 'EMISSAO_NF_e', 'CFOP', 'VR_NF_e', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO',
        'ANO_BASE',
    ))
    db.commit()
    st.close()
    db.close()
    return render(request, 'nfe_e_sucesso.html')


@login_required
def ACYPR535(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "municipio":
            acypr535 = Acypr535.objects.filter(municipio__contains=q)
        elif q and t == "ano_base":
            acypr535 = Acypr535.objects.filter(ano_base__contains=q)
        elif q and t == "populacao":
            acypr535 = Acypr535.objects.filter(populacao__contains=q)
        elif q and t == "remessa":
            acypr535 = Acypr535.objects.filter(remessa__contains=q)
        else:
            acypr535 = Acypr535.objects.all()
        remessa = REMESSAS.objects.all()
        acypr535 = Paginator(acypr535, 20)
        acypr535 = acypr535.page(page)
    except PageNotAnInteger:
        acypr535 = acypr535.page(1)
    except EmptyPage:
        acypr535 = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': acypr535}
    return render(request, 'ACYPR535.html', remessas)


@login_required
def import_acypr535(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_acypr535', sep=';', columns=(
        'MUNICIPIO', 'IVA_ANT', 'IVA_ATUAL', 'IVA_MED', 'IVA_75', 'UCTI', 'TRIB_PROPR', 'POPULACAO', 'AREA', 'COEF_SOC',
        'IND_FINAL', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'acypr535_sucesso.html')


@login_required
def ACYPR540(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "cod":
            acypr540 = Acypr540.objects.filter(cod__contains=q)
        elif q and t == "municipio":
            acypr540 = Acypr540.objects.filter(municipio__contains=q)
        elif q and t == "ipm_ano_base":
            acypr540 = Acypr540.objects.filter(ipm_ano_base__contains=q)
        elif q and t == "ipm_ano_exercicio":
            acypr540 = Acypr540.objects.filter(ipm_ano_exercicio__contains=q)
        elif q and t == "remessa":
            acypr540 = Acypr540.objects.filter(remessa__contains=q)
        else:
            acypr540 = Acypr540.objects.all()
        remessa = REMESSAS.objects.all()
        acypr540 = Paginator(acypr540, 20)
        acypr540 = acypr540.page(page)
    except PageNotAnInteger:
        acypr540 = acypr540.page(1)
    except EmptyPage:
        acypr540 = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': acypr540}
    return render(request, 'ACYPR540.html', remessas)


@login_required
def import_acypr540(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_acypr540', sep=';',
                 columns=(
                     'COD', 'MUNICIPIO', 'IPM_ANO_BASE', 'IPM_ANO_EXERCICIO', 'PORCENTAGEM', 'REMESSA', 'DESCRICAO',
                     'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'acypr540_sucesso.html')


@login_required
def ACYPR555(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "ano_base":
            acypr555 = Acypr555.objects.filter(ano_base__contains=q)
        elif q and t == "cnae":
            acypr555 = Acypr555.objects.filter(cnae__contains=q)
        elif q and t == "contribuinte":
            acypr555 = Acypr555.objects.filter(contribuinte__contains=q)
        elif q and t == "inscricao":
            acypr555 = Acypr555.objects.filter(inscricao__contains=q)
        elif q and t == "municipio":
            acypr555 = Acypr555.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            acypr555 = Acypr555.objects.filter(remessa__contains=q)
        else:
            acypr555 = Acypr555.objects.all()
        remessa = REMESSAS.objects.all()
        acypr555 = Paginator(acypr555, 20)
        acypr555 = acypr555.page(page)
    except PageNotAnInteger:
        acypr555 = acypr555.page(1)
    except EmptyPage:
        acypr555 = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': acypr555}
    return render(request, 'ACYPR555.html', remessas)


@login_required
def import_acypr555(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_acypr555', sep=';', columns=(
        'TIPO_CONTRIB', 'COD', 'INSCRICAO', 'CNAE', 'MUNICIPIO', 'CONTRIBUINTE', 'VR_ADICIONADO', 'ENTRADAS', 'SAIDAS',
        'ST_ENTRADAS', 'ST_SAIDAS', 'IPI_ENTRADAS', 'IPI_SAIDAS', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'acypr555_sucesso.html')


@login_required
def ACYPR556(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "codigo":
            acypr556 = Acypr556.objects.filter(codigo__contains=q)
        elif q and t == "populacao":
            acypr556 = Acypr556.objects.filter(populacao__contains=q)
        elif q and t == "ano_base":
            acypr556 = Acypr556.objects.filter(ano_base__contains=q)
        elif q and t == "municipio":
            acypr556 = Acypr556.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            acypr556 = Acypr556.objects.filter(remessa__contains=q)
        else:
            acypr556 = Acypr556.objects.all()
        remessa = REMESSAS.objects.all()
        acypr556 = Paginator(acypr556, 20)
        acypr556 = acypr556.page(page)
    except PageNotAnInteger:
        acypr556 = acypr556.page(1)
    except EmptyPage:
        acypr556 = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': acypr556}
    return render(request, 'ACYPR556.html', remessas)


@login_required
def import_acypr556(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_acypr556', sep=';', columns=(
        'CODIGO', 'MUNICIPIO', 'VR_ADIC_ANO_BASE', 'VR_ADIC_ANO_EXERCICIO', 'RECEITA_PROPRIA', 'POPULACAO', 'AREA',
        'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'acypr556_sucesso.html')


@login_required
def ACYPR557(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "cod":
            acypr557 = Acypr557.objects.filter(cod__contains=q)
        elif q and t == "cnae":
            acypr557 = Acypr557.objects.filter(cnae__contains=q)
        elif q and t == "contribuinte":
            acypr557 = Acypr557.objects.filter(contribuinte__contains=q)
        elif q and t == "inscricao":
            acypr557 = Acypr557.objects.filter(inscricao__contains=q)
        elif q and t == "municipio":
            acypr557 = Acypr557.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            acypr557 = Acypr557.objects.filter(remessa__contains=q)
        else:
            acypr557 = Acypr557.objects.all()
        remessa = REMESSAS.objects.all()
        acypr557 = Paginator(acypr557, 20)
        acypr557 = acypr557.page(page)
    except PageNotAnInteger:
        acypr557 = acypr557.page(1)
    except EmptyPage:
        acypr557 = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': acypr557}
    return render(request, 'ACYPR557.html', remessas)


@login_required
def import_acypr557(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_acypr557', sep=';', columns=(
        'TIPO_CONTRIB', 'COD', 'INSCRICAO', 'CNAE', 'MUNICIPIO', 'CONTRIBUINTE', 'VR_ADICIONADO', 'ENTRADAS', 'SAIDAS',
        'ST_ENTRADAS', 'ST_SAIDAS', 'IPI_ENTRADAS', 'IPI_SAIDAS', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'acypr557_sucesso.html')


@login_required
def ACYPR600(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "municipio":
            acypr600 = Acypr600.objects.filter(municipio__contains=q)
        elif q and t == "ano_base":
            acypr600 = Acypr600.objects.filter(ano_base__contains=q)
        elif q and t == "remessa":
            acypr600 = Acypr600.objects.filter(remessa__contains=q)
        else:
            acypr600 = Acypr600.objects.all()
        remessa = REMESSAS.objects.all()
        acypr600 = Paginator(acypr600, 20)
        acypr600 = acypr600.page(page)
    except PageNotAnInteger:
        acypr600 = acypr600.page(1)
    except EmptyPage:
        acypr600 = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': acypr600}
    return render(request, 'ACYPR600.html', remessas)


@login_required
def import_acypr600(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_acypr600', sep=';', columns=(
        'MUNICIPIO', 'COM_IND', 'PROD_RURAL', 'PREST_SERV', 'DAR_1_AUT', 'NAI', 'CREDITO_EX_OFF', 'DEBITO_EX_OFF',
        'TOTAL', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'acypr600_sucesso.html')


@login_required
def CRED(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "cod":
            cred = Cred.objects.filter(data__contains=q)
        elif q and t == "contribuinte":
            cred = Cred.objects.filter(contribuinte__contains=q)
        elif q and t == "inscricao":
            cred = Cred.objects.filter(inscricao__contains=q)
        elif q and t == "municipio":
            cred = Cred.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            cred = Cred.objects.filter(remessa__contains=q)
        else:
            cred = Cred.objects.all()
        remessa = REMESSAS.objects.all()
        cred = Paginator(cred, 20)
        cred = cred.page(page)
    except PageNotAnInteger:
        cred = cred.page(1)
    except EmptyPage:
        cred = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': cred}
    return render(request, 'CRED.html', remessas)


@login_required
def import_cred(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_cred', sep=';',
                 columns=(
                     'COD', 'MUNICIPIO', 'INSCRICAO', 'CONTRIBUINTE', 'A_CREDITAR', 'ESPECIFICACAO', 'REMESSA',
                     'DESCRICAO',
                     'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'cred_sucesso.html')


@login_required
def CNAE(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    try:
        if q and t == 'subclasse':
            cnae = Cnae.objects.filter(subclasse__contains=q)
        elif q and t == 'denominacao':
            cnae = Cnae.objects.filter(denominacao__contains=q)
        elif q and t == 'arbitramento':
            cnae = Cnae.objects.filter(arbitramento__contains=q)
        else:
            cnae = Cnae.objects.all()
        remessa = REMESSAS.objects.all()
        cnae = Paginator(cnae, 20)
        cnae = cnae.page(page)
    except PageNotAnInteger:
        cnae = cnae.page(1)
    except EmptyPage:
        cnae = paginator.page(paginator.num_pages)
    remessas = {'lista': remessa, 'order': cnae}
    return render(request, 'CNAE.html', remessas)


@login_required
def import_cnae(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_cnae', sep=';',
                 columns=('SECAO', 'DIVISAO', 'GRUPO', 'CLASSE', 'SUBCLASSE', 'DENOMINACAO', 'ARBITRAMENTO'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'cnae_sucesso.html')


@login_required
def DEB(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "codigo":
            deb = Deb.objects.filter(cod__contains=q)
        elif q and t == "ano_base":
            deb = Deb.objects.filter(ano_base__contains=q)
        elif q and t == "contribuinte":
            deb = Deb.objects.filter(contribuinte__contains=q)
        elif q and t == "inscricao":
            deb = Deb.objects.filter(inscricao__contains=q)
        elif q and t == "municipio":
            deb = Deb.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            deb = Deb.objects.filter(remessa__contains=q)
        else:
            deb = Deb.objects.all()
        remessa = REMESSAS.objects.all()
        deb = Paginator(deb, 20)
        deb = deb.page(page)
    except PageNotAnInteger:
        deb = deb.page(1)
    except EmptyPage:
        deb = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': deb}
    return render(request, 'DEB.html', remessas)


@login_required
def import_deb(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_deb', sep=';',
                 columns=(
                     'COD', 'MUNICIPIO', 'INSCRICAO', 'CONTRIBUINTE', 'A_DEBITAR', 'ESPECIFICACAO', 'REMESSA',
                     'DESCRICAO',
                     'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'deb_sucesso.html')


@login_required
def FPM(request):
    page = request.GET.get('page', '')
    try:
        fpm = Fpm.objects.all()
        remessa = REMESSAS.objects.all()
        fpm = Paginator(fpm, 20)
        fpm = fpm.page(page)
    except PageNotAnInteger:
        fpm = fpm.page(1)
    except EmptyPage:
        fpm = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': fpm}
    return render(request, 'FPM.html', remessas)


@login_required
def import_fpm(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_fpm', sep=';', columns=(
        'ANO', 'JANEIRO', 'FEVEREIRO', 'MARCO', 'ABRIL', 'MAIO', 'JUNHO', 'JULHO', 'AGOSTO', 'SETEMBRO', 'OUTUBRO',
        'NOVEMBRO', 'DEZEMBRO', 'TOTAL', 'VARIACAO'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'fpm_sucesso.html')


@login_required
def GIA_SEM_MOV(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "cod":
            gia_sem_mov = Gia_sem_mov.objects.filter(cod__contains=q)
        elif q and t == "contribuinte":
            gia_sem_mov = Gia_sem_mov.objects.filter(contribuinte__contains=q)
        elif q and t == "inscricao":
            gia_sem_mov = Gia_sem_mov.objects.filter(inscricao__contains=q)
        elif q and t == "municipio":
            gia_sem_mov = Gia_sem_mov.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            gia_sem_mov = Gia_sem_mov.objects.filter(remessa__contains=q)
        else:
            gia_sem_mov = Gia_sem_mov.objects.all()
        remessa = REMESSAS.objects.all()
        gia_sem_mov = Paginator(gia_sem_mov, 20)
        gia_sem_mov = gia_sem_mov.page(page)
    except PageNotAnInteger:
        gia_sem_mov = gia_sem_mov.page(1)
    except EmptyPage:
        gia_sem_mov = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': gia_sem_mov}
    return render(request, 'GIA_SEM_MOV.html', remessas)


@login_required
def import_gia_sem_mov(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_gia_sem_mov', sep=';', columns=(
        'COD', 'MUNICIPIO', 'ANO_BASE', 'INSCRICAO', 'CONTRIBUINTE', 'CAD', 'SIT_GIA', 'INF_MOV', 'MES_INICIAL',
        'MES_FINAL', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'gia_sem_mov_sucesso.html')


@login_required
def EFD(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "dt_inicial":
            efd = Efd.objects.filter(dt_inicial__contains=q)
        elif q and t == "cnae":
            efd = Efd.objects.filter(cnae__contains=q)
        elif q and t == "contribuinte":
            efd = Efd.objects.filter(contribuinte__contains=q)
        elif q and t == "inscricao":
            efd = Efd.objects.filter(inscricao__contains=q)
        elif q and t == "municipio":
            efd = Efd.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            efd = Efd.objects.filter(remessa__contains=q)
        else:
            efd = Efd.objects.all()
        remessa = REMESSAS.objects.all()
        efd = Paginator(efd, 20)
        efd = efd.page(page)
    except PageNotAnInteger:
        efd = efd.page(1)
    except EmptyPage:
        efd = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': efd}
    return render(request, 'EFD.html', remessas)


@login_required
def VALOR_ADICIONADO_efd_418_POR_MUNICIPIO(request, municipio):
    q_inicio = request.GET.get("q_inicio")
    q_final = request.GET.get("q_final")
    q_ano = request.GET.get("q_ano")
    q_inicio2 = request.GET.get("q_inicio2")
    q_final2 = request.GET.get("q_final2")
    q_ano2 = request.GET.get("q_ano2")
    with connections['default'].cursor() as cursor:
        if q_inicio and q_final and q_ano:
            mes1 = int(q_inicio)
            mes2 = int(q_final)
            mes2 = mes2 + 1
            ano = str(q_ano)
            filtro = list(range(mes1, mes2))
            datas = [f'01/' + '0' + str(x) + f'{ano}' if x < 10 else f'01/' + str(x) + f'{ano}' for x in filtro]
            datas1 = tuple(datas)
            ins = Efd.objects.all()
            i = str(municipio)
            # INSERIR DATAS AQUI
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s ;",
                [i, (datas1)])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                [i, (datas1)])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s ) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s ;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s ;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
        elif q_inicio and q_ano:
            mes1 = int(q_inicio)
            ano = int(q_ano)
            if mes1 < 10:
                data = f'01/0{mes1}/{ano}'
            else:
                data = f'01/{mes1}/{ano}'
            data = str(data)
            ins = Efd.objects.all()
            i = str(municipio)
            # INSERIR DATAS AQUI
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s ;",
                [i, data])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s ;",
                [i, data])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], municipio=i, ):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s ;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s ;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
        else:
            ins = Efd.objects.all()
            i = str(municipio)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ;",
                [i])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                [i])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)

        if q_inicio2 and q_final2 and q_ano2:
            mes11 = int(q_inicio2)
            mes22 = int(q_final2)
            mes22 = mes22 + 1
            ano1 = str(q_ano2)
            filtro = list(range(mes11, mes22))
            datas1 = [f'01/' + '0' + str(x) + f'{ano1}' if x < 10 else f'01/' + str(x) + f'{ano1}' for x in filtro]
            datas12 = tuple(datas1)
            ins = Efd.objects.all()
            i = str(municipio)
            # INSERIR DATAS AQUI
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s ;",
                [i, (datas12)])
            saida2 = namedtuplefetchall(cursor)
            sai1 = str(saida2[0].valor_adicionado_saida)
            if sai1 == 'None':
                saida12 = float(0)
            else:
                saida12 = float(sai1)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                [i, (datas12)])
            entrada2 = namedtuplefetchall(cursor)
            ent1 = str(entrada2[0].valor_adicionado_entrada)
            if ent1 == 'None':
                entrada12 = float(0)
            else:
                entrada12 = float(ent1)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s ) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s ;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 >= saida12 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada12 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s ;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
        elif q_inicio2 and q_ano2:
            mes12 = int(q_inicio2)
            ano1 = int(q_ano2)
            if mes12 < 10:
                data1 = f'01/0{mes12}/{ano1}'
            else:
                data1 = f'01/0{mes12}/{ano1}'
            data1 = str(data1)
            ins = Efd.objects.all()
            i = str(municipio)
            # INSERIR DATAS AQUI
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s ;",
                [i, data1])
            saida2 = namedtuplefetchall(cursor)
            sai1 = str(saida2[0].valor_adicionado_saida)
            if sai1 == 'None':
                saida12 = float(0)
            else:
                saida12 = float(sai1)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s ;",
                [i, data1])
            entrada2 = namedtuplefetchall(cursor)
            ent1 = str(entrada2[0].valor_adicionado_entrada)
            if ent1 == 'None':
                entrada12 = float(0)
            else:
                entrada12 = float(ent1)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], municipio=i,
                    dt_inicial=data):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s ;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], municipio=i, dt_inicial=data):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s ;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 >= saida12 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i, dt_inicial=data):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada12 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
        else:
            ins = Efd.objects.all()
            i = str(municipio)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ;",
                [i])
            saida2 = namedtuplefetchall(cursor)
            sai1 = str(saida2[0].valor_adicionado_saida)
            if sai1 == 'None':
                saida12 = float(0)
            else:
                saida12 = float(sai1)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                [i])
            entrada2 = namedtuplefetchall(cursor)
            ent1 = str(entrada2[0].valor_adicionado_entrada)
            if ent1 == 'None':
                entrada12 = float(0)
            else:
                entrada12 = float(ent1)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 >= saida12 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada12 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND municipio = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND municipio =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
    return render(request, 'VALOR_ADICIONADO_efd_418_POR_MUNICIPIO.html', {'lista': inscricoes, 'order': inscricoes2})


@login_required
def EFD_lista_valor_adicionado(request):
    page = request.GET.get('page', '')
    q = request.GET.get("q")
    t = request.GET.get("t")
    if q:
        q = str(q).upper()
    try:

        if q and t == "inscricao":
            lista = Efd.objects.filter(inscricao__contains=q)

        elif q and t == "contribuinte":
            lista = Efd.objects.filter(contribuinte__contains=q)
        elif q and t == "municipio":
            lista = Efd.objects.filter(municipio__contains=q)
        else:
            lista = Efd.objects.all()
        lista = Paginator(lista, 20)
        lista = lista.page(page)
    except PageNotAnInteger:
        lista = lista.page(1)
    except EmptyPage:
        lista = paginator.page(paginator.num_pages)
    listagem = {'lista': lista}
    return render(request, 'EFD_lista_valor_adicionado.html', listagem)


@login_required
def import_efd(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_efd', sep=';', columns=(
        'COD', 'MUNICIPIO', 'CAD', 'INSCRICAO', 'CNAE', 'CONTRIBUINTE', 'DT_INICIAL', 'DT_FINAL', 'CFOP', 'VR_CONTABIL',
        'IPI', 'ICMS_ST', 'CRC', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'efd_sucesso.html')


@login_required
def VALOR_ADICIONADO_efd_418(request, inscricao):
    q_inicio = request.GET.get("q_inicio")
    q_final = request.GET.get("q_final")
    q_ano = request.GET.get("q_ano")
    q_inicio2 = request.GET.get("q_inicio2")
    q_final2 = request.GET.get("q_final2")
    q_ano2 = request.GET.get("q_ano2")
    with connections['default'].cursor() as cursor:
        if q_inicio and q_final and q_ano:
            mes1 = int(q_inicio)
            mes2 = int(q_final)
            mes2 = mes2 + 1
            ano = str(q_ano)
            filtro = list(range(mes1, mes2))
            datas = [f'{ano}-' + '0' + str(x) + f'-01' if x < 10 else f'{ano}-' + str(x) + f'-01' for x in filtro]
            datas1 = tuple(datas)
            ins = Efd.objects.all()
            i = str(inscricao)
            # INSERIR DATAS AQUI
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s ;",
                [i, (datas1)])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                [i, (datas1)])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s ) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s ;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s ;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas1), i, (datas1)])
                    inscricoes = namedtuplefetchall(cursor)
        elif q_inicio and q_ano:
            mes1 = int(q_inicio)
            ano = int(q_ano)
            if mes1 < 10:
                data = f'{ano}-0{mes1}-01'
            else:
                data = f'{ano}-{mes1}-01'
            data = str(data)
            ins = Efd.objects.all()
            i = str(inscricao)
            # INSERIR DATAS AQUI
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s ;",
                [i, data])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s ;",
                [i, data])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], inscricao=i,
                    dt_inicial=data):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s ;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], inscricao=i, dt_inicial=data):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s ;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i, dt_inicial=data):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data, i, data])
                    inscricoes = namedtuplefetchall(cursor)
        else:
            ins = Efd.objects.all()
            i = str(inscricao)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ;",
                [i])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                [i])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes = namedtuplefetchall(cursor)

        if q_inicio2 and q_final2 and q_ano2:
            mes11 = int(q_inicio2)
            mes22 = int(q_final2)
            mes22 = mes22 + 1
            ano1 = str(q_ano2)
            filtro = list(range(mes11, mes22))
            datas1 = [f'{ano1}-' + '0' + str(x) + f'-01' if x < 10 else f'{ano1}-' + str(x) + f'-01' for x in filtro]
            datas12 = tuple(datas1)
            ins = Efd.objects.all()
            i = str(inscricao)
            # INSERIR DATAS AQUI
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s ;",
                [i, (datas12)])
            saida2 = namedtuplefetchall(cursor)
            sai1 = str(saida2[0].valor_adicionado_saida)
            if sai1 == 'None':
                saida12 = float(0)
            else:
                saida12 = float(sai1)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                [i, (datas12)])
            entrada2 = namedtuplefetchall(cursor)
            ent1 = str(entrada2[0].valor_adicionado_entrada)
            if ent1 == 'None':
                entrada12 = float(0)
            else:
                entrada12 = float(ent1)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s ) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s ;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 >= saida12 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada12 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s ;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s;",
                        [i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s) AS valor_adicionado;",
                        [i, (datas12), i, (datas12)])
                    inscricoes2 = namedtuplefetchall(cursor)
        elif q_inicio2 and q_ano2:
            mes12 = int(q_inicio2)
            ano1 = int(q_ano2)
            if mes12 < 10:
                data1 = f'{ano1}-0{mes12}-01'
            else:
                data1 = f'{ano1}-{mes12}-01'
            data1 = str(data1)
            ins = Efd.objects.all()
            i = str(inscricao)
            # INSERIR DATAS AQUI
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s ;",
                [i, data1])
            saida2 = namedtuplefetchall(cursor)
            sai1 = str(saida2[0].valor_adicionado_saida)
            if sai1 == 'None':
                saida12 = float(0)
            else:
                saida12 = float(sai1)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s ;",
                [i, data1])
            entrada2 = namedtuplefetchall(cursor)
            ent1 = str(entrada2[0].valor_adicionado_entrada)
            if ent1 == 'None':
                entrada12 = float(0)
            else:
                entrada12 = float(ent1)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], inscricao=i,
                    dt_inicial=data):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s ;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], inscricao=i, dt_inicial=data):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s ;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 >= saida12 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i, dt_inicial=data):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada12 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial = %s;",
                        [i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial = %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial = %s) AS valor_adicionado;",
                        [i, data1, i, data1])
                    inscricoes2 = namedtuplefetchall(cursor)
        else:
            ins = Efd.objects.all()
            i = str(inscricao)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ;",
                [i])
            saida2 = namedtuplefetchall(cursor)
            sai1 = str(saida2[0].valor_adicionado_saida)
            if sai1 == 'None':
                saida12 = float(0)
            else:
                saida12 = float(sai1)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                [i])
            entrada2 = namedtuplefetchall(cursor)
            ent1 = str(entrada2[0].valor_adicionado_entrada)
            if ent1 == 'None':
                entrada12 = float(0)
            else:
                entrada12 = float(ent1)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102', '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406', '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301', '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300', '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804',
                              '159899'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 >= saida12 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada12 > saida12 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada12 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida12 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s ;",
                        [i])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s ) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s ) AS valor_adicionado;",
                        [i, i])
                    inscricoes2 = namedtuplefetchall(cursor)
    return render(request, 'VALOR_ADICIONADO_efd_418.html', {'lista': inscricoes, 'order': inscricoes2})


@login_required
def EFD_OMISSO(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "mes":
            efd_omisso = Efd_omisso.objects.filter(mes__contains=q)
        elif q and t == "cod":
            efd_omisso = Efd_omisso.objects.filter(cod__contains=q)
        elif q and t == "contribuinte":
            efd_omisso = Efd_omisso.objects.filter(contribuinte__contains=q)
        elif q and t == "inscricao":
            efd_omisso = Efd_omisso.objects.filter(inscricao__contains=q)
        elif q and t == "municipio":
            efd_omisso = Efd_omisso.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            efd_omisso = Efd_omisso.objects.filter(remessa__contains=q)
        else:
            efd_omisso = Efd_omisso.objects.all()
        remessa = REMESSAS.objects.all()
        efd_omisso = Paginator(efd_omisso, 20)
        efd_omisso = efd_omisso.page(page)
    except PageNotAnInteger:
        efd_omisso = efd_omisso.page(1)
    except EmptyPage:
        efd_omisso = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': efd_omisso}
    return render(request, 'EFD_OMISSO.html', remessas)


@login_required
def import_efd_omisso(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_efd_omisso', sep=';',
                 columns=('COD', 'MUNICIPIO', 'INSCRICAO', 'CNPJ', 'CONTRIBUINTE', 'MES', 'REMESSA', 'DESCRICAO',
                          'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'efd_omisso_sucesso.html')


@login_required
def EFD_SEM_MOV(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "num_efd":
            efd_sem_mov = Efd_sem_mov.objects.filter(num_efd__contains=q)
        elif q and t == "cod":
            efd_sem_mov = Efd_sem_mov.objects.filter(cod__contains=q)
        elif q and t == "contribuinte":
            efd_sem_mov = Efd_sem_mov.objects.filter(contribuinte__contains=q)
        elif q and t == "inscricao":
            efd_sem_mov = Efd_sem_mov.objects.filter(inscricao__contains=q)
        elif q and t == "municipio":
            efd_sem_mov = Efd_sem_mov.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            efd_sem_mov = Efd_sem_mov.objects.filter(remessa__contains=q)
        else:
            efd_sem_mov = Efd_sem_mov.objects.all()
        remessa = REMESSAS.objects.all()
        efd_sem_mov = Paginator(efd_sem_mov, 20)
        efd_sem_mov = efd_sem_mov.page(page)
    except PageNotAnInteger:
        efd_sem_mov = efd_sem_mov.page(1)
    except EmptyPage:
        efd_sem_mov = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': efd_sem_mov}
    return render(request, 'EFD_SEM_MOV.html', remessas)


@login_required
def import_efd_sem_mov(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_efd_sem_mov', sep=';',
                 columns=(
                     'NUM_EFD', 'INSCRICAO', 'CPF_CNPJ', 'CONTRIBUINTE', 'COD', 'MUNICIPIO', 'MES', 'REMESSA',
                     'DESCRICAO',
                     'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'efd_sem_mov_sucesso.html')


@login_required
def ACGPT812(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "ie_remetente":
            acgpt812 = Acgpt812.objects.filter(ie_remetente__contains=q)
        elif q and t == "nome_remetente":
            acgpt812 = Acgpt812.objects.filter(nome_remetente__contains=q)
        elif q and t == "mun_remetente":
            acgpt812 = Acgpt812.objects.filter(mun_remetente__contains=q)
        elif q and t == "ie_destinatario":
            acgpt812 = Acgpt812.objects.filter(ie_destinatario__contains=q)
        elif q and t == "nome_destinatario":
            acgpt812 = Acgpt812.objects.filter(nome_destinatario__contains=q)
        elif q and t == "mun_destinatario":
            acgpt812 = Acgpt812.objects.filter(mun_destinatario__contains=q)
        elif q and t == "remessa":
            acgpt812 = Acgpt812.objects.filter(remessa__contains=q)
        else:
            acgpt812 = Acgpt812.objects.all()
        remessa = REMESSAS.objects.all()
        acgpt812 = Paginator(acgpt812, 20)
        acgpt812 = acgpt812.page(page)
    except PageNotAnInteger:
        acgpt812 = acgpt812.page(1)
    except EmptyPage:
        acgpt812 = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': acgpt812}
    return render(request, 'ACGPT812.html', remessas)


@login_required
def import_acgpt812(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_acgpt812', sep=';', columns=(
        'IE_REMETENTE', 'IE_SIMPLIFICADA', 'NOME_REMETENTE', 'COD', 'MUN_REMETENTE', 'IE_DESTINATARIO',
        'NOME_DESTINATARIO',
        'CODG', 'MUN_DESTINATARIO', 'NRO_NFPA', 'EMISSAO', 'CFOP', 'VR_NFPA', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO',
        'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'acgpt812_sucesso.html')


@login_required
def PGDAS_D(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "cnae":
            pgdas_d = Pgdas_d.objects.filter(cnae__contains=q)
        elif q and t == "contribuinte":
            pgdas_d = Pgdas_d.objects.filter(contribuinte__contains=q)
        elif q and t == "inscricao":
            pgdas_d = Pgdas_d.objects.filter(inscricao__contains=q)
        elif q and t == "municipio":
            pgdas_d = Pgdas_d.objects.filter(municipio__contains=q)
        elif q and t == "remessa":
            pgdas_d = Pgdas_d.objects.filter(remessa__contains=q)
        else:
            pgdas_d = Pgdas_d.objects.all()
        remessa = REMESSAS.objects.all()
        pgdas_d = Paginator(pgdas_d, 20)
        pgdas_d = pgdas_d.page(page)
    except PageNotAnInteger:
        pgdas_d = pgdas_d.page(1)
    except EmptyPage:
        pgdas_d = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': pgdas_d}
    return render(request, 'PGDAS_D.html', remessas)


@login_required
def import_pgdas_d(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_pgdas_d', sep=';', columns=(
        'TIPO', 'INSCRICAO', 'CNPJ', 'CONTRIBUINTE', 'CNAE', 'COD', 'MUNICIPIO', 'MES', 'RB_TOTAL', 'RB_OUTROS',
        'RB_ICMS', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'pgdas_d_sucesso.html')


@login_required
def ACGPR051(request):
    page = request.GET.get('page', '')
    t = request.GET.get("t")
    q = request.GET.get("q")
    if q:
        q = str(q).upper()
    try:
        if q and t == "inscricao":
            acgpr051 = Acgpr051.objects.filter(inscricao__contains=q)
        elif q and t == "data":
            acgpr051 = Acgpr051.objects.filter(data__contains=q)
        elif q and t == "numero_nf":
            acgpr051 = Acgpr051.objects.filter(numero_nf__contains=q)
        elif q and t == "cod_mun":
            acgpr051 = Acgpr051.objects.filter(cod_mun__contains=q)
        elif q and t == "remessa":
            acgpr051 = Acgpr051.objects.filter(cfop__contains=q)
        else:
            acgpr051 = Acgpr051.objects.all()
        remessa = REMESSAS.objects.all()
        acgpr051 = Paginator(acgpr051, 20)
        acgpr051 = acgpr051.page(page)
    except PageNotAnInteger:
        acgpr051 = acgpr051.page(1)
    except EmptyPage:
        acgpr051 = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': acgpr051}
    return render(request, 'ACGPR051.html', remessas)


@login_required
def import_acgpr051(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_acgpr051', sep=';',
                 columns=('INSCRICAO, RAZAO_SOCIAL, NUMERO_NF, DATA, CFOP, VALOR, COD_MUN'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'acgpr051_sucesso.html')


@login_required
def CFOP(request):
    page = request.GET.get('page', '')
    t = request.GET.get('t')
    q = request.GET.get('q')
    if q:
        q = str(q).upper()
    try:
        if q and t == 'codigo':
            cfop = Cfop.objects.filter(codigo__contains=q)
        elif q and t == "data":
            cfop = Cfop.objects.filter(aplicacao__contains=q)
        else:
            cfop = Cfop.objects.all()
        remessa = REMESSAS.objects.all()
        cfop = Paginator(cfop, 20)
        cfop = cfop.page(page)
    except PageNotAnInteger:
        cfop = cfop.page(1)
    except EmptyPage:
        cfop = paginator.page(paginator.num_pages)

    remessas = {'lista': remessa, 'order': cfop}
    return render(request, 'CFOP.html', remessas)


@login_required
def import_cfop(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_cfop', sep=';',
                 columns=(
                     'CODIGO', 'DESCRICAO', 'APLICACAO', 'INICIO_VIGENCIA', 'FIM_VIGENCIA', 'TIPO', 'VALIDO',
                     'PORTARIA'))
    db.commit()
    st.close()
    db.close()
    return render(request, 'cfop_sucesso.html')


@login_required
def Pts(request):
    page = request.GET.get('page', '')
    # t = request.GET.get('t')
    # q = request.GET.get('q')
    try:
        pts = PTS.objects.all()
        remessa = REMESSAS.objects.all()
        pts = Paginator(pts, 20)
        pts = pts.page(page)
    except PageNotAnInteger:
        pts = pts.page(1)
    except EmptyPage:
        pts = paginator.page(paginator.num_pages)
    remessas = {'lista': remessa, 'order': pts}
    return render(request, 'PTS.html', remessas)


@login_required
def import_pts(request, pk):
    remessa = REMESSAS.objects.get(pk=pk)
    arquivo = remessa.arquivo
    filx = f'/code/ProjetoVA/tabela/{arquivo}'
    f = open(filx, 'r+', encoding='utf-8')
    constr = "dbname='postgres' user='postgres' password='postgres' host='db'"
    db = psycopg2.connect(constr)
    st = db.cursor()
    st.copy_from(file=f, table='appva_pts', sep=';',
                 columns=('EXERCICIO', 'INSCRICAO', 'DTINICIO', 'DTFINAL', 'TIPO', 'DTPROCESSAM', 'CFOP', 'VLCONTABIL',
                          'BASECALCULO', 'ICMS', 'ISENTAS', 'OUTRAS', 'IPI', 'RETIDO', 'SITUACAO', 'IDATUALIZACAO',
                          'CODMUNICIPIO', 'EFD', 'REMESSA', 'DESCRICAO', 'ANO_EXERCICIO', 'ANO_BASE'
                          ))
    db.commit()
    st.close()
    db.close()
    return render(request, 'pts_sucesso.html')


# @login_required
# def VALOR_ADICIONADO_PTS(request, municipio, ano, inscricao):


@login_required
def pre_simulacao(request):
    if request.method == 'POST':
        ano_atual = request.POST['ano_atual']
        municipio = request.POST['municipio']
        remessa = request.POST['remessa']
        ano_anterior = int(ano_atual) - 1
        return redirect('insercao_dados_simulacao', remessa=remessa, municipio=municipio, ano_atu=ano_atual,
                        ano_ant=ano_anterior)
    return render(request, 'pre_simulacao.html')


@login_required
def insercao_dados_simulacao(request, remessa, municipio, ano_atu, ano_ant):
    if remessa == 'R1 - DEFINITIVO':
        remessas = ('R1 - DEFINITIVO', 'R1-DEFINITIVO', 'R1- DEFINITIVO', 'R1 -DEFINITIVO')
    elif remessa == 'R2 - DEFINITIVO':
        remessas = ('R2 - DEFINITIVO', 'R2-DEFINITIVO', 'R2- PRELIMINAR', 'R2 -DEFINITIVO')
    elif remessa == 'R3 - DEFINITIVO':
        remessas = ('R3 - DEFINITIVO', 'R3-DEFINITIVO', 'R3- DEFINITIVO', 'R3 -DEFINITIVO')
    elif remessa == 'R4 - DEFINITIVO':
        remessas = ('R4 - DEFINITIVO', 'R4-DEFINITIVO', 'R4- DEFINITIVO', 'R4 -DEFINITIVO')
    elif remessa == 'R5 - DEFINITIVO':
        remessas = ('R5 - DEFINITIVO', 'R5-DEFINITIVO', 'R5- DEFINITIVO', 'R5 -DEFINITIVO')
    elif remessa == 'R6 - DEFINITIVO':
        remessas = ('R6 - DEFINITIVO', 'R6-DEFINITIVO', 'R6- DEFINITIVO', 'R6 -DEFINITIVO')
    elif remessa == 'R7 - DEFINITIVO':
        remessas = ('R7 - DEFINITIVO', 'R7-DEFINITIVO', 'R7- DEFINITIVO', 'R7 -DEFINITIVO')
    elif remessa == 'R1 - PRELIMINAR':
        remessas = ('R1 - PRELIMINAR', 'R1-PRELIMINAR', 'R1- PRELIMINAR', 'R1 -PRELIMINAR')
    elif remessa == 'R2 - PRELIMINAR':
        remessas = ('R2 - PRELIMINAR', 'R2-PRELIMINAR', 'R2- PRELIMINAR', 'R2 -PRELIMINAR')
    elif remessa == 'R3 - PRELIMINAR':
        remessas = ('R3 - PRELIMINAR', 'R3-PRELIMINAR', 'R3- PRELIMINAR', 'R3 -PRELIMINAR')
    elif remessa == 'R4 - PRELIMINAR':
        remessas = ('R4 - PRELIMINAR', 'R4-PRELIMINAR', 'R4- PRELIMINAR', 'R4 -PRELIMINAR')
    elif remessa == 'R5 - PRELIMINAR':
        remessas = ('R5 - PRELIMINAR', 'R5-PRELIMINAR', 'R5- PRELIMINAR', 'R5 -PRELIMINAR')
    elif remessa == 'R6 - PRELIMINAR':
        remessas = ('R6 - PRELIMINAR', 'R6-PRELIMINAR', 'R6- PRELIMINAR', 'R6 -PRELIMINAR')
    elif remessa == 'R7 - PRELIMINAR':
        remessas = ('R7 - PRELIMINAR', 'R7-PRELIMINAR', 'R7- PRELIMINAR', 'R7 -PRELIMINAR')
    ano_atual = str(int(ano_atu) - 1)
    ano_anterior = str(int(ano_ant) - 1)
    ano_atual_final = str(int(ano_atu))
    ano_anterior_final = str(int(ano_ant))
    inscricao = request.GET.get("inscricao")
    tabela = request.GET.get("tabela")
    ano = request.GET.get('ano')
    va_municipio_atual = request.GET.get("va_municipio_atual")
    va_municipio_anterior = request.GET.get("va_municipio_anterior")
    va_estado_atual = request.GET.get('va_estado_atual')
    va_estado_anterior = request.GET.get('va_estado_anterior')
    va_comercio = request.GET.get('va_comercio')
    va_producao_rural = request.GET.get('va_producao_rural')
    va_pts = request.GET.get('va_pts')
    va_dar1aut = request.GET.get('va_dar1aut')
    va_nai = request.GET.get('va_nai')
    va_creditoexoff = request.GET.get('va_creditoexoff')
    va_debitoexoff = request.GET.get('va_debitoexoff')
    va_total = request.GET.get('va_total')
    variacao_distribuicao_estado = request.GET.get('variacao_distribuicao_estado')
    ano_icms = request.GET.get('ano_icms')
    inscricoes = [0.0]
    inscricoes2 = [0.0]
    with connections['default'].cursor() as cursor:
        cursor.execute(
            """SELECT municipio, iva_ant, iva_atual, iva_med, iva_75, ucti, trib_propr, populacao, area, coef_soc, ind_final, descricao FROM appva_acypr535 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano_atual_final]
        )
        dados_indice = namedtuplefetchall(cursor)
        cursor.execute(
            """SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro+novembro+dezembro / 12) AS resultado_final FROM appva_fpm WHERE ano=%s;""",
            [ano_atual]
        )
        dados_icms = namedtuplefetchall(cursor)
        if inscricao and tabela == 'GIA' and ano == 'ano_atual':
            mes1 = int(1)
            mes2 = int(12)
            mes2 = mes2 + 1
            ano = str(ano_atual)
            filtro = list(range(mes1, mes2))
            datas = [f'01/' + '0' + str(x) + f'/{ano}' if x < 10 else f'01/' + str(x) + f'/{ano}' for x in
                     filtro]
            datas1 = tuple(datas)
            ins = Gia_entradas_saidas.objects.all()
            i = str(inscricao)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s;",
                [i, (datas1), remessas])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s;",
                [i, (datas1), remessas])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000',
                              '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903',
                              '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102',
                              '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406',
                              '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301',
                              '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300',
                              '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'],
                    inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902',
                              '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803',
                              '159804',
                              '159899'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
        elif inscricao and tabela == 'GIA' and ano == 'ano_anterior':
            mes1 = int(1)
            mes2 = int(12)
            mes2 = mes2 + 1
            ano = str(ano_anterior)
            filtro = list(range(mes1, mes2))
            datas = [f'01/' + '0' + str(x) + f'/{ano}' if x < 10 else f'01/' + str(x) + f'/{ano}' for x in
                     filtro]
            datas1 = tuple(datas)
            ins = Gia_entradas_saidas.objects.all()
            i = str(municipio)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s;",
                [i, (datas1), remessas])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s;",
                [i, (datas1), remessas])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000',
                              '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903',
                              '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102',
                              '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406',
                              '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301',
                              '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300',
                              '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'],
                    inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902',
                              '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803',
                              '159804',
                              '159899'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s AND remessas IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_gia_entradas_saidas WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_gia_entradas_saidas WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
        if inscricao and tabela == 'EFD' and ano == 'ano_atual':
            mes1 = int(1)
            mes2 = int(12)
            mes2 = mes2 + 1
            ano = str(ano_atual)
            filtro = list(range(mes1, mes2))
            datas = [f'01/' + '0' + str(x) + f'/{ano}' if x < 10 else f'01/' + str(x) + f'/{ano}' for x in
                     filtro]
            datas1 = tuple(datas)
            ins = Efd.objects.all()
            i = str(inscricao)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s;",
                [i, (datas1), remessas])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s;",
                [i, (datas1), remessas])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000',
                              '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903',
                              '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102',
                              '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406',
                              '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301',
                              '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300',
                              '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'],
                    inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902',
                              '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803',
                              '159804',
                              '159899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes = namedtuplefetchall(cursor)
        elif inscricao and tabela == 'EFD' and ano == 'ano_anterior':
            mes1 = int(1)
            mes2 = int(12)
            mes2 = mes2 + 1
            ano = str(ano_anterior)
            filtro = list(range(mes1, mes2))
            datas = [f'01/' + '0' + str(x) + f'/{ano}' if x < 10 else f'01/' + str(x) + f'/{ano}' for x in
                     filtro]
            datas1 = tuple(datas)
            ins = Efd.objects.all()
            i = str(municipio)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_saida FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s;",
                [i, (datas1), remessas])
            saida = namedtuplefetchall(cursor)
            sai = str(saida[0].valor_adicionado_saida)
            if sai == 'None':
                saida1 = float(0)
            else:
                saida1 = float(sai)
            cursor.execute(
                "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado_entrada FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s;",
                [i, (datas1), remessas])
            entrada = namedtuplefetchall(cursor)
            ent = str(entrada[0].valor_adicionado_entrada)
            if ent == 'None':
                entrada1 = float(0)
            else:
                entrada1 = float(ent)
            if ins.filter(
                    cnae__in=['111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000',
                              '114800',
                              '115600', '116401', '116402', '116403', '116499', '119901', '119902', '119903',
                              '119904',
                              '119905', '119906', '119907', '119908', '119909', '119999', '121101', '121102',
                              '122900',
                              '131800', '132600', '133401', '133402', '133403', '133404', '133405', '133406',
                              '133407',
                              '133408', '133409', '133410', '133411', '133499', '134200', '135100', '139301',
                              '139302',
                              '139303', '139304', '139305', '139306', '139399', '141501', '141502', '142300',
                              '161001',
                              '161002', '161003', '161099', '162801', '162802', '162803', '162899'],
                    inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.50:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.50 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(
                    cnae__in=['151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902',
                              '154700',
                              '155501', '155502', '155503', '155504', '155505', '159801', '159802', '159803',
                              '159804',
                              '159899'], municipio=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND municipio= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada1 >= saida1 * 0.20:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.20 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
            elif ins.filter(cnae__in=['500301', '500302', '600001', '600002', '600003'], inscricao=i):
                if saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif entrada1 > saida1 * 0.35:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT (SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi))) * 0.35 FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
            else:
                if entrada1 == 0.0:
                    cursor.execute(
                        f"SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667')AND municipio= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                elif saida1 == 0.0:
                    cursor.execute(
                        "SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653')AND inscricao= %s AND dt_inicial IN %s AND remessa IN %s;",
                        [i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
                else:
                    cursor.execute(
                        f"SELECT (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) AS valor_adicionado FROM appva_efd WHERE cfop IN('5101','5102','5103','5104','5105','5106','5109','5110','5111','5112','5113','5114','5115','5116','5117','5118','5119','5120','5122','5123','5124','5125','5129','5132', '5151', '5152', '5153', '5155', '5156', '5159', '5160', '5201', '5202', '5205', '5206', '5207', '5208', '5209', '5210', '5214', '5215', '5216', '5251', '5252', '5253', '5254', '5255', '5256', '5257', '5258', '5301', '5302', '5303', '5304', '5305', '5306', '5307', '5351', '5352', '5353', '5354', '5355', '5356', '5357', '5359', '5401', '5402', '5403', '5405', '5408', '5409', '5410', '5411', '5456', '5501', '5502', '5503', '5651', '5652', '5653', '5654', '5655', '5656', '5658', '5659', '5660', '5661', '5662', '5667', '5910', '5927', '5928', '6101', '6102','6103', '6104', '6105', '6106', '6107', '6108', '6109', '6110', '6111', '6112', '6113', '6114', '6115', '6116', '6117', '6118', '6119', '6120', '6122', '6123', '6124', '6125', '6129', '6132', '6151', '6152', '6153', '6155', '6156', '6159', '6160', '6201', '6202', '6205', '6206', '6207', '6208', '6209', '6210', '6214', '6215','6216', '6251', '6252', '6253', '6254', '6255', '6256', '6257', '6258', '6301', '6302', '6303', '6304', '6305', '6306', '6307', '6351', '6352', '6353', '6354', '6355', '6356', '6357', '6359', '6401', '6402', '6403', '6404','6408', '6409', '6410', '6411', '6456', '6501', '6502', '6503', '6651','6652','6653','6654','6655','6656','6658','6659','6660','6661','6662','6667','6910','7101','7102','7105','7106','7127','7129','7201','7202','7205','7206','7207', '7210', '7211', '7212', '7251', '7301', '7358', '7501', '7504', '7651', '7654', '7667') AND inscricao = %s AND dt_inicial IN %s AND remessa IN %s) - (SELECT SUM(vr_contabil)-(SUM(icms_st)+SUM(ipi)) FROM appva_efd WHERE cfop IN ('1101','1102','1111','1113','1116','1117','1118','1120','1121','1122','1124', '1125', '1126', '1132', '1135', '1151', '1152', '1153', '1159', '1201', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1212', '1214', '1215', '1216', '1251', '1252', '1257', '1301', '1351', '1352', '1353', '1356', '1401', '1403', '1408', '1409', '1410', '1411', '1456', '1501', '1503', '1504', '1651', '1652', '1653', '1658', '1659', '1660', '1661', '1662', '2101', '2102', '2111', '2113', '2116', '2117', '2118', '2120', '2121', '2122', '2124', '2125', '2126', '2132', '2135', '2151', '2152', '2153', '2159', '2201', '2202', '2203', '2204', '2205', '2206', '2207', '2208', '2209', '2212', '2214', '2215', '2216', '2251', '2252', '2257', '2301', '2351', '2352', '2353', '2356', '2401', '2403', '2408', '2409', '2410', '2411', '2456', '2501', '2503', '2504', '2651', '2652', '2653', '2658', '2659', '2660', '2661', '2662', '3101', '3102', '3126', '3127', '3129', '3201', '3202', '3205', '3206', '3207', '3211', '3212', '3251', '3301', '3351', '3352', '3353', '3356', '3503', '3651', '3652', '3653') AND inscricao =  %s AND dt_inicial IN %s AND remessa IN %s) AS valor_adicionado;",
                        [i, (datas1), remessas, i, (datas1), remessas])
                    inscricoes2 = namedtuplefetchall(cursor)
        if va_municipio_atual:
            va_municipio_atual = float(float(va_municipio_atual) / 100)
            cursor.execute(
                """SELECT (SUM(vr_adic_ano_exercicio) * %s) AS resultado_final FROM appva_acypr556 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
                [va_municipio_atual, municipio, ano_atual_final])
            va_mun_atual_total = namedtuplefetchall(cursor)
        else:
            va_mun_atual_total = [0.0]

        if va_municipio_anterior:
            va_municipio_anterior = float(float(va_municipio_anterior) / 100)
            cursor.execute(
                """SELECT (SUM(vr_adic_ano_base) * %s) AS resultado_final FROM appva_acypr556 WHERE municipio=%s AND ano_base=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
                [va_municipio_anterior, municipio, ano_anterior_final])
            va_mun_anterior_total = namedtuplefetchall(cursor)
        else:
            va_mun_anterior_total = [0.0]

        if va_estado_atual:
            va_estado_atual = float(float(va_estado_atual) / 100)
            cursor.execute(
                """SELECT (SUM(vr_adic_ano_exercicio) * %s) AS resultado_final FROM appva_acypr556 WHERE municipio='TOTAL DO ESTADO' AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
                [va_estado_atual, ano_atual_final])
            va_estado_atual_total = namedtuplefetchall(cursor)
        else:
            va_estado_atual_total = [0.0]

        if va_estado_anterior:
            va_estado_anterior = float(float(va_estado_anterior) / 100)
            cursor.execute(
                """SELECT (SUM(vr_adic_ano_base) * %s) AS resultado_final FROM appva_acypr556 WHERE municipio='TOTAL DO ESTADO' AND ano_base=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
                [va_estado_anterior, ano_anterior_final])
            va_estado_anterior_total = namedtuplefetchall(cursor)
        else:
            va_estado_anterior_total = [0.0]

        if va_comercio:
            va_comercio = float(float(va_comercio) / 100)
            cursor.execute(
                """SELECT (SUM(com_ind) * %s) AS resultado_final FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');"""
                , [va_comercio, municipio, ano_atual_final]
            )
            va_comercio_total = namedtuplefetchall(cursor)
        else:
            va_comercio_total = [0.0]

        if va_producao_rural:
            va_producao_rural = float(float(va_producao_rural) / 100)
            cursor.execute(
                """SELECT (SUM(prod_rural) * %s) AS resultado_final FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
                [va_producao_rural, municipio, ano_atual_final]
            )
            va_producao_rural_total = namedtuplefetchall(cursor)
        else:
            va_producao_rural_total = [0.0]

        if va_pts:
            va_pts = float(float(va_pts) / 100)
            cursor.execute(
                """SELECT (SUM(prest_serv) * %s) AS resultado_final FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
                [va_pts, municipio, ano_atual_final]

            )
            va_pts_total = namedtuplefetchall(cursor)
        else:
            va_pts_total = [0.0]

        if va_dar1aut:
            va_dar1aut = float(float(va_dar1aut) / 100)
            cursor.execute(
                """SELECT (SUM(dar_1_aut) * %s) AS resultado_final FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
                [va_dar1aut, municipio, ano_atual_final]
            )
            va_dar1aut_total = namedtuplefetchall(cursor)
        else:
            va_dar1aut_total = [0.0]

        if va_nai:
            va_nai = float(float(va_nai) / 100)
            cursor.execute(
                """SELECT (SUM(nai) * %s) AS resultado_final FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
                [va_nai, municipio, ano_atual_final]
            )
            va_nai_total = namedtuplefetchall(cursor)
        else:
            va_nai_total = [0.0]

        if va_creditoexoff:
            va_creditoexoff = float(float(va_creditoexoff) / 100)
            cursor.execute(
                """SELECT (SUM(credito_ex_off) * %s) AS resultado_final FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
                [va_creditoexoff, municipio, ano_atual_final]
            )
            va_creditoexoff_total = namedtuplefetchall(cursor)
        else:
            va_creditoexoff_total = [0.0]

        if va_debitoexoff:
            va_debitoexoff = float(float(va_debitoexoff) / 100)
            cursor.execute(
                """SELECT (SUM(debito_ex_off) * %s) AS resultado_final FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
                [va_debitoexoff, municipio, ano_atual_final]
            )
            va_debitoexoff_total = namedtuplefetchall(cursor)
        else:
            va_debitoexoff_total = [0.0]

        if va_total:
            va_total = float(float(va_total) / 100)
            cursor.execute(
                """SELECT (SUM(total) * %s) AS resultado_final FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
                [va_total, municipio, ano_atual_final]
            )
            va_total_final = namedtuplefetchall(cursor)
        else:
            va_total_final = [0.0]

        if variacao_distribuicao_estado:
            variacao_distribuicao_estado = float(float(variacao_distribuicao_estado) / 100)
            cursor.execute(
                """SELECT ((janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro+novembro+dezembro / 12) * %s) AS resultado_final FROM appva_fpm WHERE ano=%s;""",
                [variacao_distribuicao_estado, ano_icms]
            )
            variacao_distribuicao_estado_total = namedtuplefetchall(cursor)
        else:
            variacao_distribuicao_estado_total = [0.0]
    if request.method == 'POST':
        resultado_contribuinte_atual = request.POST['resultado_contribuinte_atual']
        if resultado_contribuinte_atual == '':
            resultado_contribuinte_atual = '0.0'
            resultado_contribuinte_atual = str(resultado_contribuinte_atual).replace(',', '.')
            resultado_contribuinte_atual = float(resultado_contribuinte_atual)
        else:
            resultado_contribuinte_atual = str(resultado_contribuinte_atual).replace(',', '.')
            resultado_contribuinte_atual = float(resultado_contribuinte_atual)
        resultado_contribuinte_anterior = request.POST['resultado_contribuinte_anterior']
        if resultado_contribuinte_anterior == '':
            resultado_contribuinte_anterior = '0.0'
            resultado_contribuinte_anterior = str(resultado_contribuinte_anterior).replace(',', '.')
            resultado_contribuinte_anterior = float(resultado_contribuinte_anterior)
        else:
            resultado_contribuinte_anterior = str(resultado_contribuinte_anterior).replace(',', '.')
            resultado_contribuinte_anterior = float(resultado_contribuinte_anterior)
        resultado_va_municipio_atual = request.POST['resultado_va_municipio_atual']
        if resultado_va_municipio_atual == '':
            resultado_va_municipio_atual = '0.0'
            resultado_va_municipio_atual = str(resultado_va_municipio_atual).replace(',', '.')
            resultado_va_municipio_atual = float(resultado_va_municipio_atual)
        else:
            resultado_va_municipio_atual = str(resultado_va_municipio_atual).replace(',', '.')
            resultado_va_municipio_atual = float(resultado_va_municipio_atual)
        resultado_va_municipio_anterior = request.POST['resultado_va_municipio_anterior']
        if resultado_va_municipio_anterior == '':
            resultado_va_municipio_anterior = '0.0'
            resultado_va_municipio_anterior = resultado_va_municipio_anterior.replace(',', '.')
            resultado_va_municipio_anterior = float(resultado_va_municipio_anterior)
        else:
            resultado_va_municipio_anterior = str(resultado_va_municipio_anterior).replace(',', '.')
            resultado_va_municipio_anterior = float(resultado_va_municipio_anterior)
        resultado_va_estado_atual = request.POST['resultado_va_estado_atual']
        if resultado_va_estado_atual == '':
            resultado_va_estado_atual = '0.0'
            resultado_va_estado_atual = resultado_va_estado_atual.replace(',', '.')
            resultado_va_estado_atual = float(resultado_va_estado_atual)
        else:
            resultado_va_estado_atual = str(resultado_va_estado_atual).replace(',', '.')
            resultado_va_estado_atual = float(resultado_va_estado_atual)
        resultado_va_estado_anterior = request.POST['resultado_va_estado_anterior']
        if resultado_va_estado_anterior == '':
            resultado_va_estado_anterior = '0.0'
            resultado_va_estado_anterior = resultado_va_estado_anterior.replace(',', '.')
            resultado_va_estado_anterior = float(resultado_va_estado_anterior)
        else:
            resultado_va_estado_anterior = str(resultado_va_estado_anterior).replace(',', '.')
            resultado_va_estado_anterior = float(resultado_va_estado_anterior)
        resultado_va_comercio = request.POST['resultado_va_comercio']
        if resultado_va_comercio == '':
            resultado_va_comercio = '0.0'
            resultado_va_comercio = resultado_va_comercio.replace(',', '.')
            resultado_va_comercio = float(resultado_va_comercio)
        else:
            resultado_va_comercio = str(resultado_va_comercio).replace(',', '.')
            resultado_va_comercio = float(resultado_va_comercio)
        resultado_va_producao_rural = request.POST['resultado_va_producao_rural']
        if resultado_va_producao_rural == '':
            resultado_va_producao_rural = '0.0'
            resultado_va_producao_rural = resultado_va_producao_rural.replace(',', '.')
            resultado_va_producao_rural = float(resultado_va_producao_rural)
        else:
            resultado_va_producao_rural = str(resultado_va_producao_rural).replace(',', '.')
            resultado_va_producao_rural = float(resultado_va_producao_rural)
        resultado_va_pts = request.POST['resultado_va_pts']
        if resultado_va_pts == '':
            resultado_va_pts = '0.0'
            resultado_va_pts = resultado_va_pts.replace(',', '.')
            resultado_va_pts = float(resultado_va_pts)
        else:
            resultado_va_pts = str(resultado_va_pts).replace(',', '.')
            resultado_va_pts = float(resultado_va_pts)
        resultado_va_dar1aut = request.POST['resultado_va_dar1aut']
        if resultado_va_dar1aut == '':
            resultado_va_dar1aut = '0.0'
            resultado_va_dar1aut = resultado_va_dar1aut.replace(',', '.')
            resultado_va_dar1aut = float(resultado_va_dar1aut)
        else:
            resultado_va_dar1aut = str(resultado_va_dar1aut).replace(',', '.')
            resultado_va_dar1aut = float(resultado_va_dar1aut)
        resultado_va_nai = request.POST['resultado_va_nai']
        if resultado_va_nai == '':
            resultado_va_nai = '0.0'
            resultado_va_nai = resultado_va_nai.replace(',', '.')
            resultado_va_nai = float(resultado_va_nai)
        else:
            resultado_va_nai = str(resultado_va_nai).replace(',', '.')
            resultado_va_nai = float(resultado_va_nai)
        resultado_va_creditoexoff = request.POST['resultado_va_creditoexoff']
        if resultado_va_creditoexoff == '':
            resultado_va_creditoexoff = '0.0'
            resultado_va_creditoexoff = resultado_va_creditoexoff.replace(',', '.')
            resultado_va_creditoexoff = float(resultado_va_creditoexoff)
        else:
            resultado_va_creditoexoff = str(resultado_va_creditoexoff).replace(',', '.')
            resultado_va_creditoexoff = float(resultado_va_creditoexoff)
        resultado_va_debitoexoff = request.POST['resultado_va_debitoexoff']
        if resultado_va_debitoexoff == '':
            resultado_va_debitoexoff = '0.0'
            resultado_va_debitoexoff = resultado_va_debitoexoff.replace(',', '.')
            resultado_va_debitoexoff = float(resultado_va_debitoexoff)
        else:
            resultado_va_debitoexoff = str(resultado_va_debitoexoff).replace(',', '.')
            resultado_va_debitoexoff = float(resultado_va_debitoexoff)
        resultado_va_total = request.POST['resultado_va_total']
        if resultado_va_total == '':
            resultado_va_total = '0.0'
            resultado_va_total = resultado_va_total.replace(',', '.')
            resultado_va_total = float(resultado_va_total)
        else:
            resultado_va_total = str(resultado_va_total).replace(',', '.')
            resultado_va_total = float(resultado_va_total)
        resultado_variacao_distribuicao_estado = request.POST['resultado_variacao_distribuicao_estado']
        if resultado_variacao_distribuicao_estado == '':
            resultado_variacao_distribuicao_estado = '0.0'
            resultado_variacao_distribuicao_estado = resultado_variacao_distribuicao_estado.replace(',', '.')
            resultado_variacao_distribuicao_estado = float(resultado_variacao_distribuicao_estado)
        else:
            resultado_variacao_distribuicao_estado = str(resultado_variacao_distribuicao_estado).replace(',', '.')
            resultado_variacao_distribuicao_estado = float(resultado_variacao_distribuicao_estado)

        return redirect('resultado_simulacao', municipio=municipio, ano=ano_atu,
                        contribuinte_atual=resultado_contribuinte_atual,
                        contribuinte_anterior=resultado_contribuinte_anterior,
                        municipio_atual=resultado_va_municipio_atual,
                        municipio_anterior=resultado_va_municipio_anterior,
                        estado_atual=resultado_va_estado_atual,
                        estado_anterior=resultado_va_estado_anterior,
                        comercio=resultado_va_comercio,
                        prod_rural=resultado_va_producao_rural,
                        pts=resultado_va_pts,
                        dar1aut=resultado_va_dar1aut,
                        nai=resultado_va_nai,
                        creditoexoff=resultado_va_creditoexoff,
                        debitoexoff=resultado_va_debitoexoff,
                        total=resultado_va_total,
                        variacao_distribuicao_estado=resultado_variacao_distribuicao_estado
                        )

    return render(request, 'insercao_dados_simulacao.html',
                  {'contribuinte_atual': inscricoes, 'contribuinte_anterior': inscricoes2,
                   'municipio_atual': va_mun_atual_total, 'municipio_anterior': va_mun_anterior_total,
                   'estado_atual': va_estado_atual_total, 'estado_anterior': va_estado_anterior_total,
                   'comercio': va_comercio_total, 'prod_rural': va_producao_rural_total,
                   'pts': va_pts_total, 'dar1aut': va_dar1aut_total,
                   'nai': va_nai_total, 'creditoexoff': va_creditoexoff_total,
                   'debitoexoff': va_debitoexoff_total, 'total': va_total_final,
                   'variacao_distribuicao_estado': variacao_distribuicao_estado_total, 'lista': dados_indice,
                   'lista2': dados_icms})


@login_required
def resultado_simulacao(request, municipio, ano, contribuinte_atual, contribuinte_anterior, municipio_atual,
                        municipio_anterior,
                        estado_atual, estado_anterior, comercio, prod_rural, pts, dar1aut, nai, creditoexoff,
                        debitoexoff, total, variacao_distribuicao_estado):
    with connections['default'].cursor() as cursor:
        cursor.execute(
            """SELECT SUM(vr_adic_ano_exercicio) FROM appva_acypr556 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        va_municipio_atu = namedtuplefetchall(cursor)
        va_mun_atu = float(str(va_municipio_atu[0][0]))

        cursor.execute(
            """SELECT SUM(vr_adic_ano_base) FROM appva_acypr556 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        va_municipio_ant = namedtuplefetchall(cursor)
        va_mun_ant = float(str(va_municipio_ant[0][0]))

        cursor.execute(
            """SELECT SUM(vr_adic_ano_exercicio) FROM appva_acypr556 WHERE municipio='TOTAL DO ESTADO' AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [ano]
        )

        va_estado_atu = namedtuplefetchall(cursor)
        va_est_atu = float(str(va_estado_atu[0][0]))

        cursor.execute(
            """SELECT SUM(vr_adic_ano_base) FROM appva_acypr556 WHERE municipio='TOTAL DO ESTADO' AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [ano]
        )
        va_estado_ant = namedtuplefetchall(cursor)
        va_est_ant = float(str(va_estado_ant[0][0]))

        cursor.execute(
            """SELECT SUM(com_ind) FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        va_comercio = namedtuplefetchall(cursor)
        va_com = float(str(va_comercio[0][0]))
        if comercio == '0.0':
            va_comercio_final = '0.0'
        else:
            va_comercio_final = float(comercio) + va_com

        cursor.execute(
            """SELECT SUM(prod_rural) FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        va_prod_rural = namedtuplefetchall(cursor)
        va_prod = float(str(va_prod_rural[0][0]))
        if prod_rural == '0.0':
            va_prod_rural_final = '0.0'
        else:
            va_prod_rural_final = va_prod + float(prod_rural)

        cursor.execute(
            """SELECT SUM(prest_serv) FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        va_pts = namedtuplefetchall(cursor)
        va_p = float(str(va_pts[0][0]))
        if pts == '0.0':
            va_pts_final = '0.0'
        else:
            va_pts_final = va_p + float(pts)

        cursor.execute(
            """SELECT SUM(dar_1_aut) FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        va_dar1aut = namedtuplefetchall(cursor)
        va_dar = float(str(va_dar1aut[0][0]))
        if dar1aut == '0.0':
            va_dar1aut_final = '0.0'
        else:
            va_dar1aut_final = float(dar1aut) + va_dar

        cursor.execute(
            """SELECT SUM(nai) FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        va_nai = namedtuplefetchall(cursor)
        va_n = float(str(va_nai[0][0]))
        if nai == '0.0':
            va_nai_final = '0.0'
        else:
            va_nai_final = va_n + float(nai)

        cursor.execute(
            """SELECT SUM(credito_ex_off) FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        va_creditoexoff = namedtuplefetchall(cursor)
        va_credito = float(str(va_creditoexoff[0][0]))
        if creditoexoff == '0.0':
            va_creditoexoff_final = '0.0'
        else:
            va_creditoexoff_final = va_credito + float(creditoexoff)

        cursor.execute(
            """SELECT SUM(debito_ex_off) FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        va_debitoexoff = namedtuplefetchall(cursor)
        va_debito = float(str(va_debitoexoff[0][0]))
        if debitoexoff == '0.0':
            va_debitoexoff_final = '0.0'
        else:
            va_debitoexoff_final = va_debito + float(debitoexoff)

        cursor.execute(
            """SELECT SUM(total) FROM appva_acypr600 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        va_total = namedtuplefetchall(cursor)
        va_t = float(str(va_total[0][0]))
        if total == '0.0':
            va_total_final = '0.0'
        else:
            va_total_final = va_t + float(total)

        cursor.execute(
            """SELECT (janeiro+fevereiro+marco+abril+maio+junho+julho+agosto+setembro+outubro+novembro+dezembro) / 12 AS variacao FROM appva_fpm WHERE ano=%s;""",
            [ano]
        )
        va_variacao_estado = namedtuplefetchall(cursor)
        va_v = float(str(va_variacao_estado[0].variacao))
        va_variacao_estado_total = va_v + float(variacao_distribuicao_estado)

        if contribuinte_atual == 'None':
            contribuinte_atual = '0.0'

        if contribuinte_anterior == 'None':
            contribuinte_anterior = '0.0'

        va_do_municipio_atual = float(contribuinte_atual) + float(municipio_atual) + float(va_comercio_final) + float(
            va_prod_rural_final) + float(va_pts_final) + float(va_dar1aut_final) + float(va_nai_final) + float(
            va_creditoexoff_final) + float(va_debitoexoff_final) + float(va_total_final) + va_mun_atu

        va_do_municipio_anterior = (float(contribuinte_anterior) + float(municipio_anterior)) + va_mun_ant

        va_do_estado_atual = float(estado_atual) + float(municipio_atual) + float(contribuinte_atual) + float(
            va_comercio_final) + float(va_prod_rural_final) + float(va_pts_final) + float(va_dar1aut_final) + float(
            va_nai_final) + float(va_creditoexoff_final) + float(va_debitoexoff_final) + float(
            va_total_final) + va_est_atu

        va_do_estado_anterior = float(estado_anterior) + float(municipio_anterior) + float(
            contribuinte_anterior) + va_est_ant

        va_municipio_media = (va_do_municipio_atual + va_do_municipio_anterior) / 2

        va_estado_media = (va_do_estado_atual + va_do_estado_anterior) / 2

        va_municipio_75 = va_municipio_media * 0.75

        va_estado_75 = va_estado_media * 0.75

        indice_va_anterior = (va_do_municipio_anterior / va_do_estado_anterior) - 1

        indice_va_atual = (va_do_municipio_atual / va_do_estado_atual) - 1

        indice_va_medio = (indice_va_anterior + indice_va_atual) / 2

        indice_va_medio_75 = indice_va_medio * 0.75

        cursor.execute(
            """SELECT SUM(ucti) FROM appva_acypr535 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        lista_ucti = namedtuplefetchall(cursor)
        ucti = float(lista_ucti[0][0])

        cursor.execute(
            """SELECT SUM(trib_propr) FROM appva_acypr535 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        lista_trib = namedtuplefetchall(cursor)
        trib = float(str(lista_trib[0][0]))

        cursor.execute(
            """SELECT SUM(populacao) FROM appva_acypr535 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        lista_populacao = namedtuplefetchall(cursor)
        populacao = float(str(lista_populacao[0][0]))

        cursor.execute(
            """SELECT SUM(area) FROM appva_acypr535 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        lista_area = namedtuplefetchall(cursor)
        area = float(str(lista_area[0][0]))

        cursor.execute(
            """SELECT SUM(coef_soc) FROM appva_acypr535 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        lista_coef = namedtuplefetchall(cursor)
        coef = float(str(lista_coef[0][0]))

        indice_simulado = indice_va_medio_75 + ucti + trib + populacao + area + coef

        cursor.execute(
            """SELECT SUM(ind_final) FROM appva_acypr535 WHERE municipio=%s AND ano_exercicio=%s AND remessa IN ('DOE-DEFINITIVO', 'DOE DEFINITIVO', 'D.O.E. DEFINITIVO', 'D.O.E DEFINITIVO', 'D.O.E-DEFINITIVO', 'D.O.E.-DEFINITIVO','DEFINITIVO');""",
            [municipio, ano]
        )
        lista_ind = namedtuplefetchall(cursor)
        ind_final = float(str(lista_ind[0][0]))

        variacao_indice = indice_simulado - ind_final

        variacao_estimada = (float(va_variacao_estado_total) * indice_simulado) / 100

        numeros = [
            {'municipio': municipio, 'va_do_municipio_atual': va_do_municipio_atual,
             'va_do_municipio_anterior': va_do_municipio_anterior,
             'va_do_estado_atual': va_do_estado_atual, 'va_do_estado_anterior': va_do_estado_anterior,
             'va_municipio_media': va_municipio_media, 'va_estado_media': va_estado_media,
             'va_municipio_75': va_municipio_75, 'va_estado_75': va_estado_75, 'indice_va_anterior': indice_va_anterior,
             'indice_va_atual': indice_va_atual, 'indice_va_medio': indice_va_medio,
             'indice_va_medio_75': indice_va_medio_75,
             'ucti': ucti, 'trib': trib, 'populacao': populacao, 'area': area, 'coef': coef,
             'indice_simulado': indice_simulado,
             'ind_final': ind_final, 'variacao_indice': variacao_indice, 'variacao_estimada': variacao_estimada}]

    return render(request, 'resultado_simulacao.html', {'lista': numeros})


@login_required
def RELATORIO_SIMULACAO(request, n):
    nam = [n]
    return rendering.render_to_pdf_response(request=request, template='RELATORIO_SIMULACAO.html',
                                            context={'lista': nam}, using='django', encoding='utf-8')


@login_required
def consulta_VALOR_ADICIONADO_INDIVIDUAL(request):
    municipio = request.GET.get('municipio')
    tipo_contribuinte = request.GET.get('tipo_contribuinte')
    contribuinte = request.GET.get('contribuinte')
    tipo_contabilista = request.GET.get('tipo_contabilista')
    contabilista = request.GET.get('contabilista')
    atividade_economica = request.GET.get('atividade_economica')
    nome_inscrito = request.GET.get('nome_inscrito')
    numr_documento = request.GET.get('numr_documento')
    status = request.GET.get('status')
    consulta = []
    with connections['default'].cursor() as cursor:
        if municipio:
            cursor.execute(
                """SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cci WHERE nome_municipio=%s UNION SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cap WHERE nome_municipio=%s;""",
                [municipio, municipio]
            )
            consulta = namedtuplefetchall(cursor)
            return render(request, 'consulta_VALOR_ADICIONADO_INDIVIDUAL.html', {'lista': consulta})
        elif tipo_contribuinte == 'inscricao' and contribuinte:
            cursor.execute(
                """SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cci WHERE numr_inscricao_estadual=%s UNION SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, nome_contabilista, codg_crc, nome_municipio FROM appva_cap WHERE numr_inscricao_estadual=%s;""",
                [contribuinte, contribuinte]
            )
            consulta = namedtuplefetchall(cursor)
            return render(request, 'consulta_VALOR_ADICIONADO_INDIVIDUAL.html', {'lista': consulta})
        elif tipo_contribuinte == 'razao' and contribuinte:
            cursor.execute(
                """SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cci WHERE nome_pessoa=%s UNION SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cap WHERE nome_pessoa=%s;""",
                [contribuinte, contribuinte]
            )
            consulta = namedtuplefetchall(cursor)
            return render(request, 'consulta_VALOR_ADICIONADO_INDIVIDUAL.html', {'lista': consulta})
        elif tipo_contabilista == 'crc' and contabilista:
            cursor.execute(
                """SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cci WHERE codg_crc=%s UNION SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cap WHERE codg_crc=%s;""",
                [contabilista, contabilista]
            )
            consulta = namedtuplefetchall(cursor)
        elif tipo_contabilista == 'nome' and contabilista:
            cursor.execute(
                """SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cci WHERE nome_contabilista=%s UNION SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cap WHERE nome_contabilista=%s;""",
                [contabilista, contabilista]
            )
            consulta = namedtuplefetchall(cursor)
        elif atividade_economica:
            cursor.execute(
                """SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cci WHERE codg_cnae=%s UNION SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cap WHERE codg_cnae=%s;""",
                [atividade_economica, atividade_economica]
            )
            consulta = namedtuplefetchall(cursor)
        elif nome_inscrito:
            cursor.execute(
                """SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cci WHERE nome_inscrito=%s UNION SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cap WHERE nome_inscrito=%s;""",
                [nome_inscrito, nome_inscrito]
            )
            consulta = namedtuplefetchall(cursor)
        elif numr_documento:
            cursor.execute(
                """SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cci WHERE numr_documento=%s UNION SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cap WHERE numr_documento=%s;""",
                [numr_documento, numr_documento]
            )
            consulta = namedtuplefetchall(cursor)
        elif status == 'ativo':
            cursor.execute(
                """SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cci WHERE status=%s UNION SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cap WHERE status=%s;""",
                [status, status]
            )
            consulta = namedtuplefetchall(cursor)
        elif status == 'baixado':
            cursor.execute(
                """SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cci WHERE status=%s UNION SELECT numr_inscricao_estadual, nome_pessoa, nome_inscrito, numr_documento, status, codg_cnae, codg_crc, nome_contabilista, nome_municipio FROM appva_cap WHERE status=%s;""",
                [status, status]
            )
            consulta = namedtuplefetchall(cursor)

    return render(request, 'consulta_VALOR_ADICIONADO_INDIVIDUAL.html', {'lista': consulta})


@login_required
def PRE_RELATORIO(request, inscricao, municipio):
    with connections['default'].cursor() as cursor:
        cursor.execute(
            """SELECT portaria FROM appva_cfop GROUP BY portaria;"""
        )
        port = namedtuplefetchall(cursor)
        if request.method == 'POST':
            tipo_relatorio = request.POST['tipo_relatorio']
            portaria = request.POST['portaria']
            tabela = request.POST['tabela']
            remessa = request.POST['remessa']
            cadastro = request.POST['cadastro']
            ano_exercicio = request.POST['ano']
            if tipo_relatorio == 'sintetico':
                return redirect('RELATORIO_VALOR_ADICIONADO_SINTETICO', municipio=municipio, remessa=remessa,
                                portaria=portaria,
                                inscricao=inscricao,
                                tabela=tabela, cadastro=cadastro, ano=ano_exercicio)
            elif tipo_relatorio == 'analitico':
                return redirect('RELATORIO_VALOR_ADICIONADO_ANALITICO', municipio=municipio, remessa=remessa,
                                portaria=portaria,
                                inscricao=inscricao,
                                tabela=tabela, cadastro=cadastro, ano=ano_exercicio)
            elif tipo_relatorio == 'variacao_historica':
                return redirect('PRE_RELATORIO_VARIACAO_HISTORICA', municipio=municipio, remessa=remessa,
                                portaria=portaria,
                                inscricao=inscricao,
                                tabela=tabela, cadastro=cadastro, ano=ano_exercicio)
            else:
                pass
    return render(request, 'PRE_RELATORIO.html', {'lista': port})


@login_required
def RELATORIO_VALOR_ADICIONADO_SINTETICO(request, municipio, remessa, portaria, inscricao, tabela, cadastro, ano):
    with connections['default'].cursor() as cursor:
        if cadastro == 'CCI':
            cursor.execute(
                """SELECT * FROM appva_cci WHERE numr_inscricao_estadual=%s AND ano_exercicio=%s;""",
                [inscricao, ano]
            )
            dados_inscricao = namedtuplefetchall(cursor)
        else:
            cursor.execute(
                """SELECT * FROM appva_cap WHERE numr_inscricao_estadual=%s AND ano_exercicio=%s;""",
                [inscricao, ano]
            )
            dados_inscricao = namedtuplefetchall(cursor)
        cursor.execute(
            """SELECT codigo FROM appva_cfop WHERE valido='sim' AND portaria=%s AND tipo='saida';""", [portaria]
        )
        c1 = namedtuplefetchall(cursor)
        codigo_valido_saida = tuple([x.codigo for x in c1])
        cursor.execute(
            """SELECT codigo FROM appva_cfop WHERE valido='sim' AND portaria=%s AND tipo='entrada';""", [portaria]
        )
        c2 = namedtuplefetchall(cursor)
        codigo_valido_entrada = tuple([x.codigo for x in c2])
        cursor.execute(
            """SELECT codigo FROM appva_cfop WHERE valido='nao' AND portaria=%s AND tipo='saida';""", [portaria]
        )
        c3 = namedtuplefetchall(cursor)
        codigo_invalido_saida = tuple([x.codigo for x in c3])
        cursor.execute(
            """SELECT codigo FROM appva_cfop WHERE valido='nao' AND portaria=%s AND tipo='entrada';""", [portaria]
        )
        c4 = namedtuplefetchall(cursor)
        codigo_invalido_entrada = tuple([x.codigo for x in c4])
        nome_municipio = [{'municipio': municipio}]

        if tabela == 'GIA':
            cursor.execute(
                """SELECT cnae FROM appva_gia_entradas_saidas WHERE inscricao=%s GROUP BY cnae;""", [inscricao]
            )
            n = namedtuplefetchall(cursor)
            ae = [x.cnae for x in n]
            cnae = str(ae[0])
            cursor.execute(
                """SELECT SUM(ipi) AS ipi, SUM(icms_st) AS icms FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;"""
                , [remessa, inscricao, ano, codigo_valido_saida])
            impostos_saida = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(ipi) AS ipi, SUM(icms_st) AS icms FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;"""
                , [remessa, inscricao, ano, codigo_valido_entrada])
            impostos_entrada = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS saida_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                [remessa, inscricao, ano, codigo_valido_saida]
            )
            valor_valido_saida = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS saida_nao_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                [remessa, inscricao, ano, codigo_invalido_saida]
            )
            valor_invalido_saida = namedtuplefetchall(cursor)
            if cnae in (
                    '111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800', '115600',
                    '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904', '119905', '119906',
                    '119907', '119908', '119909', '119999', '121101', '121102', '122900', '131800', '132600', '133401',
                    '133402', '133403', '133404', '133405', '133406', '133407', '133408', '133409', '133410', '133411',
                    '133499', '134200', '135100', '139301', '139302', '139303', '139304', '139305', '139306', '139399',
                    '141501', '141502', '142300', '161001', '161002', '161003', '161099', '162801', '162802', '162803',
                    '162899', '163600', '230600'):
                cursor.execute(
                    """SELECT (SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st))) AS entrada_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_saida]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
                if float(str(valor_valido_entrada[0].entrada_computavel)) < float(
                        str(valor_valido_saida[0].saida_computavel)) * 0.50:
                    Lista = namedtuple('Lista', 'entrada_computavel')
                    valor_valido_entrada = [Lista(float(valor_valido_saida[0].saida_computavel) * 0.50)]
                else:
                    valor_valido_entrada = valor_valido_entrada
            elif cnae in (
                    '500301', '500302', '600001', '600002', '600003', '710301', '710302', '721901', '721902', '722701',
                    '722702', '723501', '723502', '724301', '724302', '725100', '729401', '729402', '729403', '729404',
                    '729405', '810001', '810002', '810003', '810004', '810005', '810006', '810007', '810008', '810009',
                    '810010', '810099', '891600', '892401', '892402', '892403', '893200', '899101', '899102', '899103',
                    '899199', '910600', '990401', '990402', '990403'):
                cursor.execute(
                    """SELECT (SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)))  AS entrada_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
                if float(str(valor_valido_entrada[0].entrada_computavel)) < float(
                        str(valor_valido_saida[0].saida_computavel)) * 0.35:
                    Lista = namedtuple('Lista', 'entrada_computavel')
                    valor_valido_entrada = [Lista(float(valor_valido_saida[0].saida_computavel) * 0.35)]
                else:
                    pass
            elif cnae in (
                    '151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700', '155501',
                    '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804', '159899', '311601',
                    '311602', '311603', '311604', '312401', '312402', '312403', '312404', '321301', '321302', '321303',
                    '321304', '321305', '321399', '322101', '322102', '322103', '322104', '322105', '322106', '322107',
                    '322199'):
                cursor.execute(
                    """SELECT (SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st))) * 0.20 AS entrada_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
                if float(str(valor_valido_entrada[0].entrada_computavel)) < float(
                        str(valor_valido_saida[0].saida_computavel)) * 0.20:
                    Lista = namedtuple('Lista', 'entrada_computavel')
                    valor_valido_entrada = [Lista(float(valor_valido_saida[0].saida_computavel) * 0.20)]
                else:
                    pass
            else:
                cursor.execute(
                    """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS entrada_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS entrada_nao_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                [remessa, inscricao, ano, codigo_invalido_entrada]
            )
            valor_invalido_entrada = namedtuplefetchall(cursor)

            va_final = [{'valor_adicionado': float(str(valor_valido_saida[0].saida_computavel)) - float(
                str(valor_valido_entrada[0].entrada_computavel))}]

            cursor.execute(
                """SELECT cfop FROM appva_gia_entradas_saidas WHERE inscricao=%s AND ano_exercicio=%s GROUP BY cfop;"""
                , [inscricao, ano])
            cfop_index = namedtuplefetchall(cursor)
            cfop_l = tuple([x.cfop for x in cfop_index])
            cursor.execute(
                """SELECT codigo, descricao, valido, tipo FROM appva_cfop WHERE codigo IN %s AND portaria=%s GROUP BY codigo, descricao, valido, tipo ORDER BY codigo ASC;""",
                [cfop_l, portaria]
            )
            dec_cfop = namedtuplefetchall(cursor)
            dic_cfop = [{'cod': x.codigo, 'descricao': x.descricao, 'valido': x.valido, 'tipo': x.tipo} for x in
                        dec_cfop]
            cursor.execute(
                """SELECT SUM(vr_contabil) AS valor FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s GROUP BY cfop ORDER BY cfop;""",
                [remessa, inscricao, ano]
            )
            v_c = namedtuplefetchall(cursor)
            resu_cfop = [{'valor': x.valor} for x in v_c]
            a = len(dic_cfop)
            [dic_cfop[x].update(resu_cfop[x]) for x in range(a)]
        else:
            cursor.execute(
                """SELECT cnae FROM appva_efd WHERE inscricao=%s GROUP BY cnae;""", [inscricao]
            )
            n = namedtuplefetchall(cursor)
            ae = [x.cnae for x in n]
            cnae = str(ae[0])
            cursor.execute(
                """SELECT SUM(ipi) AS ipi, SUM(icms_st) AS icms FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;"""
                , [remessa, inscricao, ano, codigo_valido_saida])
            impostos_saida = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(ipi) AS ipi, SUM(icms_st) AS icms FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;"""
                , [remessa, inscricao, ano, codigo_valido_entrada])
            impostos_entrada = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS saida_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                [remessa, inscricao, ano, codigo_valido_saida]
            )
            valor_valido_saida = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS saida_nao_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                [remessa, inscricao, ano, codigo_invalido_saida]
            )
            valor_invalido_saida = namedtuplefetchall(cursor)
            if cnae in (
                    '111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800', '115600',
                    '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904', '119905', '119906',
                    '119907', '119908', '119909', '119999', '121101', '121102', '122900', '131800', '132600', '133401',
                    '133402', '133403', '133404', '133405', '133406', '133407', '133408', '133409', '133410', '133411',
                    '133499', '134200', '135100', '139301', '139302', '139303', '139304', '139305', '139306', '139399',
                    '141501', '141502', '142300', '161001', '161002', '161003', '161099', '162801', '162802', '162803',
                    '162899', '163600', '230600'):
                cursor.execute(
                    """SELECT (SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st))) AS entrada_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
                if float(valor_valido_entrada[0].entrada_computavel) < float(
                        valor_valido_saida[0].saida_computavel) * 0.50:
                    Lista = namedtuple('Lista', 'entrada_computavel')
                    valor_valido_entrada = [Lista(float(valor_valido_saida[0].saida_computavel) * 0.50)]
                else:
                    valor_valido_entrada = valor_valido_entrada
            elif cnae in (
                    '500301', '500302', '600001', '600002', '600003', '710301', '710302', '721901', '721902', '722701',
                    '722702', '723501', '723502', '724301', '724302', '725100', '729401', '729402', '729403', '729404',
                    '729405', '810001', '810002', '810003', '810004', '810005', '810006', '810007', '810008', '810009',
                    '810010', '810099', '891600', '892401', '892402', '892403', '893200', '899101', '899102', '899103',
                    '899199', '910600', '990401', '990402', '990403'):
                cursor.execute(
                    """SELECT (SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)))  AS entrada_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
                if float(valor_valido_entrada[0].entrada_computavel) < float(
                        valor_valido_saida[0].saida_computavel) * 0.35:
                    Lista = namedtuple('Lista', 'entrada_computavel')
                    valor_valido_entrada = [Lista(float(valor_valido_saida[0].saida_computavel) * 0.35)]
                else:
                    pass
            elif cnae in (
                    '151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700', '155501',
                    '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804', '159899', '311601',
                    '311602', '311603', '311604', '312401', '312402', '312403', '312404', '321301', '321302', '321303',
                    '321304', '321305', '321399', '322101', '322102', '322103', '322104', '322105', '322106', '322107',
                    '322199'):
                cursor.execute(
                    """SELECT (SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st))) * 0.20 AS entrada_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
                if float(valor_valido_entrada[0].entrada_computavel) < float(
                        valor_valido_saida[0].saida_computavel) * 0.20:
                    Lista = namedtuple('Lista', 'entrada_computavel')
                    valor_valido_entrada = [Lista(float(valor_valido_saida[0].saida_computavel) * 0.20)]
                else:
                    pass
            else:
                cursor.execute(
                    """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS entrada_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS entrada_nao_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                [remessa, inscricao, ano, codigo_invalido_entrada]
            )
            valor_invalido_entrada = namedtuplefetchall(cursor)

            va_final = [{'valor_adicionado': float(valor_valido_saida[0].saida_computavel) - float(
                valor_valido_entrada[0].entrada_computavel)}]

            cursor.execute(
                """SELECT cfop FROM appva_efd WHERE inscricao=%s AND ano_exercicio=%s GROUP BY cfop;"""
                , [inscricao, ano])
            cfop_index = namedtuplefetchall(cursor)
            cfop_l = tuple([x.cfop for x in cfop_index])
            cursor.execute(
                """SELECT codigo, descricao, valido, tipo FROM appva_cfop WHERE codigo IN %s AND portaria=%s GROUP BY codigo, descricao, valido, tipo ORDER BY codigo ASC;""",
                [cfop_l, portaria]
            )
            dec_cfop = namedtuplefetchall(cursor)
            dic_cfop = [{'cod': x.codigo, 'descricao': x.descricao, 'valido': x.valido, 'tipo': x.tipo} for x in
                        dec_cfop]
            cursor.execute(
                """SELECT SUM(vr_contabil) AS valor FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s GROUP BY cfop ORDER BY cfop;""",
                [remessa, inscricao, ano]
            )
            v_c = namedtuplefetchall(cursor)
            resu_cfop = [{'valor': x.valor} for x in v_c]
            a = len(resu_cfop)
            [dic_cfop[x].update(resu_cfop[x]) for x in range(a)]
    return rendering.render_to_pdf_response(request=request,
                                            context={'lista1': dados_inscricao, 'lista2': valor_valido_saida,
                                                     'lista3': valor_invalido_saida, 'lista4': valor_valido_entrada,
                                                     'lista5': valor_invalido_entrada, 'lista6': va_final,
                                                     'lista7': dic_cfop, 'lista8': impostos_saida,
                                                     'lista9': impostos_entrada, 'mun': nome_municipio},
                                            template='RELATORIO_VALOR_ADICIONADO_SINTETICO.html',
                                            encoding='utf-8')


@login_required
def RELATORIO_VALOR_ADICIONADO_ANALITICO(request, municipio, remessa, portaria, inscricao, tabela, cadastro, ano):
    with connections['default'].cursor() as cursor:
        if cadastro == 'CCI':
            cursor.execute(
                """SELECT * FROM appva_cci WHERE numr_inscricao_estadual=%s AND ano_exercicio=%s;""",
                [inscricao, ano]
            )
            dados_inscricao = namedtuplefetchall(cursor)
        else:
            cursor.execute(
                """SELECT * FROM appva_cap WHERE numr_inscricao_estadual=%s AND ano_exercicio=%s;""",
                [inscricao, ano]
            )
            dados_inscricao = namedtuplefetchall(cursor)
        cursor.execute(
            """SELECT codigo FROM appva_cfop WHERE valido='sim' AND portaria=%s AND tipo='saida';""", [portaria]
        )
        c1 = namedtuplefetchall(cursor)
        codigo_valido_saida = tuple([x.codigo for x in c1])
        cursor.execute(
            """SELECT codigo FROM appva_cfop WHERE valido='sim' AND portaria=%s AND tipo='entrada';""", [portaria]
        )
        c2 = namedtuplefetchall(cursor)
        codigo_valido_entrada = tuple([x.codigo for x in c2])
        cursor.execute(
            """SELECT codigo FROM appva_cfop WHERE valido='nao' AND portaria=%s AND tipo='saida';""", [portaria]
        )
        c3 = namedtuplefetchall(cursor)
        codigo_invalido_saida = tuple([x.codigo for x in c3])
        cursor.execute(
            """SELECT codigo FROM appva_cfop WHERE valido='nao' AND portaria=%s AND tipo='entrada';""", [portaria]
        )
        c4 = namedtuplefetchall(cursor)
        codigo_invalido_entrada = tuple([x.codigo for x in c4])
        nome_municipio = [{'municipio': municipio}]
        if tabela == 'GIA':
            cursor.execute(
                """SELECT cnae FROM appva_gia_entradas_saidas WHERE inscricao=%s GROUP BY cnae;""", [inscricao]
            )
            n = namedtuplefetchall(cursor)
            ae = [x.cnae for x in n]
            cnae = str(ae[0])
            cursor.execute(
                """SELECT SUM(ipi) AS ipi, SUM(icms_st) AS icms FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;"""
                , [remessa, inscricao, ano, codigo_valido_saida])
            impostos_saida = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(ipi) AS ipi, SUM(icms_st) AS icms FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;"""
                , [remessa, inscricao, ano, codigo_valido_entrada])
            impostos_entrada = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS saida_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                [remessa, inscricao, ano, codigo_valido_saida]
            )
            valor_valido_saida = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS saida_nao_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                [remessa, inscricao, ano, codigo_invalido_saida]
            )
            valor_invalido_saida = namedtuplefetchall(cursor)
            if cnae in (
                    '111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800', '115600',
                    '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904', '119905', '119906',
                    '119907', '119908', '119909', '119999', '121101', '121102', '122900', '131800', '132600', '133401',
                    '133402', '133403', '133404', '133405', '133406', '133407', '133408', '133409', '133410', '133411',
                    '133499', '134200', '135100', '139301', '139302', '139303', '139304', '139305', '139306', '139399',
                    '141501', '141502', '142300', '161001', '161002', '161003', '161099', '162801', '162802', '162803',
                    '162899', '163600', '230600'):
                cursor.execute(
                    """SELECT (SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st))) AS entrada_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
                if float(str(valor_valido_entrada[0].entrada_computavel)) < float(
                        str(valor_valido_saida[0].saida_computavel)) * 0.50:
                    Lista = namedtuple('Lista', 'entrada_computavel')
                    valor_valido_entrada = [Lista(float(valor_valido_saida[0].saida_computavel) * 0.50)]
                else:
                    pass
            elif cnae in (
                    '500301', '500302', '600001', '600002', '600003', '710301', '710302', '721901', '721902', '722701',
                    '722702', '723501', '723502', '724301', '724302', '725100', '729401', '729402', '729403', '729404',
                    '729405', '810001', '810002', '810003', '810004', '810005', '810006', '810007', '810008', '810009',
                    '810010', '810099', '891600', '892401', '892402', '892403', '893200', '899101', '899102', '899103',
                    '899199', '910600', '990401', '990402', '990403'):
                cursor.execute(
                    """SELECT (SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)))  AS entrada_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
                if float(str(valor_valido_entrada[0].entrada_computavel)) < float(
                        str(valor_valido_saida[0].saida_computavel)) * 0.35:
                    Lista = namedtuple('Lista', 'entrada_computavel')
                    valor_valido_entrada = [Lista(float(valor_valido_saida[0].saida_computavel) * 0.35)]
                else:
                    pass
            elif cnae in (
                    '151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700', '155501',
                    '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804', '159899', '311601',
                    '311602', '311603', '311604', '312401', '312402', '312403', '312404', '321301', '321302', '321303',
                    '321304', '321305', '321399', '322101', '322102', '322103', '322104', '322105', '322106', '322107',
                    '322199'):
                cursor.execute(
                    """SELECT (SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st))) * 0.20 AS entrada_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
                if float(str(valor_valido_entrada[0].entrada_computavel)) < float(
                        str(valor_valido_saida[0].saida_computavel)) * 0.20:
                    Lista = namedtuple('Lista', 'entrada_computavel')
                    valor_valido_entrada = [Lista(float(valor_valido_saida[0].saida_computavel) * 0.20)]
                else:
                    pass
            else:
                cursor.execute(
                    """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS entrada_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS entrada_nao_computavel FROM appva_gia_entradas_saidas WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                [remessa, inscricao, ano, codigo_invalido_entrada]
            )
            valor_invalido_entrada = namedtuplefetchall(cursor)

            va_final = [{'valor_adicionado': float(str(valor_valido_saida[0].saida_computavel)) - float(
                str(valor_valido_entrada[0].entrada_computavel))}]

            ##ENTRADA VALIDA
            cursor.execute(
                """SELECT codigo FROM appva_cfop WHERE tipo='entrada' AND valido='sim' AND portaria=%s;"""
                , [portaria])
            cfop_ent_val = namedtuplefetchall(cursor)
            cfop_ent_valido = tuple([x.codigo for x in cfop_ent_val])

            cursor.execute(
                """SELECT vr_contabil , dt_inicial, dt_final, tipo, dt_process, cfop FROM appva_gia_entradas_saidas WHERE inscricao=%s AND ano_exercicio=%s AND cfop IN %s ORDER BY cfop;""",
                [inscricao, ano, cfop_ent_valido]
            )
            va_ent_valido = namedtuplefetchall(cursor)
            resu_ent_valido = [
                {'valor': x.vr_contabil, 'dt_inicial': x.dt_inicial, 'dt_final': x.dt_final, 'tipo': x.tipo,
                 'dt_process': x.dt_process, 'cfop': x.cfop} for x in va_ent_valido]

            ##ENTRADA INVÁLIDA
            cursor.execute(
                """SELECT codigo FROM appva_cfop WHERE tipo='entrada' AND valido='nao' AND portaria=%s;"""
                , [portaria])
            cfop_ent_inval = namedtuplefetchall(cursor)
            cfop_ent_invalido = tuple([x.codigo for x in cfop_ent_inval])

            cursor.execute(
                """SELECT vr_contabil , dt_inicial, dt_final, tipo, dt_process, cfop FROM appva_gia_entradas_saidas WHERE inscricao=%s AND ano_exercicio=%s AND cfop IN %s ORDER BY cfop;""",
                [inscricao, ano, cfop_ent_invalido]
            )
            va_ent_invalido = namedtuplefetchall(cursor)
            resu_ent_invalido = [
                {'valor': x.vr_contabil, 'dt_inicial': x.dt_inicial, 'dt_final': x.dt_final, 'tipo': x.tipo,
                 'dt_process': x.dt_process, 'cfop': x.cfop} for x in va_ent_invalido]

            ##SAIDA VÁLIDA
            cursor.execute(
                """SELECT codigo FROM appva_cfop WHERE tipo='saida' AND valido='sim' AND portaria=%s;"""
                , [portaria])
            cfop_sai_val = namedtuplefetchall(cursor)
            cfop_sai_valido = tuple([x.codigo for x in cfop_sai_val])

            cursor.execute(
                """SELECT vr_contabil , dt_inicial, dt_final, tipo, dt_process, cfop FROM appva_gia_entradas_saidas WHERE inscricao=%s AND ano_exercicio=%s AND cfop IN %s ORDER BY cfop;""",
                [inscricao, ano, cfop_sai_valido]
            )
            va_sai_valido = namedtuplefetchall(cursor)
            resu_sai_valido = [
                {'valor': x.vr_contabil, 'dt_inicial': x.dt_inicial, 'dt_final': x.dt_final, 'tipo': x.tipo,
                 'dt_process': x.dt_process, 'cfop': x.cfop} for x in va_sai_valido]

            ##SAÍDA INVÁLIDA
            cursor.execute(
                """SELECT codigo FROM appva_cfop WHERE tipo='saida' AND valido='nao' AND portaria=%s;"""
                , [portaria])
            cfop_sai_inval = namedtuplefetchall(cursor)
            cfop_sai_invalido = tuple([x.codigo for x in cfop_sai_inval])

            cursor.execute(
                """SELECT vr_contabil , dt_inicial, dt_final, tipo, dt_process, cfop FROM appva_gia_entradas_saidas WHERE inscricao=%s AND ano_exercicio=%s AND cfop IN %s ORDER BY cfop;""",
                [inscricao, ano, cfop_sai_invalido]
            )
            va_sai_invalido = namedtuplefetchall(cursor)
            resu_sai_invalido = [
                {'valor': x.vr_contabil, 'dt_inicial': x.dt_inicial, 'dt_final': x.dt_final, 'tipo': x.tipo,
                 'dt_process': x.dt_process, 'cfop': x.cfop} for x in va_sai_invalido]

        else:
            cursor.execute(
                """SELECT cnae FROM appva_efd WHERE inscricao=%s GROUP BY cnae;""", [inscricao]
            )
            n = namedtuplefetchall(cursor)
            ae = [x.cnae for x in n]
            cnae = str(ae[0])
            cursor.execute(
                """SELECT SUM(ipi) AS ipi, SUM(icms_st) AS icms FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;"""
                , [remessa, inscricao, ano, codigo_valido_saida])
            impostos_saida = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(ipi) AS ipi, SUM(icms_st) AS icms FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;"""
                , [remessa, inscricao, ano, codigo_valido_entrada])
            impostos_entrada = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS saida_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                [remessa, inscricao, ano, codigo_valido_saida]
            )
            valor_valido_saida = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS saida_nao_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                [remessa, inscricao, ano, codigo_invalido_saida]
            )
            valor_invalido_saida = namedtuplefetchall(cursor)
            if cnae in (
                    '111301', '111302', '111303', '111399', '112101', '112102', '112199', '113000', '114800', '115600',
                    '116401', '116402', '116403', '116499', '119901', '119902', '119903', '119904', '119905', '119906',
                    '119907', '119908', '119909', '119999', '121101', '121102', '122900', '131800', '132600', '133401',
                    '133402', '133403', '133404', '133405', '133406', '133407', '133408', '133409', '133410', '133411',
                    '133499', '134200', '135100', '139301', '139302', '139303', '139304', '139305', '139306', '139399',
                    '141501', '141502', '142300', '161001', '161002', '161003', '161099', '162801', '162802', '162803',
                    '162899', '163600', '230600'):
                cursor.execute(
                    """SELECT (SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st))) AS entrada_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
                if float(str(valor_valido_entrada[0].entrada_computavel)) < float(
                        str(valor_valido_saida[0].saida_computavel)) * 0.50:
                    Lista = namedtuple('Lista', 'entrada_computavel')
                    valor_valido_entrada = [Lista(float(valor_valido_saida[0].saida_computavel) * 0.50)]
                else:
                    pass
            elif cnae in (
                    '500301', '500302', '600001', '600002', '600003', '710301', '710302', '721901', '721902', '722701',
                    '722702', '723501', '723502', '724301', '724302', '725100', '729401', '729402', '729403', '729404',
                    '729405', '810001', '810002', '810003', '810004', '810005', '810006', '810007', '810008', '810009',
                    '810010', '810099', '891600', '892401', '892402', '892403', '893200', '899101', '899102', '899103',
                    '899199', '910600', '990401', '990402', '990403'):
                cursor.execute(
                    """SELECT (SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)))  AS entrada_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
                if float(str(valor_valido_entrada[0].entrada_computavel)) < float(
                        str(valor_valido_saida[0].saida_computavel)) * 0.35:
                    Lista = namedtuple('Lista', 'entrada_computavel')
                    valor_valido_entrada = [Lista(float(valor_valido_saida[0].saida_computavel) * 0.35)]
                else:
                    valor_valido_entrada = valor_valido_entrada
            elif cnae in (
                    '151201', '151202', '151203', '152101', '152102', '152103', '153901', '153902', '154700', '155501',
                    '155502', '155503', '155504', '155505', '159801', '159802', '159803', '159804', '159899', '311601',
                    '311602', '311603', '311604', '312401', '312402', '312403', '312404', '321301', '321302', '321303',
                    '321304', '321305', '321399', '322101', '322102', '322103', '322104', '322105', '322106', '322107',
                    '322199'):
                cursor.execute(
                    """SELECT (SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st))) * 0.20 AS entrada_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
                if float(str(valor_valido_entrada[0].entrada_computavel)) < float(
                        str(valor_valido_saida[0].saida_computavel)) * 0.20:
                    Lista = namedtuple('Lista', 'entrada_computavel')
                    valor_valido_entrada = [Lista(float(valor_valido_saida[0].saida_computavel) * 0.20)]
                else:
                    valor_valido_entrada = valor_valido_entrada
            else:
                cursor.execute(
                    """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS entrada_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                    [remessa, inscricao, ano, codigo_valido_entrada]
                )
                valor_valido_entrada = namedtuplefetchall(cursor)
            cursor.execute(
                """SELECT SUM(vr_contabil) - (SUM(ipi)+SUM(icms_st)) AS entrada_nao_computavel FROM appva_efd WHERE remessa=%s AND inscricao=%s AND ano_exercicio=%s AND cfop IN %s;""",
                [remessa, inscricao, ano, codigo_invalido_entrada]
            )
            valor_invalido_entrada = namedtuplefetchall(cursor)

            va_final = [{'valor_adicionado': float(valor_valido_saida[0].saida_computavel) - float(
                valor_valido_entrada[0].entrada_computavel)}]

            ##ENTRADA VALIDA
            cursor.execute(
                """SELECT codigo FROM appva_cfop WHERE tipo='entrada' AND valido='sim' AND portaria=%s;"""
                , [portaria])
            cfop_ent_val = namedtuplefetchall(cursor)
            cfop_ent_valido = tuple([x.codigo for x in cfop_ent_val])

            cursor.execute(
                """SELECT vr_contabil , dt_inicial, dt_final, cfop FROM appva_efd WHERE inscricao=%s AND ano_exercicio=%s AND cfop IN %s ORDER BY cfop;""",
                [inscricao, ano, cfop_ent_valido]
            )
            va_ent_valido = namedtuplefetchall(cursor)
            resu_ent_valido = [
                {'valor': x.vr_contabil, 'dt_inicial': x.dt_inicial, 'dt_final': x.dt_final, 'cfop': x.cfop} for x in
                va_ent_valido]

            ##ENTRADA INVÁLIDA
            cursor.execute(
                """SELECT codigo FROM appva_cfop WHERE tipo='entrada' AND valido='nao' AND portaria=%s;"""
                , [portaria])
            cfop_ent_inval = namedtuplefetchall(cursor)
            cfop_ent_invalido = tuple([x.codigo for x in cfop_ent_inval])

            cursor.execute(
                """SELECT vr_contabil , dt_inicial, dt_final, cfop FROM appva_efd WHERE inscricao=%s AND ano_exercicio=%s AND cfop IN %s ORDER BY cfop;""",
                [inscricao, ano, cfop_ent_invalido]
            )
            va_ent_invalido = namedtuplefetchall(cursor)
            resu_ent_invalido = [
                {'valor': x.vr_contabil, 'dt_inicial': x.dt_inicial, 'dt_final': x.dt_final, 'cfop': x.cfop} for x in
                va_ent_invalido]

            ##SAIDA VÁLIDA
            cursor.execute(
                """SELECT codigo FROM appva_cfop WHERE tipo='saida' AND valido='sim' AND portaria=%s;"""
                , [portaria])
            cfop_sai_val = namedtuplefetchall(cursor)
            cfop_sai_valido = tuple([x.codigo for x in cfop_sai_val])

            cursor.execute(
                """SELECT vr_contabil , dt_inicial, dt_final, cfop FROM appva_efd WHERE inscricao=%s AND ano_exercicio=%s AND cfop IN %s ORDER BY cfop;""",
                [inscricao, ano, cfop_sai_valido]
            )
            va_sai_valido = namedtuplefetchall(cursor)
            resu_sai_valido = [
                {'valor': x.vr_contabil, 'dt_inicial': x.dt_inicial, 'dt_final': x.dt_final, 'cfop': x.cfop} for x in
                va_sai_valido]

            ##SAÍDA INVÁLIDA
            cursor.execute(
                """SELECT codigo FROM appva_cfop WHERE tipo='saida' AND valido='nao' AND portaria=%s;"""
                , [portaria])
            cfop_sai_inval = namedtuplefetchall(cursor)
            cfop_sai_invalido = tuple([x.codigo for x in cfop_sai_inval])

            cursor.execute(
                """SELECT vr_contabil , dt_inicial, dt_final, cfop FROM appva_efd WHERE inscricao=%s AND ano_exercicio=%s AND cfop IN %s ORDER BY cfop;""",
                [inscricao, ano, cfop_sai_invalido]
            )
            va_sai_invalido = namedtuplefetchall(cursor)
            resu_sai_invalido = [
                {'valor': x.vr_contabil, 'dt_inicial': x.dt_inicial, 'dt_final': x.dt_final, 'cfop': x.cfop} for x in
                va_sai_invalido]

    return rendering.render_to_pdf_response(request=request,
                                            context={'lista1': dados_inscricao, 'lista2': valor_valido_saida,
                                                     'lista3': valor_invalido_saida, 'lista4': valor_valido_entrada,
                                                     'lista5': valor_invalido_entrada, 'lista6': va_final,
                                                     'lista8': impostos_saida,
                                                     'lista9': impostos_entrada, 'lista10': resu_ent_valido,
                                                     'lista11': resu_ent_invalido, 'lista12': resu_sai_valido,
                                                     'lista13': resu_sai_invalido, 'mun': nome_municipio},
                                            template='RELATORIO_VALOR_ADICIONADO_ANALITICO.html',
                                            encoding='utf-8')


@login_required
def PRE_RELATORIO_CNAE(request):
    municipio = request.GET.get('municipio')
    atividade_economica = request.GET.get('atividade_economica')
    subclasse = request.GET.get('subclasse')
    arbitramento = request.GET.get('arbitramento')
    if atividade_economica:
        if atividade_economica == 'AGROPECUARIO':
            return redirect('RELATORIO_CNAE', municipio=municipio, atividade_economica=atividade_economica,
                            subclasse='VAZIO',
                            arbitramento='VAZIO')
        elif atividade_economica == 'COMERCIO_INDUSTRIA':
            return redirect('RELATORIO_CNAE', municipio=municipio, atividade_economica=atividade_economica,
                            subclasse='VAZIO',
                            arbitramento='VAZIO')
        else:
            return redirect('RELATORIO_CNAE', municipio=municipio, atividade_economica=atividade_economica,
                            subclasse='VAZIO',
                            arbitramento='VAZIO')
    else:
        pass

    if subclasse:
        return redirect('RELATORIO_CNAE', municipio=municipio, atividade_economica='VAZiO', subclasse=subclasse,
                        arbitramento='VAZIO')
    else:
        pass

    if arbitramento:
        return redirect('RELATORIO_CNAE', municipio=municipio, atividade_economica='VAZiO', subclasse='VAZIO',
                        arbitramento=arbitramento)
    else:
        pass

    return render(request, 'PRE_RELATORIO_CNAE.html')


@login_required
def RELATORIO_CNAE(request, municipio, atividade_economica, subclasse, arbitramento):
    municipio = [{'municipio': municipio}]
    with connections['default'].cursor() as cursor:
        if atividade_economica != 'VAZIO':
            if atividade_economica == 'AGROPECUARIO':
                codigos = (
                    '151201', '151203', '220901', '151202', '115600', '210107', '119906', '322101', '134200', '121101',
                    '111399', '111301', '116499', '220903', '139399', '159801', '155505', '133402', '133499', '133405',
                    '131700', '119905', '154700', '116401', '111302', '119908')
                cursor.execute(
                    """SELECT * FROM appva_cnae WHERE subclasse IN %s;""", [codigos]
                )
                resultados = namedtuplefetchall(cursor)
            elif atividade_economica == 'COMERCIO_INDUSTRIA':
                codigos = (
                    '4711302', '1011201', '1011205', '3511501', '1013902', '4744099', '4619200', '151201', '4635402',
                    '4731800',
                    '4753900', '2330301', '4683400', '1610203', '4541203', '5620101', '162899', '4771701', '4635499',
                    '4671100',
                    '4661300', '4511101', '4744001', '4772500', '4530703', '4639701', '4771704', '4781400', '4634601',
                    '4520001', '4623109', '1052000', '4759899', '4751201', '4744002', '4530705', '4742300', '4644301',
                    '4681805', '4784900', '4741500', '1099699', '4530701', '4723700', '1629301', '4754701', '4755503',
                    '4712100', '2930101', '4782201', '2532201', '4632001', '1621800', '4721104', '4755501', '4774100',
                    '724301',
                    '4761003', '4729699', '2342702', '1812100', '4763602', '2539001', '4541202', '4789005', '4511102',
                    '5611201', '220901', '4729602', '1622602', '810099', '1081302', '2950600', '1610204', '5611203',
                    '1032501', '4616800', '3321000', '4637106', '1066000', '5620104', '4646001', '220902', '4789099',
                    '1741902',
                    '1053800', '4686902', '810006', '4691500', '4755502', '8650006', '2330302', '4752100', '7732201',
                    '4669999',
                    '4763603', '2330305', '4679604', '5510801', '4541206', '3299003', '1352900', '4722902', '4743100',
                    '6810201', '4771702', '7722500', '3101200', '4721102', '4689301', '7500100', '2512800', '1412601',
                    '2061400', '4543900', '2542000', '7319003', '4617600', '4757100', '4789002',
                    '3313901', '4621400', '4732600', '2391503', '4681802', '1091101', '2511000', '4724500', '9529106',
                    '4754702', '1099604', '1031700', '4641903', '1412602', '4665600', '4530704', '4520003', '2869100',
                    '4637199', '4789004', '4642702', '4611700', '9602501', '4789001', '4713002', '4330404', '4729601',
                    '5612100', '1813099', '5611204', '4651602', '4763601', '4930202', '2543800', '4783101', '4930204',
                    '322104',
                    '4618499', '7319002', '1064300', '4759801', '3831901', '4399103', '1931400', '4789007', '4541204',
                    '4930201', '3299099', '2330399', '1529700', '9609208', '8592999', '4330499', '4520002', '1063500',
                    '1091102', '9529104', '4761001', '4321500', '9512600', '3314702', '4692300', '4761002', '4520007',
                    '9602502', '3211602', '1069400', '5620103''1622699', '9521500', '9511800', '4744004', '4652400',
                    '8230001',
                    '4399199', '4785799', '4789003', '7911200', '4721103', '1411801', '5620102', '9529101', '3832700',
                    '4789008', '1071600', '1359600', '3314719', '3314712', '1095300', '4520006', '4782202', '9001906',
                    '4322302', '3831999', '1094500', '8130300', '7721700', '6190699', '1539400', '2592601', '8219901',
                    '8610101', '8599604', '8599603',
                    '1821100')
                cursor.execute(
                    """SELECT * FROM appva_cnae WHERE subclasse IN %s;""", [codigos]
                )
                resultados = namedtuplefetchall(cursor)
            else:
                codigos = (
                    '3514000', '6190699', '6110801', '4922101', '4930202', '6120501', '4930201', '4921301', '4922102',
                    '4929902', '8012900', '4921302', '4930203', '6110803', '6143400', '6022501', '5320201', '6190601')
                cursor.execute(
                    """SELECT * FROM appva_cnae WHERE subclasse IN %s;""", [codigos]
                )
                resultados = namedtuplefetchall(cursor)
        else:
            pass
        if subclasse != 'VAZIO':
            cursor.execute(
                """SELECT * FROM appva_cnae WHERE subclasse=%s;""", [subclasse]
            )
            resultados = namedtuplefetchall(cursor)
        else:
            pass
        if arbitramento != 'VAZIO':
            cursor.execute(
                """SELECT * FROM appva_cnae WHERE arbitramento=%s;""", [subclasse]
            )
            resultados = namedtuplefetchall(cursor)
        else:
            pass
    return rendering.render_to_pdf_response(request=request,
                                            context={'lista1': resultados, 'mun': municipio},
                                            template='RELATORIO_CNAE.html',
                                            encoding='utf-8')


@login_required
def PRE_RELATORIO_CONTRIBUINTE(request):
    tipo_cadastro = request.GET.get('tipo_cadastro')
    inscricao = request.GET.get('inscricao')
    razao_social = request.GET.get('razao_social')
    cpf_cnpj = request.GET.get('cpf_cnpj')

    atividade_economica = request.GET.get('atividade_economica')
    tipo_contabilista = request.GET.get('tipo_contabilista')
    contabilista = request.GET.get('contabilista')

    situacao = request.GET.get('situacao')
    municipio = request.GET.get('municipio')
    if tipo_cadastro and inscricao:
        return redirect('RELATORIO_CONTRIBUINTE', municipio=municipio, tipo_cadastro=tipo_cadastro, inscricao=inscricao,
                        razao_social='VAZIO',
                        cpf_cnpj='VAZIO', atividade_economica='VAZIO', tipo_contabilista='VAZIO',
                        contabilista='VAZIO', situacao='VAZIO')
    elif tipo_cadastro and razao_social:
        return redirect('RELATORIO_CONTRIBUINTE', municipio=municipio, tipo_cadastro=tipo_cadastro, inscricao='VAZIO',
                        razao_social=razao_social,
                        cpf_cnpj='VAZIO', atividade_economica='VAZIO', tipo_contabilista='VAZIO',
                        contabilista='VAZIO', situacao='VAZIO')
    elif tipo_cadastro and cpf_cnpj:
        return redirect('RELATORIO_CONTRIBUINTE', municipio=municipio, tipo_cadastro=tipo_cadastro, inscricao='VAZIO',
                        razao_social='VAZIO',
                        cpf_cnpj=cpf_cnpj, atividade_economica='VAZIO', tipo_contabilista='VAZIO',
                        contabilista='VAZIO', situacao='VAZIO')
    elif tipo_cadastro and atividade_economica:
        return redirect('RELATORIO_CONTRIBUINTE', municipio=municipio, tipo_cadastro=tipo_cadastro, inscricao='VAZIO',
                        razao_social='VAZIO',
                        cpf_cnpj='VAZIO', atividade_economica=atividade_economica, tipo_contabilista='VAZIO',
                        contabilista='VAZIO', situacao='VAZIO')
    elif tipo_cadastro and contabilista:
        return redirect('RELATORIO_CONTRIBUINTE', municipio=municipio, tipo_cadastro=tipo_cadastro, inscricao='VAZIO',
                        razao_social='VAZIO',
                        cpf_cnpj='VAZIO', atividade_economica='VAZIO', tipo_contabilista=tipo_contabilista,
                        contabilista=contabilista, situacao='VAZIO')
    elif tipo_cadastro and situacao:
        return redirect('RELATORIO_CONTRIBUINTE', municipio=municipio, tipo_cadastro=tipo_cadastro, inscricao='VAZIO',
                        razao_social='VAZIO',
                        cpf_cnpj='VAZIO', atividade_economica='VAZIO', tipo_contabilista='VAZIO',
                        contabilista='VAZIO', situacao=situacao)
    else:
        pass
    return render(request, 'PRE_RELATORIO_CONTRIBUINTE.html')


@login_required
def RELATORIO_CONTRIBUINTE(request, municipio, tipo_cadastro, inscricao, razao_social, cpf_cnpj, atividade_economica,
                           tipo_contabilista, contabilista, situacao):
    mun = [{'municipio': municipio}]
    with connections['default'].cursor() as cursor:
        if tipo_cadastro == 'CCI':
            if inscricao != 'VAZIO':
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cci WHERE numr_inscricao_estadual=%s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [inscricao, municipio]
                )
                resultados = namedtuplefetchall(cursor)
            elif razao_social != 'VAZIO':
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cci WHERE nome_pessoa=%s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [razao_social, municipio]
                )
                resultados = namedtuplefetchall(cursor)
            elif cpf_cnpj != 'VAZIO':
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cci WHERE numr_documento=%s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [razao_social, municipio]
                )
                resultados = namedtuplefetchall(cursor)
            elif atividade_economica == 'AGROPECUARIO':
                codigos = (
                    '151201', '151203', '220901', '151202', '115600', '210107', '119906', '322101', '134200', '121101',
                    '111399', '111301', '116499', '220903', '139399', '159801', '155505', '133402', '133499', '133405',
                    '131700', '119905', '154700', '116401', '111302', '119908')
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cci WHERE codg_cnae IN %s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [codigos, municipio]
                )

                resultados = namedtuplefetchall(cursor)
            elif atividade_economica == 'PRESTACAO_SERVICOS':
                codigos = (
                    '3514000', '6190699', '6110801', '4922101', '4930202', '6120501', '4930201', '4921301', '4922102',
                    '4929902', '8012900', '4921302', '4930203', '6110803', '6143400', '6022501', '5320201', '6190601')
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cci WHERE codg_cnae IN %s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [codigos, municipio]
                )

                resultados = namedtuplefetchall(cursor)

            elif atividade_economica == 'COMERCIO_INDUSTRIA':
                codigos = (
                    '4711302', '1011201', '1011205', '3511501', '1013902', '4744099', '4619200', '151201', '4635402',
                    '4731800', '4753900', '2330301', '4683400', '1610203', '4541203', '5620101', '162899', '4771701',
                    '4635499', '4671100', '4661300', '4511101', '4744001', '4772500', '4530703', '4639701', '4771704',
                    '4781400', '4634601', '4520001', '4623109', '1052000', '4759899', '4751201', '4744002', '4530705',
                    '4742300', '4644301', '4681805', '4784900', '4741500', '1099699', '4530701', '4723700', '1629301',
                    '4754701', '4755503', '4712100', '2930101', '4782201', '2532201', '4632001', '1621800', '4721104',
                    '4755501', '4774100', '724301', '4761003', '4729699', '2342702', '1812100', '4763602', '2539001',
                    '4541202', '4789005', '4511102', '5611201', '220901', '4729602', '1622602', '810099', '1081302',
                    '2950600', '1610204', '5611203',
                    '1032501', '4616800', '3321000', '4637106', '1066000', '5620104', '4646001', '220902', '4789099',
                    '1741902', '1053800', '4686902', '810006', '4691500', '4755502', '8650006', '2330302', '4752100',
                    '7732201', '4669999', '4763603', '2330305', '4679604', '5510801', '4541206', '3299003', '1352900',
                    '4722902', '4743100', '6810201', '4771702', '7722500', '3101200', '4721102', '4689301', '7500100',
                    '2512800', '1412601', '2061400', '4543900', '2542000', '7319003', '4617600', '4757100', '4789002',
                    '3313901', '4621400', '4732600', '2391503', '4681802', '1091101', '2511000', '4724500', '9529106',
                    '4754702', '1099604', '1031700', '4641903', '1412602', '4665600', '4530704', '4520003', '2869100',
                    '4637199', '4789004', '4642702', '4611700', '9602501', '4789001', '4713002', '4330404', '4729601',
                    '5612100', '1813099', '5611204', '4651602', '4763601', '4930202', '2543800', '4783101', '4930204',
                    '322104', '4618499', '7319002', '1064300', '4759801', '3831901', '4399103', '1931400', '4789007',
                    '4541204', '4930201', '3299099', '2330399', '1529700', '9609208', '8592999', '4330499', '4520002',
                    '1063500', '1091102', '9529104', '4761001', '4321500', '9512600', '3314702', '4692300', '4761002',
                    '4520007', '9602502', '3211602', '1069400', '5620103''1622699', '9521500', '9511800', '4744004',
                    '4652400', '8230001', '4399199', '4785799', '4789003', '7911200', '4721103', '1411801', '5620102',
                    '9529101', '3832700', '4789008', '1071600', '1359600', '3314719', '3314712', '1095300', '4520006',
                    '4782202', '9001906', '4322302', '3831999', '1094500', '8130300', '7721700', '6190699', '1539400',
                    '2592601', '8219901', '8610101', '8599604', '8599603', '1821100')
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cci WHERE codg_cnae IN %s AND municipio=%s numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [codigos, municipio]
                )

                resultados = namedtuplefetchall(cursor)
            elif contabilista and tipo_contabilista == 'CRC':
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cci WHERE codg_crc=%s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [contabilista, municipio]
                )

                resultados = namedtuplefetchall(cursor)
            elif contabilista and tipo_contabilista == 'NOME':
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cci WHERE nome_contabilista=%s AND nome_municipio=%s;""",
                    [contabilista, municipio]
                )
                resultados = namedtuplefetchall(cursor)
            elif situacao:
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cci WHERE status=%s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [situacao, municipio]
                )
                resultados = namedtuplefetchall(cursor)
            else:
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cci WHERE nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [municipio]
                )
                resultados = namedtuplefetchall(cursor)

        else:
            if inscricao != 'VAZIO':
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cap WHERE numr_inscricao_estadual=%s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [inscricao, municipio]
                )
                resultados = namedtuplefetchall(cursor)
            elif razao_social != 'VAZIO':
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cap WHERE nome_pessoa=%s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [razao_social, municipio]
                )
                resultados = namedtuplefetchall(cursor)
            elif cpf_cnpj != 'VAZIO':
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cap WHERE numr_documento=%s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [razao_social, municipio]
                )
                resultados = namedtuplefetchall(cursor)
            elif atividade_economica == 'AGROPECUARIO':
                codigos = (
                    '151201', '151203', '220901', '151202', '115600', '210107', '119906', '322101', '134200', '121101',
                    '111399', '111301', '116499', '220903', '139399', '159801', '155505', '133402', '133499', '133405',
                    '131700', '119905', '154700', '116401', '111302', '119908')
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cap WHERE codg_cnae IN %s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [codigos, municipio]
                )

                resultados = namedtuplefetchall(cursor)
            elif atividade_economica == 'PRESTACAO_SERVICOS':
                codigos = (
                    '3514000', '6190699', '6110801', '4922101', '4930202', '6120501', '4930201', '4921301', '4922102',
                    '4929902', '8012900', '4921302', '4930203', '6110803', '6143400', '6022501', '5320201', '6190601')
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cap WHERE codg_cnae IN %s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [codigos, municipio]
                )

                resultados = namedtuplefetchall(cursor)

            elif atividade_economica == 'COMERCIO_INDUSTRIA':
                codigos = (
                    '4711302', '1011201', '1011205', '3511501', '1013902', '4744099', '4619200', '151201', '4635402',
                    '4731800', '4753900', '2330301', '4683400', '1610203', '4541203', '5620101', '162899', '4771701',
                    '4635499', '4671100', '4661300', '4511101', '4744001', '4772500', '4530703', '4639701', '4771704',
                    '4781400', '4634601', '4520001', '4623109', '1052000', '4759899', '4751201', '4744002', '4530705',
                    '4742300', '4644301', '4681805', '4784900', '4741500', '1099699', '4530701', '4723700', '1629301',
                    '4754701', '4755503', '4712100', '2930101', '4782201', '2532201', '4632001', '1621800', '4721104',
                    '4755501', '4774100', '724301', '4761003', '4729699', '2342702', '1812100', '4763602', '2539001',
                    '4541202', '4789005', '4511102', '5611201', '220901', '4729602', '1622602', '810099', '1081302',
                    '2950600', '1610204', '5611203',
                    '1032501', '4616800', '3321000', '4637106', '1066000', '5620104', '4646001', '220902', '4789099',
                    '1741902', '1053800', '4686902', '810006', '4691500', '4755502', '8650006', '2330302', '4752100',
                    '7732201', '4669999', '4763603', '2330305', '4679604', '5510801', '4541206', '3299003', '1352900',
                    '4722902', '4743100', '6810201', '4771702', '7722500', '3101200', '4721102', '4689301', '7500100',
                    '2512800', '1412601', '2061400', '4543900', '2542000', '7319003', '4617600', '4757100', '4789002',
                    '3313901', '4621400', '4732600', '2391503', '4681802', '1091101', '2511000', '4724500', '9529106',
                    '4754702', '1099604', '1031700', '4641903', '1412602', '4665600', '4530704', '4520003', '2869100',
                    '4637199', '4789004', '4642702', '4611700', '9602501', '4789001', '4713002', '4330404', '4729601',
                    '5612100', '1813099', '5611204', '4651602', '4763601', '4930202', '2543800', '4783101', '4930204',
                    '322104', '4618499', '7319002', '1064300', '4759801', '3831901', '4399103', '1931400', '4789007',
                    '4541204', '4930201', '3299099', '2330399', '1529700', '9609208', '8592999', '4330499', '4520002',
                    '1063500', '1091102', '9529104', '4761001', '4321500', '9512600', '3314702', '4692300', '4761002',
                    '4520007', '9602502', '3211602', '1069400', '5620103''1622699', '9521500', '9511800', '4744004',
                    '4652400', '8230001', '4399199', '4785799', '4789003', '7911200', '4721103', '1411801', '5620102',
                    '9529101', '3832700', '4789008', '1071600', '1359600', '3314719', '3314712', '1095300', '4520006',
                    '4782202', '9001906', '4322302', '3831999', '1094500', '8130300', '7721700', '6190699', '1539400',
                    '2592601', '8219901', '8610101', '8599604', '8599603', '1821100')
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cap WHERE codg_cnae IN %s AND municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [codigos, municipio]
                )

                resultados = namedtuplefetchall(cursor)
            elif contabilista and tipo_contabilista == 'CRC':
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cap WHERE codg_crc=%s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [contabilista, municipio]
                )

                resultados = namedtuplefetchall(cursor)
            elif contabilista and tipo_contabilista == 'NOME':
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cap WHERE nome_contabilista=%s AND nome_municipio=%s GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [contabilista, municipio]
                )
                resultados = namedtuplefetchall(cursor)
            elif situacao:
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cap WHERE status=%s AND nome_municipio=% GROUP BY numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito;""",
                    [situacao, municipio]
                )
                resultados = namedtuplefetchall(cursor)
            else:
                cursor.execute(
                    """SELECT numr_inscricao_estadual, nome_pessoa, status, tipo_inscrito FROM appva_cap WHERE nome_municipio=%s;""",
                    [municipio]
                )
                resultados = namedtuplefetchall(cursor)
    return rendering.render_to_pdf_response(request=request,
                                            context={'lista1': resultados, 'dados': mun},
                                            template='RELATORIO_CONTRIBUINTE.html',
                                            encoding='utf-8')


@login_required
def PRE_RELATORIO_PTS(request):
    municipio = request.GET.get('municipio')
    tabela = request.GET.get('tabela')
    if municipio and tabela:
        return redirect('RELATORIO_PTS', municipio=municipio, tabela=tabela)
    else:
        pass
    return render(request, 'PRE_RELATORIO_PTS.html')


@login_required
def RELATORIO_PTS(request, municipio, tabela):
    mun = [{'municipio': municipio}]
    with connections['default'].cursor() as cursor:
        if tabela == 'COP3':
            cursor.execute(
                """SELECT inscricao, contribuinte FROM appva_gia_cop3 WHERE municipio=%s GROUP BY inscricao, contribuinte;""",
                [municipio]
            )
            resultados = namedtuplefetchall(cursor)
        else:
            cursor.execute(
                """SELECT inscricao, contribuinte FROM appva_reg_1400_efd WHERE municipio=%s GROUP BY inscricao, contribuinte;""",
                [municipio]
            )
            resultados = namedtuplefetchall(cursor)
    return rendering.render_to_pdf_response(request=request,
                                            context={'lista1': resultados, 'dados': mun},
                                            template='RELATORIO_PTS.html',
                                            encoding='utf-8')


@login_required
def PRE_RELATORIO_CONTABILISTA(request):
    municipio = request.GET.get('municipio')
    ano_exercicio = request.GET.get('ano_exercicio')
    tabela = request.GET.get('tabela')
    if municipio and ano_exercicio and tabela:
        return redirect('RELATORIO_CONTABILISTA', municipio=municipio, ano_exercicio=ano_exercicio, tabela=tabela)
    else:
        pass
    return render(request, 'PRE_RELATORIO_CONTABILISTA.html')


@login_required
def RELATORIO_CONTABILISTA(request, municipio, ano_exercicio, tabela):
    mun = [{'municipio': municipio}]
    with connections['default'].cursor() as cursor:
        if tabela == 'CCI':
            cursor.execute(
                """SELECT codg_crc, nome_contabilista, municipio_contabilista, email_contabilista, ddd_telefone_contabilista, telefone_contabilista FROM appva_cci WHERE ano_exercicio=%s AND municipio_contabilista=%s GROUP BY codg_crc, nome_contabilista, municipio_contabilista, email_contabilista, ddd_telefone_contabilista, telefone_contabilista ORDER BY nome_contabilista ASC;""",
                [ano_exercicio, municipio])
            resultados = namedtuplefetchall(cursor)
        else:
            cursor.execute(
                """SELECT codg_crc, nome_contabilista, municipio_contabilista, email_contabilista, ddd_telefone_contabilista, telefone_contabilista FROM appva_cap WHERE ano_exercicio=%s AND municipio_contabilista=%s GROUP BY codg_crc, nome_contabilista, municipio_contabilista, email_contabilista, ddd_telefone_contabilista, telefone_contabilista ORDER BY nome_contabilista ASC;""",
                [ano_exercicio, municipio])
            resultados = namedtuplefetchall(cursor)
        return rendering.render_to_pdf_response(request=request,
                                                context={'lista1': resultados, 'dados': mun},
                                                template='RELATORIO_CONTABILISTA.html',
                                                encoding='utf-8')


@login_required
def PRE_RELATORIO_VARIACAO_HISTORICA(request, municipio, remessa, portaria, inscricao, tabela, cadastro, ano):
    if request.method == 'POST':
        ano_iv = request.POST['ano_iv']
        ano_fv = request.POST['ano_fv']
        return redirect('RELATORIO_VARIACAO_HISTORICA', municipio=municipio, remessa=remessa, portaria=portaria,
                        inscricao=inscricao, tabela=tabela, cadastro=cadastro, ano=ano, ano_inicial=ano_iv,
                        ano_final=ano_fv)
    return render(request, 'PRE_RELATORIO_VARIACAO_HISTORICA.html')


@login_required
def RELATORIO_VARIACAO_HISTORICA(request, municipio, remessa, portaria, inscricao, tabela, cadastro, ano, ano_inicial,
                                 ano_final):
    mun = [{'municipio': municipio}]
    with connections['default'].cursor() as cursor:
        if cadastro == 'CCI':
            cursor.execute(
                """SELECT * FROM appva_cci WHERE numr_inscricao_estadual=%s AND ano_exercicio=%s;""",
                [inscricao, ano]
            )
            dados_inscricao = namedtuplefetchall(cursor)
        else:
            cursor.execute(
                """SELECT * FROM appva_cap WHERE numr_inscricao_estadual=%s AND ano_exercicio=%s;""",
                [inscricao, ano]
            )
            dados_inscricao = namedtuplefetchall(cursor)

        cursor.execute(
            """SELECT inscricao, vr_adicionado, entradas, saidas, ano_exercicio FROM appva_acypr555 WHERE inscricao=%s AND ano_exercicio BETWEEN %s and %s AND ano_exercicio NOT LIKE %s UNION SELECT inscricao, vr_adicionado, entradas, saidas, ano_exercicio FROM appva_acypr557 WHERE inscricao=%s AND ano_exercicio BETWEEN %s AND %s AND ano_exercicio NOT LIKE %s ORDER BY ano_exercicio ASC;
                """
            , [inscricao, ano_inicial, ano_final, ano_final, inscricao, ano_inicial, ano_final, ano_final])
        variacao1 = namedtuplefetchall(cursor)

        cursor.execute(
            """SELECT inscricao, vr_adicionado, entradas, saidas, ano_exercicio FROM appva_acypr555 WHERE inscricao=%s AND ano_exercicio BETWEEN %s and %s AND ano_exercicio NOT LIKE %s UNION SELECT inscricao, vr_adicionado, entradas, saidas, ano_exercicio FROM appva_acypr557 WHERE inscricao=%s AND ano_exercicio BETWEEN %s AND %s AND ano_exercicio NOT LIKE %s ORDER BY ano_exercicio ASC;
                """
            , [inscricao, ano_inicial, ano_final, ano_inicial, inscricao, ano_inicial, ano_final, ano_inicial])
        variacao2 = namedtuplefetchall(cursor)

        variacao_sp = [
            {'inscricao': x.inscricao, 'vr_adicionado': x.vr_adicionado, 'entradas': x.entradas, 'saidas': x.saidas,
             'ano_exercicio': x.ano_exercicio} for x in variacao1]

        variacao2_sp2 = [
            {'inscricao': x.inscricao, 'vr_adicionado': x.vr_adicionado, 'entradas': x.entradas, 'saidas': x.saidas,
             'ano_exercicio': x.ano_exercicio} for x in variacao2]

        variacao2_sp2[0]['vr_adicionado'] = float(0.0)
        variacao2_sp2[0]['entradas'] = float(0.0)
        variacao2_sp2[0]['saidas'] = float(0.0)

        variacao_sp[0]['vr_adicionado'] = float(0.01)
        variacao_sp[0]['entradas'] = float(0.001)
        variacao_sp[0]['saidas'] = float(0.001)

        apx = len(variacao2_sp2)

        resu_vr = [{'ano_exercicio': variacao2_sp2[x]['ano_exercicio'], 'entradas': str(f"{variacao2_sp2[x]['entradas']:,.2f}")
                       ,
                    'cresc_entradas': ((variacao2_sp2[x]['entradas'] / variacao_sp[x]['entradas']) - 1) * 100,
                    'saidas': str(f"{variacao2_sp2[x]['saidas']:,.2f}"),
                    'cresc_saidas': ((variacao2_sp2[x]['saidas'] / variacao_sp[x]['saidas']) - 1) * 100,
                    'vr_adicionado': str(f"{variacao2_sp2[x]['vr_adicionado']:,.2f}"), 'cresc_vr_adicionado': ((variacao2_sp2[x][
                                                                                                'vr_adicionado'] /
                                                                                            variacao_sp[x][
                                                                                                'vr_adicionado']) - 1) * 100}
                   for x in range(apx)]

        return rendering.render_to_pdf_response(request=request,
                                                context={'dados': mun, 'lista1': dados_inscricao, 'lista2': resu_vr},
                                                template='RELATORIO_VARIACAO_HISTORICA.html',
                                                encoding='utf-8')
